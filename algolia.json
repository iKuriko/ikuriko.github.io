[{"categories":"posts","content":"\u003cp\u003e1.插上4G模块，虚拟出5个USB设备，通过以下命令查看是否连接，输出如下\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003els /dev/ttyUSB*\n/dev/ttyUSB0 /dev/ttyUSB1 /dev/ttyUSB2 /dev/ttyUSB3 /dev/ttyUSB4\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003edmesg \u003cspan class=\"p\"\u003e|\u003c/span\u003e grep ttyUSB\n\u003cspan class=\"o\"\u003e[\u003c/span\u003e  8.058470\u003cspan class=\"o\"\u003e]\u003c/span\u003e usb 1-1.3: GSM modem \u003cspan class=\"o\"\u003e(\u003c/span\u003e1-port\u003cspan class=\"o\"\u003e)\u003c/span\u003e converter now attached to ttyUSB0\n\u003cspan class=\"o\"\u003e[\u003c/span\u003e  8.058700\u003cspan class=\"o\"\u003e]\u003c/span\u003e usb 1-1.3: GSM modem \u003cspan class=\"o\"\u003e(\u003c/span\u003e1-port\u003cspan class=\"o\"\u003e)\u003c/span\u003e converter now attached to ttyUSB1\n\u003cspan class=\"o\"\u003e[\u003c/span\u003e  8.069734\u003cspan class=\"o\"\u003e]\u003c/span\u003e usb 1-1.3: GSM modem \u003cspan class=\"o\"\u003e(\u003c/span\u003e1-port\u003cspan class=\"o\"\u003e)\u003c/span\u003e converter now attached to ttyUSB2\n\u003cspan class=\"o\"\u003e[\u003c/span\u003e  8.069918\u003cspan class=\"o\"\u003e]\u003c/span\u003e usb 1-1.3: GSM modem \u003cspan class=\"o\"\u003e(\u003c/span\u003e1-port\u003cspan class=\"o\"\u003e)\u003c/span\u003e converter now attached to ttyUSB3\n\u003cspan class=\"o\"\u003e[\u003c/span\u003e  8.084378\u003cspan class=\"o\"\u003e]\u003c/span\u003e usb 1-1.3: GSM modem \u003cspan class=\"o\"\u003e(\u003c/span\u003e1-port\u003cspan class=\"o\"\u003e)\u003c/span\u003e converter now attached to ttyUSB4\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003elsusb\nBus \u003cspan class=\"m\"\u003e001\u003c/span\u003e Device 005: ID 12d1:15c1 Huawei Technologies Co., Ltd. ME906s LTE M.2 Module\nBus \u003cspan class=\"m\"\u003e001\u003c/span\u003e Device 004: ID 05e3:0608 Genesys Logic, Inc. Hub\nBus \u003cspan class=\"m\"\u003e001\u003c/span\u003e Device 002: ID 8087:07e6 Intel Corp. \nBus \u003cspan class=\"m\"\u003e001\u003c/span\u003e Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e2.新建拨号脚本文件夹\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003emkdir /etc/ppp/peers/\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e3.拨号的脚本\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003evim /etc/ppp/peers/gprsdial\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"c1\"\u003e# This is pppd script for China Mobile, used Huawei GTM900-B GPRS Module\u003c/span\u003e\n\n/dev/ttyUSB0\n\u003cspan class=\"m\"\u003e9600\u003c/span\u003e\ncrtscts\nmodem\n\u003cspan class=\"c1\"\u003e#noauth\u003c/span\u003e\ndebug\nnodetach\n\u003cspan class=\"c1\"\u003e#hide-password\u003c/span\u003e\nusepeerdns\nnoipdefault\ndefaultroute\nuser \u003cspan class=\"s2\"\u003e\u0026#34;cmnet\u0026#34;\u003c/span\u003e\n0.0.0.0:0.0.0.0\n\u003cspan class=\"c1\"\u003e#ipcp-accept-local\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e#ipcp-accept-remote\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e#lcp-echo-failure 12\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e#lcp-echo-interval 3\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e#noccp\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e#novj\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e#novjccomp\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e#persist\u003c/span\u003e\nconnect \u003cspan class=\"s1\"\u003e\u0026#39;/usr/sbin/chat -s -v -f /etc/ppp/gprs-connect-chat\u0026#39;\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e#disconnect \u0026#39;/bin/chat -v -f /etc/ppp/gprs-disconnect-chat\u0026#39;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e4.校验文本/etc/ppp/gprs-connect-chat的具体内容如下：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003evim /etc/ppp/gprs-connect-chat\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"c1\"\u003e#Chat script for China Mobile, used Huawei ME906s LTE M.2 Module.\u003c/span\u003e\n\nTIMEOUT \u003cspan class=\"m\"\u003e15\u003c/span\u003e\nABORT \u003cspan class=\"s2\"\u003e\u0026#34;DELAYED\u0026#34;\u003c/span\u003e\nABORT \u003cspan class=\"s2\"\u003e\u0026#34;BUSY\u0026#34;\u003c/span\u003e\nABORT \u003cspan class=\"s2\"\u003e\u0026#34;ERROR\u0026#34;\u003c/span\u003e\nABORT \u003cspan class=\"s2\"\u003e\u0026#34;NO DIALTONE\u0026#34;\u003c/span\u003e\nABORT \u003cspan class=\"s2\"\u003e\u0026#34;NO CARRIER\u0026#34;\u003c/span\u003e\nTIMEOUT \u003cspan class=\"m\"\u003e40\u003c/span\u003e\n\u003cspan class=\"s1\"\u003e\u0026#39;\u0026#39;\u003c/span\u003e \u003cspan class=\"se\"\u003e\\r\u003c/span\u003eAT\nOK \u003cspan class=\"nv\"\u003eATS0\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\nOK ATE0V1\nOK AT+CGDCONT\u003cspan class=\"o\"\u003e=\u003c/span\u003e1,\u003cspan class=\"s2\"\u003e\u0026#34;IP\u0026#34;\u003c/span\u003e,\u003cspan class=\"s2\"\u003e\u0026#34;CMNET\u0026#34;\u003c/span\u003e\nOK AT+CGEQREQ\u003cspan class=\"o\"\u003e=\u003c/span\u003e1,2,128,384,,,0,,,,,,\nOK ATDT*99*1#\nCONNECT\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e5.拨号验证（两种方式效果相同）：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003epppd call gprsdial \u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e\n或\npppd file /etc/ppp/peers/gprsdial \u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e6.编写拨号脚本，一键拨号，获取DNS\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003evim gprs_dialup.sh\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"cp\"\u003e#!/bin/sh\n\u003c/span\u003e\u003cspan class=\"cp\"\u003e\u003c/span\u003e\u003cspan class=\"nv\"\u003edns1\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34; \u0026#34;\u003c/span\u003e\n\u003cspan class=\"nv\"\u003edns2\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34; \u0026#34;\u003c/span\u003e\n\u003cspan class=\"nb\"\u003ecd\u003c/span\u003e /etc/ppp/peers\npppd call gprsdial \u0026gt;/dev/null \u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e\n\u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;pppd ok\u0026#34;\u003c/span\u003e\nsleep \u003cspan class=\"m\"\u003e12\u003c/span\u003e\n\u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;sleep ok\u0026#34;\u003c/span\u003e\ncp -rf /run/ppp/resolv.conf /etc/\nsed -n \u003cspan class=\"s1\"\u003e\u0026#39;1p\u0026#39;\u003c/span\u003e /etc/resolv.conf \u0026gt; /etc/ppp/primarydns\nsed -n \u003cspan class=\"s1\"\u003e\u0026#39;2p\u0026#39;\u003c/span\u003e /etc/resolv.conf \u0026gt; /etc/ppp/seconddns\n\u003cspan class=\"nv\"\u003edns1\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"sb\"\u003e`\u003c/span\u003ecut -f \u003cspan class=\"m\"\u003e2\u003c/span\u003e -d \u003cspan class=\"s1\"\u003e\u0026#39; \u0026#39;\u003c/span\u003e /etc/ppp/primarydns\u003cspan class=\"sb\"\u003e`\u003c/span\u003e\n\u003cspan class=\"nv\"\u003edns2\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"sb\"\u003e`\u003c/span\u003ecut -f \u003cspan class=\"m\"\u003e2\u003c/span\u003e -d \u003cspan class=\"s1\"\u003e\u0026#39; \u0026#39;\u003c/span\u003e /etc/ppp/seconddns\u003cspan class=\"sb\"\u003e`\u003c/span\u003e\n\u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"nv\"\u003e$dns1\u003c/span\u003e\n\u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"nv\"\u003e$dns2\u003c/span\u003e\n\u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;dns ok\u0026#34;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003chr\u003e\n\u003cp\u003egprsdial参数详情\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"c1\"\u003e# This is pppd script for China Mobile, used Huawei GTM900-B GPRS Module\u003c/span\u003e\n\n/dev/ttyUSB0  \u003cspan class=\"c1\"\u003e#端口名称Modem port for ppp-dial\u003c/span\u003e\n\n\u003cspan class=\"m\"\u003e9600\u003c/span\u003e  \u003cspan class=\"c1\"\u003e#通信波特率\u003c/span\u003e\n\ncrtscts  \u003cspan class=\"c1\"\u003e#接口带硬件流控  nocrtscts(无流控制)\u003c/span\u003e\n\nmodem  \u003cspan class=\"c1\"\u003e#使用数据机控制线路。这个选项是默认的。硬体流控，pppd将等待CD信号。\u003c/span\u003e\n\nnoauth  \u003cspan class=\"c1\"\u003e#不需要对方验证自己\u003c/span\u003e\n\ndebug  \u003cspan class=\"c1\"\u003e#把调试信息输出到/var/log/messages\u003c/span\u003e\n\nnodetach  \u003cspan class=\"c1\"\u003e#不后台运行，默认是后台运行的\u003c/span\u003e\n\nhide-password  \u003cspan class=\"c1\"\u003e#写log内容时不包括密码字符串，这个参数是默认的\u003c/span\u003e\n\nusepeerdns  \u003cspan class=\"c1\"\u003e#选中这个选项，从对方请求两个DNS地址. 对方提供的地址传给文件/etc/ppp/ip-up中的环境变量DNS1和DNS2,将环境变量USEPEERDNS设置成1. 而且pppd将创建一个文件/etc/ppp/resolv.conf file，其中一个或两个服务器行包括由对方提供的地址。\u003c/span\u003e\n\nnoipdefault  \u003cspan class=\"c1\"\u003e#关闭在没有指定本地IP位址时所进行的预设动作，这是用来由从主机名称决定（如果可能的话）本地IP位址。加上这个选项的话，彼端将必须在进行IPCP协商时（除非在指令行或在选项档中明确地指定它）提供本地的IP地址。\u003c/span\u003e\n\ndefaultroute      \u003cspan class=\"c1\"\u003e#当 IPCP 协商完全成功时， 增加一个预设递送路径到系统的递送表，将彼端当作闸道器使用。这个项目在 ppp 连线中断後会移除。\u003c/span\u003e\n\nrefuse-chap       \u003cspan class=\"c1\"\u003e#外置模块刷新DNS\u003c/span\u003e\n\nrefuse-mschap\n\nrefuse-mschap-v2 \n\nuser \u003cspan class=\"s2\"\u003e\u0026#34;cmnet\u0026#34;\u003c/span\u003e      \u003cspan class=\"c1\"\u003e#用户，中国移动。设置由对方验证本地系统的用户名。\u003c/span\u003e\n\n0.0.0.0:0.0.0.0\n\nipcp-accept-local      \u003cspan class=\"c1\"\u003e#加上这个选项的话，pppd将会接受彼端对於本地IP位址的意见，即使本地的IP位址已经在某个选项中指定。\u003c/span\u003e\n\nipcp-accept-remote\t\t\u003cspan class=\"c1\"\u003e#加上这个选项的话，pppd将会接受彼端对於它的IP位址的意见，即使远端的IP位址已经在某个选项中指定。\u003c/span\u003e\n\nlcp-echo-failure 12\t\u003cspan class=\"c1\"\u003e#如果有给这个选项，那麽如果传送n个LCP回应要求没有接收到有效的LCP回应回覆的话pppd将会推测彼端是死掉的。如果发生这种情形，pppd将会终结该连线。这个选项的使用要求一个非零的lcp-echo-interval参数值。这个选项可以用在硬体数据机控制线路无法使用的情况下当实际连线被中断之後（e.g.,数据机已经挂断）终结 pppd的执行。\u003c/span\u003e\n\nlcp-echo-interval 3\t\u003cspan class=\"c1\"\u003e#如果有给这个选项，pppd每秒将会送出一个LCP回应要求(echo-request)封包(frame)给彼端。在Linux系统下，回应要求在n秒内没有从彼端接收到封包时会被送出。一般彼端应该以传送一个回应回覆(echo-reply)来反应该回应要求。这个选项可以与lcp-echo-failure选项一起使用来侦测不再连线的彼端。\u003c/span\u003e\n\nnoccp\t\t\u003cspan class=\"c1\"\u003e#关闭压缩控制协议协商。若对方有漏洞会被来自PPPD的压缩控制协议协商请求干扰的情况下，需要设置该选项。\u003c/span\u003e\n\nnovj\t\t\u003cspan class=\"c1\"\u003e#选中这个选项，将关闭双方的Van Jacobson形式TCP/IP报文头压缩\u003c/span\u003e\n\nnovjccomp\t\u003cspan class=\"c1\"\u003e#选中这个选项，将关闭Van Jacobson形式TCP/IP报文头压缩中的连接ID压缩。Pppd将忽略来自VanJacobson形式压缩TCP/IP报文头中的连接ID字节，也不要求对方这样作。\u003c/span\u003e\n\npersist\t\u003cspan class=\"c1\"\u003e#连接中断后不退出，而是重新打开连接。\u003c/span\u003e\n\nconnect \u003cspan class=\"s1\"\u003e\u0026#39;/usr/sbin/chat -s -v -f /etc/ppp/gprs-connect-chat\u0026#39;\u003c/span\u003e  \u003cspan class=\"c1\"\u003e#拨号调用一个验证脚本，账号加密用的\u003c/span\u003e\n\ndisconnect \u003cspan class=\"s1\"\u003e\u0026#39;/bin/chat -v -f /etc/ppp/gprs-disconnect-chat\u0026#39;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003chr\u003e\n\u003cp\u003eReferences \u0026amp; Resources：\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://blog.csdn.net/heiniaoyuyouling/article/details/5694792\"\u003elinux环境下pppd gprs拨号上网总结\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://blog.csdn.net/zqixiao_09/article/details/52540887\"\u003e在ARM-linux上实现4G模块PPP拨号上网\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://blog.chinaunix.net/uid-31410005-id-5783842.html\"\u003eetc/ppp/gprs文件详解\u003c/a\u003e\u003c/p\u003e\n","date":1646797490,"description":"使用Huawei ME906s 4G模块pppoe拨号上网","fuzzywordcount":1800,"kind":"page","lang":"zh","lastmod":1646884096,"objectID":"ba498257bad3381c8ee0145eed465dce","publishdate":1646797490,"relpermalink":"/posts/centos8_pppoe_4g/","section":"posts","summary":"1.插上4G模块，虚拟出5个USB设备，通过以下命令查看是否","tags":["Linux"],"title":"CentOS8 pppoe 4G拨号","url":"https://ikuriko.github.io/posts/centos8_pppoe_4g/","wordcount":1702},{"categories":"posts","content":"\u003ch2 id=\"namespace-简介\"\u003eNameSpace 简介\u003c/h2\u003e\n\u003cp\u003eNetwork NameSpace：网络命名空间（名字空间），是 Linux 内核中隔离资源的一种特性，是实现 Linux 网络虚拟化的重要功能，它能创建多个隔离的网络空间，它们拥有独自的网络栈信息，包括网络设备接口、ipv4,v6 协议栈、路由表、防火墙规则、sockets 等。不管是虚拟机还是容器，运行的时候仿佛自己就在独立的网络中。\u003c/p\u003e\n\u003ch2 id=\"namespace-使用\"\u003eNameSpace 使用\u003c/h2\u003e\n\u003cp\u003e创建一个命名空间\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eip netns add netns1\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e创建的命名空间会在以下目录生成文件\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003els /var/run/netns/\nnetns1\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e对命名空间使用命令\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eip netns \u003cspan class=\"nb\"\u003eexec\u003c/span\u003e \u0026lt;ns-name\u0026gt; \u0026lt;cmd\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eExample：\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e通过bash进入network namespace 并更新命令行提示符\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eip netns \u003cspan class=\"nb\"\u003eexec\u003c/span\u003e netns1 bash\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e网络命名空间包含自己的网络资源：接口，路由表等。（默认添加的网络命名空间netns1中会自动添加一个loopback(回环)接口但需要手动开启）\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eip netns \u003cspan class=\"nb\"\u003eexec\u003c/span\u003e netns1 ip link \u003cspan class=\"nb\"\u003eset\u003c/span\u003e lo up\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eip netns \u003cspan class=\"nb\"\u003eexec\u003c/span\u003e netns1 ifconfig lo 127.0.0.1/32 up\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eip netns \u003cspan class=\"nb\"\u003eexec\u003c/span\u003e netns1 ping 127.0.0.1 -c \u003cspan class=\"m\"\u003e3\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e查看网络接口信息\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eip netns \u003cspan class=\"nb\"\u003eexec\u003c/span\u003e netns1 ip addr\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e添加路由\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eip netns \u003cspan class=\"nb\"\u003eexec\u003c/span\u003e netns1 ip route add 192.168.2.0/24 via 192.168.1.1 dev eth0\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e添加接口\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eip link \u003cspan class=\"nb\"\u003eset\u003c/span\u003e veth0 netns netns1\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e启动接口\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eip netns \u003cspan class=\"nb\"\u003eexec\u003c/span\u003e netns1 ip link \u003cspan class=\"nb\"\u003eset\u003c/span\u003e veth0 up \n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"namespace-连接方式\"\u003eNameSpace 连接方式\u003c/h2\u003e\n\u003cp\u003e在 Linux 内核中与 NameSpace 关联性较强的技术是 LXC 。LXC\u003csup id=\"fnref:1\"\u003e\u003ca href=\"#fn:1\" class=\"footnote-ref\" role=\"doc-noteref\"\u003e1\u003c/a\u003e\u003c/sup\u003e（Linux Container）是一种内核虚拟化技术，它可以提供轻量级的虚拟化服务，以便隔离系统进程和系统资源。Linux Container 技术使用 cgroups（control groups）和 namespace 实现。两者的功能如下：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eCgroups（资源限制）\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eNamespace（资源隔离）\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e在使用KVM（Kernel-based Virtual Machine）或LXC（Linux Container）时，典型的物理主机不会为KVM或每个容器中的虚拟机的每一个网口（NIC，network interface controller）提供一个或多个物理适配器，必须通过互连虚拟网络接口实现通信。这里使用的经典工具是 Linux 网桥（Linux bridge），它内置在 Linux 的内核中，非常古老，管理 Linux bridge 的前端管理工具是 brctl，能实现的功能类似二层交换机，功能非常有限。而较新的模拟工具是 OpenvSwitch，主要的前端管理是 ovs-vsctl，它能实现更多更复杂的功能。\u003c/p\u003e\n\u003cp\u003e因为使用 ip tuntap | ip link add 创建的 linux tap 接口不能用于将网络命名空间链接到 Linux bridges 或 openvswitch ，所以提供了以下的方法进行 namespace 的连接：\u003c/p\u003e\n\u003ch3 id=\"veth-pair\"\u003eveth pair\u003c/h3\u003e\n\u003cp\u003e连接两个网络命名空间的简单解决方案是使用一对 veth 接口，veth pair(一对虚拟网口)\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/ns/ns1.png\" alt=\"ns1.jpg\"\u003e\u003c/p\u003e\n\u003cp\u003e使用 veth 连接 namespaces\u003c/p\u003e\n\u003cp\u003e新建命名空间\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eip netns add ns1\nip netns add ns2\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e创建 veth pair\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eip link add veth0 \u003cspan class=\"nb\"\u003etype\u003c/span\u003e veth peer name veth1\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e连接命名空间的端口,加入 veth-pair\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eip link \u003cspan class=\"nb\"\u003eset\u003c/span\u003e veth0 netns ns1\nip link \u003cspan class=\"nb\"\u003eset\u003c/span\u003e veth1 netns ns2\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e启动连接\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eip netns \u003cspan class=\"nb\"\u003eexec\u003c/span\u003e ns1 ip link \u003cspan class=\"nb\"\u003eset\u003c/span\u003e dev veth0 up\nip netns \u003cspan class=\"nb\"\u003eexec\u003c/span\u003e ns2 ip link \u003cspan class=\"nb\"\u003eset\u003c/span\u003e dev veth1 up\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"linux-bridge-和-2个-veth-pair\"\u003eLinux bridge 和 2个 veth pair\u003c/h3\u003e\n\u003cp\u003e当必须连接两个以上的网络命名空间（Netns或KVM或LXC实例）时，应使用虚拟交换机。Linux 提供了众所周知的Linux 网桥作为一种解决方案\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/ns/ns2.png\" alt=\"ns2.jpg\"\u003e\u003c/p\u003e\n\u003cp\u003e使用 Linux 网桥和两个 veth pair连接网络命名空间\u003c/p\u003e\n\u003cp\u003e对于此种设置，我们需要一个交换机和两条连接线（虚拟意义上的）。使用一个 Linux bridge 和两个 veth pair\u003c/p\u003e\n\u003cp\u003e添加命名空间\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eip netns add ns1\nip netns add ns2\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e创建Linux 网桥\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003ebrctl addbr \u003cspan class=\"nv\"\u003e$BRIDGE\u003c/span\u003e\nbrctl stp \u003cspan class=\"nv\"\u003e$BRIDGE\u003c/span\u003e off\nip link \u003cspan class=\"nb\"\u003eset\u003c/span\u003e dev \u003cspan class=\"nv\"\u003e$BRIDGE\u003c/span\u003e up\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e端口 port 1\u003c/p\u003e\n\u003cp\u003e创建一个 veth 端口对\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eip link add veth0 \u003cspan class=\"nb\"\u003etype\u003c/span\u003e veth peer name br-veth0\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e一边加入 Linux 网桥\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003ebrctl addif br-test br-veth0\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e另一边加入命名空间\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eip link \u003cspan class=\"nb\"\u003eset\u003c/span\u003e veth0 netns ns1\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e开启连接\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eip netns \u003cspan class=\"nb\"\u003eexec\u003c/span\u003e ns1 ip link \u003cspan class=\"nb\"\u003eset\u003c/span\u003e dev veth0 up\nip link \u003cspan class=\"nb\"\u003eset\u003c/span\u003e dev br-veth0 up\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e端口 port 2\u003c/p\u003e\n\u003cp\u003e创建一个 veth 端口对\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eip link add veth1 \u003cspan class=\"nb\"\u003etype\u003c/span\u003e veth peer name br-veth1\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e一边加入 Linux 网桥\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003ebrctl addif br-test br-veth1\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e另一边加入命名空间\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eip link \u003cspan class=\"nb\"\u003eset\u003c/span\u003e veth1 netns ns2\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e开启连接\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eip netns \u003cspan class=\"nb\"\u003eexec\u003c/span\u003e ns2 ip link \u003cspan class=\"nb\"\u003eset\u003c/span\u003e dev veth1 up\nip link \u003cspan class=\"nb\"\u003eset\u003c/span\u003e dev br-verh1 up\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"openvswitch-和-2-个-veth-pair\"\u003eOpenvSwitch 和 2 个 veth pair\u003c/h3\u003e\n\u003cp\u003e另一种解决方案是使用 openvswitch 而不是旧的 Linux bridge。配置与 Linux bridge 相同\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/ns/ns3.png\" alt=\"ns3.jpg\"\u003e\u003c/p\u003e\n\u003cp\u003e使用 ovs 和 2 个 veth pair 连接 namespaces\u003c/p\u003e\n\u003cp\u003e对于此设置，需要一个交换机和两条连接线（虚拟意义上的）。使用一个 ovs 网桥和两个 veth pair\u003c/p\u003e\n\u003cp\u003e添加命名空间\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eip netns add ns1\nip netns add ns2\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e创建ovs网桥\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eovs-vsctl add-br \u003cspan class=\"nv\"\u003e$BRIDGE\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e端口 port 1\u003c/p\u003e\n\u003cp\u003e创建一个veth端口对\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eip link add veth0 \u003cspan class=\"nb\"\u003etype\u003c/span\u003e veth peer name ovs-veth0\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e一边端口加入 ovs 网桥\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eovs-vsctl add-port \u003cspan class=\"nv\"\u003e$BRIDGE\u003c/span\u003e ovs-veth0\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e另一端端口加入命名空间\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eip link \u003cspan class=\"nb\"\u003eset\u003c/span\u003e veth0 netns ns1\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e开启连接\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eip netns \u003cspan class=\"nb\"\u003eexec\u003c/span\u003e ns1 ip link \u003cspan class=\"nb\"\u003eset\u003c/span\u003e dev veth0 up\nip link \u003cspan class=\"nb\"\u003eset\u003c/span\u003e dev ovs-veth0 up\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e端口 port 2\u003c/p\u003e\n\u003cp\u003e创建一个 veth 端口对\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eip link add veth1 \u003cspan class=\"nb\"\u003etype\u003c/span\u003e veth peer name ovs-veth1\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e一边端口加入 ovs 网桥\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eovs-vsctl add-port \u003cspan class=\"nv\"\u003e$BRIDGE\u003c/span\u003e ovs-veth1\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e另一端端口加入命名空间\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eip link \u003cspan class=\"nb\"\u003eset\u003c/span\u003e veth1 netns ns2\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e开启连接\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eip netns \u003cspan class=\"nb\"\u003eexec\u003c/span\u003e ns2 ip link \u003cspan class=\"nb\"\u003eset\u003c/span\u003e dev veth1 up\nip link \u003cspan class=\"nb\"\u003eset\u003c/span\u003e dev ovs-veth1 up\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"openvswitch-和-2-个-openvswitch-端口\"\u003eOpenvSwitch 和 2 个 OpenvSwitch 端口\u003c/h3\u003e\n\u003cp\u003e另一种解决方案是使用 openvswitch 并利用 openvswitch 内部端口。这避免了必须在所有其他解决方案中使用的veth pair 的使用\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/ns/ns4.png\" alt=\"ns4.jpg\"\u003e\u003c/p\u003e\n\u003cp\u003e使用 openvswtich 和 2 个 openvswitch  端口连接 namespaces\u003c/p\u003e\n\u003cp\u003e对于此设置，需要一个交换机和两条连接线（虚拟意义上的）。使用一个 openvswitch 和两个 openvswitch 端口\u003c/p\u003e\n\u003cp\u003e添加命名空间\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eip netns add ns1\nip netns add ns2\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e创建 ovs 网桥\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eovs-vsctl add-br \u003cspan class=\"nv\"\u003e$BRIDGE\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e端口 port 1\n创建 ovs 内部端口\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eovs-vsctl add-port \u003cspan class=\"nv\"\u003e$BRIDGE\u003c/span\u003e tap1 --set interface tap1 \u003cspan class=\"nv\"\u003etype\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003einternal\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e把它加到命名空间\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eip link \u003cspan class=\"nb\"\u003eset\u003c/span\u003e tap1 netns ns1\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e启动连接\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eip netns \u003cspan class=\"nb\"\u003eexec\u003c/span\u003e ns1 ip link \u003cspan class=\"nb\"\u003eset\u003c/span\u003e dev tap1 up\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e端口 port 2\n创建 ovs 内部端口\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eovs-vsctl add-port \u003cspan class=\"nv\"\u003e$BRIDGE\u003c/span\u003e tap2 --set interface tap2 \u003cspan class=\"nv\"\u003etype\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003einternal \n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e把它加到命名空间\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eip link \u003cspan class=\"nb\"\u003eset\u003c/span\u003e tap2 netns ns2\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e启动连接\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eip netns \u003cspan class=\"nb\"\u003eexec\u003c/span\u003e ns2 ip link \u003cspan class=\"nb\"\u003eset\u003c/span\u003e dev tap2 up\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003chr\u003e\n\u003csection class=\"footnotes\" role=\"doc-endnotes\"\u003e\n\u003chr\u003e\n\u003col\u003e\n\u003cli id=\"fn:1\" role=\"doc-endnote\"\u003e\n\u003cp\u003eLinux container技术的目标是为应用程序或系统提供完整的资源隔离和控制。LXC项目通过提供一组API接口和工具，可以让其他程序方便地使用Linux container技术。\u0026#160;\u003ca href=\"#fnref:1\" class=\"footnote-backref\" role=\"doc-backlink\"\u003e\u0026#x21a9;\u0026#xfe0e;\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/section\u003e\n","date":1645512630,"description":"","fuzzywordcount":1900,"kind":"page","lang":"zh","lastmod":1646884179,"objectID":"9b3d6ae7053443db7184fa0610f53470","publishdate":1645512630,"relpermalink":"/posts/namespace/","section":"posts","summary":"NameSpace 简介 Network NameSpace：网络命名空间（名字空间），是 Linux 内","tags":["Linux","Namespace"],"title":"Network NameSpace","url":"https://ikuriko.github.io/posts/namespace/","wordcount":1888},{"categories":"posts","content":"\u003ch2 id=\"简介\"\u003e简介\u003c/h2\u003e\n\u003cp\u003eWireGuard 利用最新的加密技术，提供更快、更精简、更安全、易于部署、方便管理的通用VPN，可以在低端到高端设备上部署。\u003c/p\u003e\n\u003cp\u003e仅 4000 行代码的精简代码库。将它与 OpenVPN（另一个流行的开源 VPN）的 100,000 行代码相比。显然调试 WireGuard 更加容易。\u003c/p\u003e\n\u003cp\u003e支持所有最新的加密技术，例如 Noise 协议框架、Curve25519、ChaCha20、Poly1305、BLAKE2、SipHash24、HKDF 和安全受信任结构。\u003c/p\u003e\n\u003cp\u003e运行在内核空间，因此可以高速的提供安全的网络。\u003c/p\u003e\n\u003ch2 id=\"安装\"\u003e安装\u003c/h2\u003e\n\u003cp\u003e添加软件包仓库源\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eyum install epel-release elrepo-release yum-plugin-elrepo -y\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e安装WireGuard及相关依赖包\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eyum install kmod-wireguard wireguard-tools qrencode -y\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"ipv4模式\"\u003eIPv4模式\u003c/h2\u003e\n\u003ch3 id=\"服务端配置server\"\u003e服务端配置（Server）\u003c/h3\u003e\n\u003cp\u003e\u003cstrong\u003e创建wireguard接口\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e生成server端公钥（publickey）和私钥（privatekey）（类似SSH）\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003ewg genkey \u003cspan class=\"p\"\u003e|\u003c/span\u003e tee ./test_server.pri \u003cspan class=\"p\"\u003e|\u003c/span\u003e wg pubkey \u0026gt; ./test_server.pub\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e创建wg0接口\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eip link add wg0 \u003cspan class=\"nb\"\u003etype\u003c/span\u003e wireguard\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e启动接口设置监听的端口和私钥\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003ewg \u003cspan class=\"nb\"\u003eset\u003c/span\u003e wg0 listen-port \u003cspan class=\"m\"\u003e42333\u003c/span\u003e private-key ./test_server.pri\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e配置IP地址\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eip addr add 198.18.233.1/24 dev wg0\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cstrong\u003e添加客户端\u003c/strong\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eWireGuard没有明确的服务端和客户端的定义，他们是对等的一对peer，这里为了方便理解，模拟了一台服务器和一台PC机的账号创建。将服务器命名为client1，终端设备PC命名为client2。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e为client1（另一台服务端）生成公钥和私钥\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003ewg genkey \u003cspan class=\"p\"\u003e|\u003c/span\u003e tee ./test_client1.pri \u003cspan class=\"p\"\u003e|\u003c/span\u003e wg pubkey \u0026gt; ./test_client1.pub\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e为client2（终端设备）生成客户端的公钥和私钥\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003ewg genkey \u003cspan class=\"p\"\u003e|\u003c/span\u003e tee ./test_client2.pri \u003cspan class=\"p\"\u003e|\u003c/span\u003e wg pubkey \u0026gt; ./test_client2.pub\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e查看客户端的公钥和私钥，之后配置需使用\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003ecat ./test_client\u003cspan class=\"o\"\u003e[\u003c/span\u003e1/2\u003cspan class=\"o\"\u003e]\u003c/span\u003e.\u003cspan class=\"o\"\u003e[\u003c/span\u003epub/pri\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e在Server端添加client1的peer公钥和允许的IP\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003ewg \u003cspan class=\"nb\"\u003eset\u003c/span\u003e wg0 peer \u003cspan class=\"k\"\u003e$(\u003c/span\u003ecat ./test_client1.pub\u003cspan class=\"k\"\u003e)\u003c/span\u003e allowed-ips 198.18.233.2/32\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e在Server端添加client2的peer公钥和允许的IP\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003ewg \u003cspan class=\"nb\"\u003eset\u003c/span\u003e wg0 peer \u003cspan class=\"k\"\u003e$(\u003c/span\u003ecat ./test_client2.pub\u003cspan class=\"k\"\u003e)\u003c/span\u003e allowed-ips 198.18.233.3/32\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cstrong\u003e保存配置\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e新建wg0配置文件\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003etouch /etc/wireguard/wg0.conf\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e保存wg0配置\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003ewg-quick save wg0\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cstrong\u003e启用接口\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e启动接口（有配置文件的接口才能使用）\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003ewg-quick up wg0\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e关闭接口（同上）\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003ewg-quick down wg0\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e开机自启动wg0\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003esystemctl \u003cspan class=\"nb\"\u003eenable\u003c/span\u003e wg-quick@wg0.service\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"客户端配置client1\"\u003e客户端配置（Client1）\u003c/h3\u003e\n\u003cp\u003e创建wireguard接口\u003c/p\u003e\n\u003cp\u003e配置client1的私钥、server的公钥、允许的IP、服务端的IP和端口号\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003ewg \u003cspan class=\"nb\"\u003eset\u003c/span\u003e wg0 private-key \u003cspan class=\"k\"\u003e$(\u003c/span\u003etest_client1.pri\u003cspan class=\"k\"\u003e)\u003c/span\u003e peer \u003cspan class=\"k\"\u003e$(\u003c/span\u003etest_server.pub\u003cspan class=\"k\"\u003e)\u003c/span\u003e persistent-keepalive \u003cspan class=\"m\"\u003e1\u003c/span\u003e allowed-ips 0.0.0.0/0 endpoint server_ip:server_port\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e创建wg0接口\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eip link add wg0 \u003cspan class=\"nb\"\u003etype\u003c/span\u003e wireguard\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e配置IP地址\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eip addr add 198.18.233.2/24 dev wg0\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e添加默认路由\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eip ro add default via 198.18.233.1\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eSNAT策略（如有必要）\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eiptables -t nat -A POSTROUTING -o wg0 -j SNAT --to-source 198.18.233.2\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"终端设备配置client2\"\u003e终端设备配置（Client2）\u003c/h3\u003e\n\u003cp\u003eclient2的配置文件\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"c1\"\u003e#test_client.conf\u003c/span\u003e\n\u003cspan class=\"o\"\u003e[\u003c/span\u003eInterface\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003cspan class=\"nv\"\u003ePrivateKey\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e 0KyR/4U48Xzyfhqxa76UNHgrGg0TSLaATctaVwFSQxQe2ls\u003cspan class=\"o\"\u003e=\u003c/span\u003e    \u003cspan class=\"c1\"\u003e#test_client2.pri\u003c/span\u003e\n\u003cspan class=\"nv\"\u003eAddress\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e 198.18.233.3/32\n\u003cspan class=\"nv\"\u003eDNS\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e 8.8.8.8\n\u003cspan class=\"nv\"\u003eMTU\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e1420\u003c/span\u003e\n\u003cspan class=\"o\"\u003e[\u003c/span\u003ePeer\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003cspan class=\"nv\"\u003ePublicKey\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nv\"\u003e2Cg4wDfeiYnc2dhxW99y7nlmKROR5zfxB2hFtjBmi4aoMjFo\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e    \u003cspan class=\"c1\"\u003e#test_server.pub\u003c/span\u003e\n\u003cspan class=\"nv\"\u003eEndpoint\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e 213.55.77.88:54233\n\u003cspan class=\"nv\"\u003eAllowedIPs\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e 198.18.233.0/24\n\u003cspan class=\"nv\"\u003ePersistentKeepalive\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e#可以用配置文件生成二维码\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eqrencode -o test_client.png \u0026lt; test_client.conf\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"ipv6模式\"\u003eIPv6模式\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003eWireguard使用IPv6的配置与IPv4并无太大差异，这里只做简单演示\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch3 id=\"服务端配置server-1\"\u003e服务端配置（Server）\u003c/h3\u003e\n\u003cp\u003e\u003cstrong\u003e创建wireguard接口\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e生成server端公钥（publickey）和私钥（privatekey）（类似SSH）\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003ewg genkey \u003cspan class=\"p\"\u003e|\u003c/span\u003e tee ./test_server.pri \u003cspan class=\"p\"\u003e|\u003c/span\u003e wg pubkey \u0026gt; ./test_server.pub\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e创建wg1接口\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eip link add wg1 \u003cspan class=\"nb\"\u003etype\u003c/span\u003e wireguard\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e启动接口设置监听的端口和私钥\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003ewg \u003cspan class=\"nb\"\u003eset\u003c/span\u003e wg1 listen-port \u003cspan class=\"m\"\u003e42333\u003c/span\u003e private-key ./test_server.pri\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e配置IP地址\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eifconfig wg1 inet6 add fec0:1001:1001:1001:1001:1001:1234:0001/112\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e启用接口\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eip link \u003cspan class=\"nb\"\u003eset\u003c/span\u003e wg1 up\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cstrong\u003e添加客户端\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e为client生成客户端的公钥和私钥\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003ewg genkey \u003cspan class=\"p\"\u003e|\u003c/span\u003e tee ./test_client3.pri \u003cspan class=\"p\"\u003e|\u003c/span\u003e wg pubkey \u0026gt; ./test_client3.pub\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e查看客户端的公钥和私钥，之后配置需使用\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003ecat ./test_client3.\u003cspan class=\"o\"\u003e[\u003c/span\u003epub/pri\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e在Server端添加client3的peer公钥和允许的IP\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003ewg \u003cspan class=\"nb\"\u003eset\u003c/span\u003e wg1 peer allowed-ips fec0:1001:1001:1001:1001:1001:1234:0002/128\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"客户端配置client3\"\u003e客户端配置（Client3）\u003c/h3\u003e\n\u003cp\u003e创建wg1接口\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eip link add wg1 \u003cspan class=\"nb\"\u003etype\u003c/span\u003e wireguard\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e配置client3的私钥、server的公钥、允许的IP、服务端的IP和端口号\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003ewg \u003cspan class=\"nb\"\u003eset\u003c/span\u003e wg1 private-key \u003cspan class=\"k\"\u003e$(\u003c/span\u003etest_client3.pri\u003cspan class=\"k\"\u003e)\u003c/span\u003e peer \u003cspan class=\"k\"\u003e$(\u003c/span\u003etest_server.pub\u003cspan class=\"k\"\u003e)\u003c/span\u003e persistent-keepalive \u003cspan class=\"m\"\u003e1\u003c/span\u003e allowed-ips 0:0:0:0:0:0:0:0/0 endpoint server_ip:server_port\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e配置IP地址\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eifconfig wg1 inet6 add fec0:1001:1001:1001:1001:1001:1234:0002/112\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e启用wg1接口\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eip link \u003cspan class=\"nb\"\u003eset\u003c/span\u003e wg1 up\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e添加默认路由\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eip -6 ro add default via fec0:1001:1001:1001:1001:1001:1234:0001\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eSNAT策略（如有必要）\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eip6tables -t nat -A POSTROUTING -o wg1 -j SNAT --to-source fec0:1001:1001:1001:1001:1001:1234:0002\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","date":1640916404,"description":"WireGuard 是一个简单、快速且安全的开源VPN软件","fuzzywordcount":1400,"kind":"page","lang":"zh","lastmod":1646884829,"objectID":"b7f41f99ac098dcc65b2dca934a99b01","publishdate":1640916404,"relpermalink":"/posts/wireguard/","section":"posts","summary":"简介 WireGuard 利用最新的加密技术，提供更快、更精简、更安全、易于部署","tags":["Linux","VPN"],"title":"WireGuard","url":"https://ikuriko.github.io/posts/wireguard/","wordcount":1342},{"categories":"posts","content":"\u003ch2 id=\"设置系统时区\"\u003e设置系统时区\u003c/h2\u003e\n\u003cp\u003e查看时区\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003etimedatectl\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e选择时区\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003etimedatectl set-timezone Asia/Shanghai\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e手动设置时间\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003etimedatectl set-time \u003cspan class=\"s2\"\u003e\u0026#34;2022-02-22 09:00:00\u0026#34;\u003c/span\u003e\ndate -s \u003cspan class=\"s2\"\u003e\u0026#34;2022-02-22 09:00:00\u0026#34;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e创建软连接设置本地时间\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"chronyd服务\"\u003eChronyd服务\u003c/h2\u003e\n\u003cp\u003e要与任意主机进行同步时\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u0026quot;CentOS 8\u0026quot;需要安装 chronyd 服务\u003c/li\u003e\n\u003cli\u003e\u0026quot;CentOS 7\u0026quot;执行\u003ccode\u003entpdate ntp.aliyun.com\u003c/code\u003e即可同步\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e安装Chronyd服务\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eyum -y install chrony\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e添加需要同步的主机\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003evim /etc/chrony.conf\n+ server ntp.aliyun.com iburst\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e重启服务\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003esystemctl restart chronyd\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e立即同步\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003echronyc sources -v\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e开启时间自动同步\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003etimedatectl set-ntp \u003cspan class=\"nb\"\u003etrue\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","date":1640327297,"description":"CentOS 系统安装过程中，会有选择时区的步骤。如果时区设置有误，可能导致系统时间与本地时间不同步。使得一些应用程序的时间戳发生错乱，出现各种报错。","fuzzywordcount":200,"kind":"page","lang":"zh","lastmod":1646884090,"objectID":"9aa01063c13d35adac57534dece5ac53","publishdate":1640327297,"relpermalink":"/posts/centos8_ntp/","section":"posts","summary":"设置系统时区 查看时区 timedatectl 选择时区 timedatectl set-timezone Asia/Shanghai 手动设置时间 timedatectl set-time \u0026#34;2022-02-22 09:00:00\u0026#34; date -s","tags":["Linux"],"title":"CentOS8 时间同步","url":"https://ikuriko.github.io/posts/centos8_ntp/","wordcount":172},{"categories":"posts","content":"\u003ch2 id=\"preparation\"\u003ePreparation\u003c/h2\u003e\n\u003cp\u003e操作的系统环境：CentOS 8.4.2105\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003ecat /etc/redhat-release \nCentOS Linux release 8.4.2105\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003euname -r\n4.18.0-348.el8.x86_64\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eOvs软件包版本：openvswitch-2.16.1.tar.gz\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003ewget https://www.openvswitch.org/releases/openvswitch-2.16.1.tar.gz\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e官网下载地址：https://www.openvswitch.org/releases/openvswitch-2.16.1.tar.gz\u003c/p\u003e\n\u003ch2 id=\"build-requirements\"\u003eBuild Requirements\u003c/h2\u003e\n\u003cp\u003e安装 RPM 工具和通用构建依赖项\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003ednf install @\u003cspan class=\"s1\"\u003e\u0026#39;Development Tools\u0026#39;\u003c/span\u003e rpm-build dnf-plugins-core\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e解压软件包\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003etar -zxvf openvswitch-2.16.1.tar.gz -C /usr/local/\n\u003cspan class=\"nb\"\u003ecd\u003c/span\u003e openvswitch-2.16.1/\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e安装 Open vSwitch 特定的构建依赖项。依赖项在 SPEC 文件中列出，首先需要将 VERSION 标记替换为有效的 SPEC。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003esed -e \u003cspan class=\"s1\"\u003e\u0026#39;s/@VERSION@/0.0.1/\u0026#39;\u003c/span\u003e rhel/openvswitch-fedora.spec.in  \u0026gt; /tmp/ovs.spec\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e启用powertools源，安装构建依赖的额外软件包\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003ednf --enablerepo\u003cspan class=\"o\"\u003e=\u003c/span\u003epowertools install python3-sphinx groff\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e安装 Open vSwitch 特定的构建依赖项。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003ednf builddep /tmp/ovs.spec\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"bootstraping\"\u003eBootstraping\u003c/h2\u003e\n\u003cp\u003e初始化，如果下载的是完整的tar包则不需要执行此命令，反之使用Git上的源代码来构建则需使用此命令以生成“configure”配置脚本\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e./boot.sh\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"configuring\"\u003eConfiguring\u003c/h2\u003e\n\u003cp\u003e进入软件包解压的目录\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"nb\"\u003ecd\u003c/span\u003e openvswitch-2.16.1/\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e使用默认配置\u003csup id=\"fnref:1\"\u003e\u003ca href=\"#fn:1\" class=\"footnote-ref\" role=\"doc-noteref\"\u003e1\u003c/a\u003e\u003c/sup\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e./configure\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"building\"\u003eBuilding\u003c/h2\u003e\n\u003cp\u003e构建Open vSwitch 用户空间 RPM\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003emake rpm-fedora\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e在openvswitch包中启用 DPDK 支持\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003ednf install dpdk-devel numactl-devel -y\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003ednf --enablerepo\u003cspan class=\"o\"\u003e=\u003c/span\u003epowertools install libpcap-devel libbpf-devel\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003emake rpm-fedora \u003cspan class=\"nv\"\u003eRPMBUILD_OPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;--with dpdk --without check\u0026#34;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e在openvswitch包中启用 AF_XDP 支持\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003emake rpm-fedora \u003cspan class=\"nv\"\u003eRPMBUILD_OPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;--with afxdp --without check\u0026#34;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e让上述命令自动运行 Open vSwitch 单元测试（可选）\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003emake rpm-fedora \u003cspan class=\"nv\"\u003eRPMBUILD_OPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;--with check\u0026#34;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e为当前运行的内核版本构建Open vSwitch 内核模块\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003emake rpm-fedora-kmod\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e为其他内核版本构建Open vSwitch 内核模块，可以通过kversion宏指定所需的内核版本\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003emake rpm-fedora-kmod \u003cspan class=\"nv\"\u003eRPMBUILD_OPT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;-D \u0026#34;kversion 4.3.4-300.fc23.x86_64\u0026#34;\u0026#39;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e新生成的RPM包的位置\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003els /usr/local/openvswitch/rpm/rpmbuild/RPMS/x86_64/\nnetwork-scripts-openvswitch-2.16.1-1.el8.x86_64.rpm  openvswitch-debugsource-2.16.1-1.el8.x86_64.rpm  openvswitch-kmod-2.16.1-1.el8.x86_64.rpm\nopenvswitch-2.16.1-1.el8.x86_64.rpm                  openvswitch-devel-2.16.1-1.el8.x86_64.rpm\nopenvswitch-debuginfo-2.16.1-1.el8.x86_64.rpm        openvswitch-ipsec-2.16.1-1.el8.x86_64.rpm\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e各个RPM包的作用\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003enetwork-scripts-openvswitch-2.16.1-1.el8.x86_64\n\u003cspan class=\"c1\"\u003e# 网络脚本，开放 vSwitch 传统网络服务支持，这提供了用于传统网络服务的 ifup 和 ifdown 脚本。\u003c/span\u003e\n\nopenvswitch-2.16.1-1.el8.x86_64\n\u003cspan class=\"c1\"\u003e# ovs 软件包本体，打开 vSwitch 守护进程/数据库/实用程序，Open vSwitch 提供标准的网络桥接功能并支持 OpenFlow 协议，以实现对流量的远程逐流控制。\u003c/span\u003e\n\nopenvswitch-debuginfo-2.16.1-1.el8.x86_64\n\u003cspan class=\"c1\"\u003e# ovs 调试信息，这个包提供了包 openvswitch 的调试信息。在开发使用此包的应用程序或调试此包时，调试信息很有用。\u003c/span\u003e\n\nopenvswitch-debugsource-2.16.1-1.el8.x86_64\n\u003cspan class=\"c1\"\u003e# ovs 调试源，此包为包 openvswitch 提供调试源。在开发使用此包的应用程序或调试此包时，调试源非常有用。\u003c/span\u003e\n\nopenvswitch-devel-2.16.1-1.el8.x86_64\n\u003cspan class=\"c1\"\u003e# ovs 开发环境包，Open vSwitch OpenFlow 开发包（库、头文件），这提供了构建外部应用程序所需的静态库、libopenswitch.a 和 openvswitch 头文件。\u003c/span\u003e\n\nopenvswitch-ipsec-2.16.1-1.el8.x86_64\n\u003cspan class=\"c1\"\u003e# ovs 对 vSwitch IPsec 隧道的支持，该软件包为 OVS 隧道提供 IPsec 隧道支持。\u003c/span\u003e\n\nopenvswitch-kmod-2.16.1-1.el8.x86_64\n\u003cspan class=\"c1\"\u003e# ovs 的内核模块，这个包内含有 ovs 内核模块。\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e打包构建完成的RPM软件包\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003etar -zcvf openvswitch-2.16.1-centos8.tar.gz /usr/local/openvswitch/rpm/rpmbuild/RPMS/x86_64/\n\nll -h\n-rw-r--r--. \u003cspan class=\"m\"\u003e1\u003c/span\u003e root root 9.6M 11月 \u003cspan class=\"m\"\u003e23\u003c/span\u003e 16:11 openvswitch-2.16.1-centos8.tar.gz\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"installing\"\u003eInstalling\u003c/h2\u003e\n\u003cp\u003e安装软件包的步骤\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003etar -zxvf openvswitch-2.16.1-centos-8.tar.gz\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"nb\"\u003ecd\u003c/span\u003e openvswitch-2.16.1-centos-8/\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eyum localinstall openvswitch-2.16.1-1.el8.x86_64.rpm openvswitch-devel-2.16.1-1.el8.x86_64.rpm\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003esystemctl start openvswitch\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003esystemctl \u003cspan class=\"nb\"\u003eenable\u003c/span\u003e openvswitch\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003chr\u003e\n\u003cp\u003eReferences \u0026amp; Resources\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://docs.openvswitch.org/en/latest/intro/install/fedora/?highlight=build%20openvswitch\"\u003eFedora, RHEL 7.x Packaging for Open vSwitch\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://cbs.centos.org/koji/buildinfo?buildID=30269\"\u003eInformation for build openvswitch-2.12.0-1.1.el8\u003c/a\u003e\u003c/p\u003e\n\u003csection class=\"footnotes\" role=\"doc-endnotes\"\u003e\n\u003chr\u003e\n\u003col\u003e\n\u003cli id=\"fn:1\" role=\"doc-endnote\"\u003e\n\u003cp\u003e一般情况下，使用默认配置即可，详情见官方文档：https://docs.openvswitch.org/en/latest/intro/install/general/#configuring\u0026#160;\u003ca href=\"#fnref:1\" class=\"footnote-backref\" role=\"doc-backlink\"\u003e\u0026#x21a9;\u0026#xfe0e;\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/section\u003e\n","date":1637655950,"description":"","fuzzywordcount":1100,"kind":"page","lang":"zh","lastmod":1646884205,"objectID":"5676506d0539a2e17a9ea798336e70fd","publishdate":1637655950,"relpermalink":"/posts/rhel8_packaging_for_openvswitch/","section":"posts","summary":"Preparation 操作的系统环境：CentOS 8.4.2105 cat /etc/redhat-release CentOS Linux release 8.4.2105 uname -r 4.18.0-348.el8.x86_64 Ovs软件","tags":["Linux"],"title":"RHEL8 Packaging for OpenvSwitch","url":"https://ikuriko.github.io/posts/rhel8_packaging_for_openvswitch/","wordcount":1041},{"categories":"posts","content":"\u003cp\u003e在CentoOS上安装sqlserver，需要先下载微软官方提供的在线yum源，再安装mssql-server软件包，再根据需要安装sqlserver的命令行工具或远程客户端进行连接\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eOS必须条件\u003cbr\u003e\nMemory：3.25 GB\u003cbr\u003e\nFile System：XFS or EXT4 (other file systems, such as BTRFS, are unsupported)\u003cbr\u003e\nDisk space ：6 GB\u003cbr\u003e\nProcessor speed：2 GHz\u003cbr\u003e\nProcessor cores：2 cores\u003cbr\u003e\nProcessor type：x64-compatible only\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e官方文档：\u003ca href=\"https://docs.microsoft.com/en-us/sql/linux/quickstart-install-connect-red-hat\"\u003ehttps://docs.microsoft.com/en-us/sql/linux/quickstart-install-connect-red-hat\u003c/a\u003e\u003c/p\u003e\n\u003ch2 id=\"安装mssql-server\"\u003e安装mssql-server\u003c/h2\u003e\n\u003cp\u003e下载阿里云在线yum源到本地\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003ewget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e下载微软官方的sqlserver源到本地\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003ewget -O /etc/yum.repos.d/mssql-server.repo https://packages.microsoft.com/config/rhel/7/mssql-server-2017.repo\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e最好查看一下内容是否正确\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003ecat /etc/yum.repos.d/mssql-server.repo\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e安装mssql-server（SQL Server软件包）\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eyum install -y mssql-server\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e运行mssql-conf配置文件，选择SQL版本并配置SA密码（密码必须符合策略要求 ）\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e/opt/mssql/bin/mssql-conf setup\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e这里有个小问题，服务器内存小于2G是无法正常安装的，所以需要调整内存或者自行搜索解决\u003c/p\u003e\n\u003cp\u003e初始化完成后，查看服务运行状态\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003esystemctl status mssql-server\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e要允许远程连接，允许firewalld防火墙上的SQLServer端口。 默认的 SQL Server 端口为 TCP 1433。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003esudo firewall-cmd --zone\u003cspan class=\"o\"\u003e=\u003c/span\u003epublic --add-port\u003cspan class=\"o\"\u003e=\u003c/span\u003e1433/tcp --permanent\nsudo firewall-cmd --reload\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"安装sqlserver命令行工具\"\u003e安装sqlserver命令行工具\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003e这时候安装已经完成，但是若要创建数据库或者本地连接数据库，则需要使用一个能够在SQLServer上运行Transact-SQL语句的工具进行连接。 以下步骤安装 SQL Server 命令行工具：sqlcmd和bcp。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e下载微软官方的软件包yum源\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003ewget -O  /etc/yum.repos.d/msprod.repo https://packages.microsoft.com/config/rhel/7/prod.repo\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e如果以前装过mssql，则需要删除较旧的UnixODBC软件包\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eyum remove unixODBC-utf16 unixODBC-utf16-devel \n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e安装mssql工具包和UnixODBC开发人员软件包\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eyum install -y mssql-tools unixODBC-devel \n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e为了方便使用工具包中的命令，添加PATH环境变量\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;export PATH=\u003c/span\u003e\u003cspan class=\"nv\"\u003e$PATH\u003c/span\u003e\u003cspan class=\"s2\"\u003e:/opt/mssql-tools/bin\u0026#34;\u003c/span\u003e \u0026gt;\u0026gt; /etc/profile\n\u003cspan class=\"nb\"\u003esource\u003c/span\u003e /etc/profile\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e使用sqlcmd命令连接本地的sqlserver，输入之前设置的SA密码\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003esqlcmd -S localhost -U SA -p\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e如果出现以下报错\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eSqlcmd: Error: Microsoft ODBC Driver \u003cspan class=\"m\"\u003e17\u003c/span\u003e \u003cspan class=\"k\"\u003efor\u003c/span\u003e SQL Server : Login timeout expired.\nSqlcmd: Error: Microsoft ODBC Driver \u003cspan class=\"m\"\u003e17\u003c/span\u003e \u003cspan class=\"k\"\u003efor\u003c/span\u003e SQL Server : TCP Provider: Timeout error \u003cspan class=\"o\"\u003e[\u003c/span\u003e258\u003cspan class=\"o\"\u003e]\u003c/span\u003e. .\nSqlcmd: Error: Microsoft ODBC Driver \u003cspan class=\"m\"\u003e17\u003c/span\u003e \u003cspan class=\"k\"\u003efor\u003c/span\u003e SQL Server : Unable to \u003cspan class=\"nb\"\u003ecomplete\u003c/span\u003e login process due to delay in prelogin response.\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e将localhost换成127.0.0.1，再次连接\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003esqlcmd -S 127.0.0.1 -U SA -p\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e除了 sqlcmd, bcp, SSMS (on Windows)，还可以使用以下工具：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eSQL Operations Studio\u003c/li\u003e\n\u003cli\u003emssql-cli\u003c/li\u003e\n\u003cli\u003eVisual Studio Code\u003c/li\u003e\n\u003cli\u003eNavicat客户端远程连接\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"检查安装的sql-server版本\"\u003e检查安装的SQL Server版本\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003esqlcmd -S localhost -U SA -Q \u003cspan class=\"s1\"\u003e\u0026#39;select @@VERSION\u0026#39;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"卸载-sql-server\"\u003e卸载 SQL Server\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003e如果安装了错误的版本或者需要卸载\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e只移除软件包本身\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eyum remove mssql-server\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e移除包并不会删除生成的数据库文件。 需要手动删除\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003erm -rf /var/opt/mssql/\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","date":1637207766,"description":"","fuzzywordcount":1100,"kind":"page","lang":"zh","lastmod":1646884069,"objectID":"7f493bb718e812b43e4125b7b75bd5ac","publishdate":1637207766,"relpermalink":"/posts/centos7_sqlserver2017/","section":"posts","summary":"在CentoOS上安装sqlserver，需要先下载微软官方","tags":["Linux"],"title":"CentOS7 安装 SQLServer2017","url":"https://ikuriko.github.io/posts/centos7_sqlserver2017/","wordcount":1009},{"categories":"posts","content":"\u003ch2 id=\"ps\"\u003eps\u003c/h2\u003e\n\u003cp\u003eps命令：可以查看进程的瞬间信息。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eps -aux\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e常用参数：\u003c/p\u003e\n\u003cp\u003e-a：显示现行终端机下的所有程序，包括其他用户的程序。\u003c/p\u003e\n\u003cp\u003e-e：列出程序时，显示每个程序所使用的环境变量。\u003c/p\u003e\n\u003cp\u003e-f：显示UID,PPIP,C与STIME栏位。\u003c/p\u003e\n\u003cp\u003e查看非root用户运行的进程\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eps -U root -u root -N\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e查看户root运行的进程\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eps -u root\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e查看有没有奇怪进程\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eps -aef \u003cspan class=\"p\"\u003e|\u003c/span\u003e grep inetd        \u003cspan class=\"c1\"\u003e#inetd 程序是一个Linux守护进程.\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e检测隐藏进程(ps)\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eps -ef \u003cspan class=\"p\"\u003e|\u003c/span\u003e awk \u003cspan class=\"s1\"\u003e\u0026#39;{print}\u0026#39;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e sort -n \u003cspan class=\"p\"\u003e|\u003c/span\u003euniq \u0026gt;1\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e检查系统硬件及当前正在运行进程的信息\u003csup id=\"fnref:1\"\u003e\u003ca href=\"#fn:1\" class=\"footnote-ref\" role=\"doc-noteref\"\u003e1\u003c/a\u003e\u003c/sup\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003els /proc \u003cspan class=\"p\"\u003e|\u003c/span\u003e sort -n \u003cspan class=\"p\"\u003e|\u003c/span\u003e uniq \u0026gt; \u003cspan class=\"m\"\u003e2\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"pstree\"\u003epstree\u003c/h2\u003e\n\u003cp\u003e查看进程树是否所有异常进程存在一个父进程、判断进程的父子关系\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003epstree -p\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"last\"\u003elast\u003c/h2\u003e\n\u003cp\u003e查看近期用户登陆情况\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003elast -n \u003cspan class=\"m\"\u003e5\u003c/span\u003e                  \u003cspan class=\"c1\"\u003e# -n 5 表示输出5条\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"history\"\u003ehistory\u003c/h2\u003e\n\u003cp\u003e查看历史命令\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"nb\"\u003ehistory\u003c/span\u003e \u003cspan class=\"m\"\u003e5\u003c/span\u003e                  \u003cspan class=\"c1\"\u003e# 5 表示输出最近使用的5条命令\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"awk\"\u003eawk\u003c/h2\u003e\n\u003cp\u003e查看空口令账号awk\u003csup id=\"fnref:2\"\u003e\u003ca href=\"#fn:2\" class=\"footnote-ref\" role=\"doc-noteref\"\u003e2\u003c/a\u003e\u003c/sup\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eawk -F: \u003cspan class=\"s1\"\u003e\u0026#39;($2==\u0026#34;\u0026#34;)\u0026#39;\u003c/span\u003e /etc/shadow\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e查看uid为0的账号\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eawk -F: \u003cspan class=\"s1\"\u003e\u0026#39;($3==0)\u0026#39;\u003c/span\u003e /etc/passwd\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e查看uid为0的账号\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003egrep -v -E \u003cspan class=\"s2\"\u003e\u0026#34;^#\u0026#34;\u003c/span\u003e /etc/passwd \u003cspan class=\"p\"\u003e|\u003c/span\u003e awk -F: \u003cspan class=\"s1\"\u003e\u0026#39;$3==0{print $1}\u0026#39;\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e#cat /etc/passwd | awk -F: \u0026#39;$3==0\u0026#39;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e-v    --反转匹配选择不匹配的线\n-E    --扩展正则表达式模式是一个扩展正则表达式\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"netstat\"\u003enetstat\u003c/h2\u003e\n\u003cp\u003e查看服务使用的端口号\u003c/p\u003e\n\u003cp\u003enetstat 命令用来打印Linux中网络系统的状态信息。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003enetstat -utpln\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e常用参数：\u003c/p\u003e\n\u003cp\u003e-a或–all：显示所有连线中的Socket。\u003c/p\u003e\n\u003cp\u003e-c或–continuous：持续列出网络状态。\u003c/p\u003e\n\u003cp\u003e-i或–interfaces：显示网络界面信息表单。\u003c/p\u003e\n\u003cp\u003e-l或–listening：显示监控中的服务器的Socket。\u003c/p\u003e\n\u003cp\u003e-n或–numeric：直接使用ip地址，而不通过域名服务器。\u003c/p\u003e\n\u003cp\u003e-t或–tcp：显示TCP传输协议的连线状况。\u003c/p\u003e\n\u003cp\u003e-u或–udp：显示UDP传输协议的连线状况。\u003c/p\u003e\n\u003ch2 id=\"lsof\"\u003elsof\u003c/h2\u003e\n\u003cp\u003e查看谁在使用某个端口\u003c/p\u003e\n\u003cp\u003elsof 命令用于查看你进程开打的文件，打开文件的进程，进程打开的端口(TCP、UDP)。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003elsof\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e常用参数：\u003c/p\u003e\n\u003cp\u003e-g：列出GID号进程详情；\u003c/p\u003e\n\u003cp\u003e-d\u0026lt;文件号\u0026gt;：列出占用该文件号的进程；\u003c/p\u003e\n\u003cp\u003e-i\u0026lt;条件\u0026gt;：列出符合条件的进程。（4、6、协议、:端口、 @ip ）\u003c/p\u003e\n\u003cp\u003e-p\u0026lt;进程号\u0026gt;：列出指定进程号所打开的文件；\u003c/p\u003e\n\u003cp\u003e-u：列出UID号进程详情；\u003c/p\u003e\n\u003cp\u003e查看端口的使用信息\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003elsof -i :22       \u003cspan class=\"c1\"\u003e# 看看谁在使用22端口\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e查看多个进程号对应的文件信息\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003elsof -p 2,3   \u003cspan class=\"c1\"\u003e# 使用逗号分隔 \u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e查看所有tcp网络连接信息\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003elsof -i tcp\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"ls\"\u003els\u003c/h2\u003e\n\u003cp\u003els 命令用来显示目标列表，不同类型的文件颜色也不同\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003els\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e常用参数：\u003c/p\u003e\n\u003cp\u003e-a：显示所有文件及目录，包括隐藏文件\u003c/p\u003e\n\u003cp\u003e-l：以长格式显示目录下的内容列表。\u003c/p\u003e\n\u003cp\u003e-t：用文件和目录的更改时间排序\u003c/p\u003e\n\u003cp\u003e查看所有文件，包括隐藏的文件(ls)\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003els -la\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"whereis\"\u003ewhereis\u003c/h2\u003e\n\u003cp\u003e查看文件的路径\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003ewhereis hostname\n\nhostname: /usr/bin/hostname /etc/hostname ……\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"find\"\u003efind\u003c/h2\u003e\n\u003cp\u003efind 命令用来在指定目录下查找文件。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003efind\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e参数 -mtime n 按照文件的更改时间来找文件，n为整数。\u003c/p\u003e\n\u003cp\u003e例：\u003c/p\u003e\n\u003cp\u003e-mtime 0 表示文件修改时间距离当前为0天的文件，即距离当前时间不到1天（24小时）以内的文件。\u003c/p\u003e\n\u003cp\u003e-mtime 1 表示文件修改时间距离当前为1天的文件，即距离当前时间1天（24小时－48小时）的文件。\u003c/p\u003e\n\u003cp\u003e-mtime＋1 表示文件修改时间为大于1天的文件，即距离当前时间2天（48小时）之外的文件\u003c/p\u003e\n\u003cp\u003e-mtime -1 表示文件修改时间为小于1天的文件，即距离当前时间1天（24小时）之内的文件\u003c/p\u003e\n\u003cp\u003e查找最近24小时内修改过的文件(find)\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003efind ./ -mtime \u003cspan class=\"m\"\u003e0\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e查找以.txt结尾的文件名(find)\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003efind / -name \u003cspan class=\"s2\"\u003e\u0026#34;*.txt\u0026#34;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e忽略大小写：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003efind / -iname \u003cspan class=\"s2\"\u003e\u0026#34;*.txt\u0026#34;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e查找不是以.txt结尾的文件(find)\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003efind / ! -name \u003cspan class=\"s2\"\u003e\u0026#34;*.txt\u0026#34;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003csection class=\"footnotes\" role=\"doc-endnotes\"\u003e\n\u003chr\u003e\n\u003col\u003e\n\u003cli id=\"fn:1\" role=\"doc-endnote\"\u003e\n\u003cp\u003esort 命令将文本文件内容加以排序,可针对文本文件的内容，以行为单位来排序。-n 参数依照数值的大小排序。uniq 命令用于检查及删除文本文件中重复出现的行列，一般与 sort 命令结合使用。\u0026#160;\u003ca href=\"#fnref:1\" class=\"footnote-backref\" role=\"doc-backlink\"\u003e\u0026#x21a9;\u0026#xfe0e;\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli id=\"fn:2\" role=\"doc-endnote\"\u003e\n\u003cp\u003eawk语法： awk [options] ‘pattern{action}’ file    #awk是一种编程语言，用于对文本和数据进行处理的\u0026#160;\u003ca href=\"#fnref:2\" class=\"footnote-backref\" role=\"doc-backlink\"\u003e\u0026#x21a9;\u0026#xfe0e;\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/section\u003e\n","date":1637031667,"description":"","fuzzywordcount":1500,"kind":"page","lang":"zh","lastmod":1646884164,"objectID":"2d3132311bf0ec2439ce4f7b466c27c4","publishdate":1637031667,"relpermalink":"/posts/linux_troubleshooting_commands/","section":"posts","summary":"ps ps命令：可以查看进程的瞬间信息。 ps -aux 常用参数： -a：显示","tags":["Linux"],"title":"Linux 常用排查命令","url":"https://ikuriko.github.io/posts/linux_troubleshooting_commands/","wordcount":1446},{"categories":"posts","content":"\u003ch2 id=\"简介\"\u003e简介\u003c/h2\u003e\n\u003cp\u003eKVM是开源软件，全称是kernel-based virtual machine（基于内核的虚拟机）。使用半虚拟化技术创建虚拟机的模块，可以将Linux内核转化为一个hypervisor\u003csup id=\"fnref:1\"\u003e\u003ca href=\"#fn:1\" class=\"footnote-ref\" role=\"doc-noteref\"\u003e1\u003c/a\u003e\u003c/sup\u003e。\u003c/p\u003e\n\u003cp\u003eKVM的前身是QEMU，2008年被Red Hat公司收购并获得的一项hypervisor技术，不过Red Hat的KVM被认为是将成为未来Linux hypervisor的主流，准确来说，KVM仅仅是Linux内核的一个模块，管理和创建完整的KVM虚拟机，需要更多的辅助工具。\u003c/p\u003e\n\u003cp\u003eKVM在2007年2月被整合到Linux 2.6.20核心中，以可加载核心模块的方式被移植到FreeBSD及illumos上，它依托CPU和虚拟化指令集（如Inter-VT、AMD-V）实现高性能的虚拟化支持；由于与Linux内核高度整合，因此在性能、安全性、兼容性、稳定性上都有很好的表现。\u003c/p\u003e\n\u003cp\u003eKVM环境中运行的每个虚拟化操作系统都将表现为单个独立的系统进程。因此它可以很方便地与Linux系统中的安全模块进行整合（SElinux），可以灵活地实现资源的管理及分配。\u003c/p\u003e\n\u003ch2 id=\"虚拟化类型\"\u003e虚拟化类型\u003c/h2\u003e\n\u003cp\u003e\u003cstrong\u003e全虚拟化\u003c/strong\u003e：虚拟机中运行的软件与系统不需经过任何修改，就好比运行在真实硬件一样；但依然使用虚拟硬件设备，并且需要CPU的虚拟化支持（如Intel VT技术或者AMD V技术)，是基于硬件的完全虚拟化，性能更好。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e半虚拟化\u003c/strong\u003e：另一种类似于全虚拟化的热门技术，同样使用 Hypervisor (虚拟机管理程序) 分享存取底层的硬件, 但是它的客户操作系统集成了虚拟化方面的代码，不需要CPU的硬件支持。该方法无需重新编译或引起陷阱，因为操作系统自身能够与虚拟进程进行很好的协作；但半虚拟化需要客户操作系统做一些修改（配合VDSM），这是一个不足之处，但是半虚拟化提供了与原始系统相近的性能，与全虚拟化一样，半虚拟化可以同时能支持多个不同的操作系统。\u003c/p\u003e\n\u003ch2 id=\"安装-kvm\"\u003e安装 KVM\u003c/h2\u003e\n\u003cp\u003e以下操作的系统环境为CentOS 8.4.2105\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003ecat /etc/redhat-release \nCentOS Linux release 8.4.2105\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003euname -r\n4.18.0-305.3.1.el8.x86_64\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e先查看CPU是否支持虚拟化\u003csup id=\"fnref:2\"\u003e\u003ca href=\"#fn:2\" class=\"footnote-ref\" role=\"doc-noteref\"\u003e2\u003c/a\u003e\u003c/sup\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003ecat /proc/cpuinfo \u003cspan class=\"p\"\u003e|\u003c/span\u003e egrep \u003cspan class=\"s1\"\u003e\u0026#39;vmx|svm\u0026#39;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e关闭SELinux\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003esed -i \u003cspan class=\"s2\"\u003e\u0026#34;/^SELINUX/s/enforcing/disabled/g\u0026#34;\u003c/span\u003e /etc/selinux/config\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e安装KVM所需的软件包\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eyum -y install qemu-kvm libvirt libvirt-daemon libvirt-daemon-driver-qemu libvirt-client virt-manager libguestfs-tools virt-install virt-viewer virt-v2v bridge-utils\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e所需软件包详解\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eqemu-kvm                      \u003cspan class=\"c1\"\u003e# KVM模块\u003c/span\u003e\nlibvirt                       \u003cspan class=\"c1\"\u003e# 虚拟机管理工具包\u003c/span\u003e\nlibvirt-daemon                \nlibvirt-daemon-driver-qemu    \nlibvirt-client                \nvirt-manager                  \u003cspan class=\"c1\"\u003e# 图形界面管理虚拟机\u003c/span\u003e\nlibguestfs-tools              \u003cspan class=\"c1\"\u003e# virt-cat等命令的支持软件包\u003c/span\u003e\nvirt-install                  \u003cspan class=\"c1\"\u003e# 命令行安装虚机\u003c/span\u003e\nvirt-viewer                   \u003cspan class=\"c1\"\u003e# 图形化连接虚机\u003c/span\u003e\nvirt-v2v                      \u003cspan class=\"c1\"\u003e# 将其他平台的虚机转换为kvm虚机\u003c/span\u003e\nbridge-utils                  \u003cspan class=\"c1\"\u003e# 网桥支持工具包\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e重启宿主机，以便加载 kvm 模块\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003ereboot\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e查看KVM模块是否被正确加载\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003elsmod \u003cspan class=\"p\"\u003e|\u003c/span\u003e grep kvm          \u003cspan class=\"c1\"\u003e#输出以下参数，说明KVM模块已经正确加载\u003c/span\u003e\nkvm_intel       \u003cspan class=\"m\"\u003e162153\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\nkvm          \u003cspan class=\"m\"\u003e525259\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e kvm_intel       \n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e开启kvm服务，并且设置其开机自动启动\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003esystemctl start libvirtd\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003esystemctl \u003cspan class=\"nb\"\u003eenable\u003c/span\u003e libvirtd\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e查看状态，如Active: active (running)，说明运行情况良好\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003esystemctl status libvirtd\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"配置-kvm网络\"\u003e配置 KVM网络\u003c/h2\u003e\n\u003cp\u003e宿主服务器安装完成KVM，首先要设定网络，在libvirt中运行KVM网络有两种方法：NAT和Bridge，\u003cstrong\u003e默认的网络是NAT模式\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e先删除默认的default网络\u003csup id=\"fnref:3\"\u003e\u003ca href=\"#fn:3\" class=\"footnote-ref\" role=\"doc-noteref\"\u003e3\u003c/a\u003e\u003c/sup\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003evirsh net-destroy default\nNetwork default destroyed\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003evirsh net-undefine default\nNetwork default has been undefined\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e重启服务\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003esystemctl restart libvirtd\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e#按需求选择是否开启路由转发\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003evim /etc/sysctl.conf\n\nnet.ipv4.ip_forward \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e    \u003cspan class=\"c1\"\u003e#开启路由转发\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003esysctl -p                  \u003cspan class=\"c1\"\u003e#立即生效\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"配置-nat-模式\"\u003e配置 NAT 模式\u003c/h3\u003e\n\u003cp\u003e宿主机网络配置\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003evim /etc/sysconfig/network-scripts/ifcfg-natbr0\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"nv\"\u003eDEVICE\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003enatbr0\n\u003cspan class=\"nv\"\u003eNAME\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003enatbr0\n\u003cspan class=\"nv\"\u003eONBOOT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eyes\n\u003cspan class=\"nv\"\u003eBOOTPROTO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003enone\n\u003cspan class=\"nv\"\u003eIPADDR\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e192.168.112.1\n\u003cspan class=\"nv\"\u003eTYPE\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eBridge\n\u003cspan class=\"nv\"\u003eNETMASK\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e255.255.255.0\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eip link \u003cspan class=\"nb\"\u003eset\u003c/span\u003e dev natbr0 up\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e新建网络定义 xml 文件\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003evim /tmp/natbr0.xml\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-xml\" data-lang=\"xml\"\u003e\u003cspan class=\"nt\"\u003e\u0026lt;network\u0026gt;\u003c/span\u003e\n \u003cspan class=\"nt\"\u003e\u0026lt;name\u0026gt;\u003c/span\u003enat\u003cspan class=\"nt\"\u003e\u0026lt;/name\u0026gt;\u003c/span\u003e\n \u003cspan class=\"nt\"\u003e\u0026lt;bridge\u003c/span\u003e \u003cspan class=\"na\"\u003ename=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;natbr0\u0026#34;\u003c/span\u003e\u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n \u003cspan class=\"nt\"\u003e\u0026lt;forward/\u0026gt;\u003c/span\u003e\n \u003cspan class=\"nt\"\u003e\u0026lt;ip\u003c/span\u003e \u003cspan class=\"na\"\u003eaddress=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;192.168.112.1\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003enetmask=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;255.255.255.0\u0026#34;\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;dhcp\u0026gt;\u003c/span\u003e\n   \u003cspan class=\"nt\"\u003e\u0026lt;range\u003c/span\u003e \u003cspan class=\"na\"\u003estart=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;192.168.112.2\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003eend=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;192.168.112.254\u0026#34;\u003c/span\u003e\u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;/dhcp\u0026gt;\u003c/span\u003e\n \u003cspan class=\"nt\"\u003e\u0026lt;/ip\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/network\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"配置-linux-bridge-模式\"\u003e配置 Linux-Bridge 模式\u003c/h3\u003e\n\u003cp\u003e宿主机网络配置\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003evim /etc/sysconfig/network-scripts/ifcfg-br1\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"nv\"\u003eDEVICE\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003ebr1\n\u003cspan class=\"nv\"\u003eNAME\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003ebr1\n\u003cspan class=\"nv\"\u003eONBOOT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eyes\n\u003cspan class=\"nv\"\u003eBOOTPROTO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003enone\n\u003cspan class=\"nv\"\u003eIPADDR\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e192.168.120.1\n\u003cspan class=\"nv\"\u003eTYPE\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eBridge\n\u003cspan class=\"nv\"\u003eNETMASK\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e255.255.255.0\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eip link \u003cspan class=\"nb\"\u003eset\u003c/span\u003e dev br1 up\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e新建网络定义 xml 文件\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003evim /tmp/br1.xml\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-xml\" data-lang=\"xml\"\u003e\u003cspan class=\"nt\"\u003e\u0026lt;network\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;name\u0026gt;\u003c/span\u003ebr1\u003cspan class=\"nt\"\u003e\u0026lt;/name\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;forward\u003c/span\u003e \u003cspan class=\"na\"\u003emode=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;bridge\u0026#34;\u003c/span\u003e\u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;bridge\u003c/span\u003e \u003cspan class=\"na\"\u003ename=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;br1\u0026#34;\u003c/span\u003e\u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/network\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"配置-ovs-bridge-模式\"\u003e配置 Ovs-Bridge 模式\u003c/h3\u003e\n\u003cp\u003e宿主机网络配置\u003c/p\u003e\n\u003cp\u003e使用ovs网桥需安装 openvswitch 软件包\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eovs-vsctl add-br ovs-br1    \u003cspan class=\"c1\"\u003e#创建ovs网桥\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e新建网络定义 xml 文件\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003evim /tmp/ovs-br1.xml\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-xml\" data-lang=\"xml\"\u003e\u003cspan class=\"nt\"\u003e\u0026lt;network\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;name\u0026gt;\u003c/span\u003eovs-br1\u003cspan class=\"nt\"\u003e\u0026lt;/name\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;forward\u003c/span\u003e \u003cspan class=\"na\"\u003emode=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;bridge\u0026#34;\u003c/span\u003e\u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;bridge\u003c/span\u003e \u003cspan class=\"na\"\u003ename=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;ovs-br1\u0026#34;\u003c/span\u003e\u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;virtualport\u003c/span\u003e \u003cspan class=\"na\"\u003etype=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;openvswitch\u0026#34;\u003c/span\u003e\u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/network\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"定义-kvm网络\"\u003e定义 KVM网络\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003evirsh net-define /tmp/br1.xml\nNetwork BR1 defined from /tmp/br1.xml\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e启动网络\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003evirsh net-start BR1\nNetwork BR1 started\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e自启动网络\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003evirsh net-autostart BR1\nNetwork BR1 marked as autostarted\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e查看\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003evirsh net-list\nName         State   Autostart   Persistent\n----------------------------------------------------------\nBR1         active   yes      yes\ndefault       active   yes      yes\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"创建-kvm-虚机\"\u003e创建 KVM 虚机\u003c/h2\u003e\n\u003cp\u003e安装前要设置环境语言为英文LANG=\u0026quot;en_US.UTF-8\u0026quot;\u003csup id=\"fnref:4\"\u003e\u003ca href=\"#fn:4\" class=\"footnote-ref\" role=\"doc-noteref\"\u003e4\u003c/a\u003e\u003c/sup\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003evim /etc/locale.conf\n\n\u003cspan class=\"nv\"\u003eLANG\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;en_US.UTF-8\u0026#34;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e新建磁盘及镜像存储目录\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003emkdir -pv /kvm/\u003cspan class=\"o\"\u003e{\u003c/span\u003estore,iso\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e新建虚拟磁盘(下面会详细介绍该命令)\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eqemu-img create -f qcow2 /kvm/store/CentOS-7.9.qcow2 20G\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e给与镜像文件权限，特别注意.iso镜像文件一定放到/home 或者在根目录重新创建目录，不然会因为权限报错，无法创建虚拟机。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003echown root:root /iso/CentOS-7-x86_64-Minimal-2009.iso \n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e使用 virt-install 创建虚拟机（也可以通过 virt-manager 图形化工具创建）\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003evirt-install --virt-type\u003cspan class=\"o\"\u003e=\u003c/span\u003ekvm --name\u003cspan class=\"o\"\u003e=\u003c/span\u003eCentOS7.9 --os-type\u003cspan class=\"o\"\u003e=\u003c/span\u003elinux --vcpus\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e --memory\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e1024\u003c/span\u003e --location\u003cspan class=\"o\"\u003e=\u003c/span\u003e/kvm/iso/CentOS-7-x86_64-Minimal-2009.iso --disk\u003cspan class=\"o\"\u003e=\u003c/span\u003e/kvm/store/CentOS-7.9.qcow2,size\u003cspan class=\"o\"\u003e=\u003c/span\u003e20,format\u003cspan class=\"o\"\u003e=\u003c/span\u003eqcow2 --network \u003cspan class=\"nv\"\u003ebridge\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003ebr0,model\u003cspan class=\"o\"\u003e=\u003c/span\u003evirtio --accelerate --autostart --extra-args\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;console=ttyS0\u0026#39;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003evirt-install 参数\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e--name             \u003cspan class=\"c1\"\u003e# 指定虚拟机名称\u003c/span\u003e\n--memory           \u003cspan class=\"c1\"\u003e# 分配虚拟机内存大小，以 MB 为单位\u003c/span\u003e\n--vcpus            \u003cspan class=\"c1\"\u003e# 分配CPU核心数，最大与实体机CPU核心数相同\u003c/span\u003e\n--cpuset           \u003cspan class=\"c1\"\u003e# 设置哪个物理CPU能够被虚拟机使用\u003c/span\u003e\n--location         \u003cspan class=\"c1\"\u003e# 指定安装介质路径，如光盘镜像或网络安装，有本地、nfs、http、ftp几种\u003c/span\u003e\n--extra-args\u003cspan class=\"o\"\u003e=\u003c/span\u003eEXTRA \u003cspan class=\"c1\"\u003e# 当执行从\u0026#34;--location\u0026#34;选项指定位置的客户机安装时，用于传递额外的内核命令行参数到安装程序根，例如指定kickstart文件的位置，--extra-args \u0026#34;ks=http://172.16.0.1/class.cfg\u0026#34;\u003c/span\u003e\n--autostart        \u003cspan class=\"c1\"\u003e# 指定虚拟机是否在物理启动后自动启动\u003c/span\u003e\n--cdrom            \u003cspan class=\"c1\"\u003e# 指定安装镜像iso(和上面的选项相同，不过这个特指iso镜像)\u003c/span\u003e\n--pxe              \u003cspan class=\"c1\"\u003e# 基于PXE安装  \u003c/span\u003e\n--livecd           \u003cspan class=\"c1\"\u003e# 把光盘当作LiveCD，直接启动系统\u003c/span\u003e\n--boot cdrom,hd,network   \u003cspan class=\"c1\"\u003e# 指定引导次序\u003c/span\u003e\n--disk             \u003cspan class=\"c1\"\u003e# 指定虚拟机的磁盘存储位置，size，以GB为单位，format，磁盘的格式。\u003c/span\u003e\n--nodisks          \u003cspan class=\"c1\"\u003e# 不使用本地磁盘安装，在LiveCD模式中常用\u003c/span\u003e\n--network          \u003cspan class=\"c1\"\u003e# 虚拟机使用的网络类型，其中子选项，bridge=br0 指定桥接网卡的名称。\u003c/span\u003e\n--nonetworks       \u003cspan class=\"c1\"\u003e# 虚拟机不使用网络功能\u003c/span\u003e\n--accelerate       \u003cspan class=\"c1\"\u003e# KVM或KQEMU内核加速,推荐最好加上。如果KVM和KQEMU都支持，KVM加速器优先使用。\u003c/span\u003e\n--vnc              \u003cspan class=\"c1\"\u003e# 开启vnc远程管理\u003c/span\u003e\n--vncport          \u003cspan class=\"c1\"\u003e# 指定VNC监控端口，默认端口为5900，端口不能重复。\u003c/span\u003e\n--vnclisten        \u003cspan class=\"c1\"\u003e# 指定VNC绑定IP，默认绑定127.0.0.1，这里改为0.0.0.0。\u003c/span\u003e\n--graphics         \u003cspan class=\"c1\"\u003e# 指定图形显示相关的配置，此选项不会配置任何显示硬件（如显卡），而是仅指定访问的接口\u003c/span\u003e\n--nographics       \u003cspan class=\"c1\"\u003e# 指定没有控制台被分配给客户机\u003c/span\u003e\n--video\u003cspan class=\"o\"\u003e=\u003c/span\u003eVIDEO      \u003cspan class=\"c1\"\u003e# 指定显卡设备模型，可用取值为cirrus、vga、qxl或vmvga\u003c/span\u003e\n--uuid             \u003cspan class=\"c1\"\u003e# 客户端UUID 默认不写时，系统会自动生成\u003c/span\u003e\n--noautoconsole    \u003cspan class=\"c1\"\u003e# 禁止自动连接至虚拟机的控制台\u003c/span\u003e\n--hvm              \u003cspan class=\"c1\"\u003e# 全虚拟化\u003c/span\u003e\n--paravirt         \u003cspan class=\"c1\"\u003e# 半虚拟化\u003c/span\u003e\n--force            \u003cspan class=\"c1\"\u003e# 禁止命令进入交互式模式，如果有需要回答yes或no选项，则自动回答为yes\u003c/span\u003e\n--debug            \u003cspan class=\"c1\"\u003e# 显示debug信息\u003c/span\u003e\n--host-device\u003cspan class=\"o\"\u003e=\u003c/span\u003eHOSTDEV \u003cspan class=\"c1\"\u003e# 附加一个物理主机设备到客户机。HOSTDEV是随着libvirt使用的一个节点设备名（具体设备如’virsh nodedev-list’的显示的结果）\u003c/span\u003e\n--os-type\u003cspan class=\"o\"\u003e=\u003c/span\u003eOS_TYPE（linux,windows）            \u003cspan class=\"c1\"\u003e# 针对一类操作系统优化虚拟机配置（非必要）\u003c/span\u003e\n--os-variant\u003cspan class=\"o\"\u003e=\u003c/span\u003eOS_VARIANT（rhel7,winx7,win2k8） \u003cspan class=\"c1\"\u003e# 针对特定操作系统变体进一步优化虚拟机配置（非必要）\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e图形化控制台，服务器未安装图形化则无法开启，但可通过远程连接软件强制开启(不稳定)\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003evirt-manager\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e查看镜像的信息\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003evirt-filesystems --long --parts --blkdevs -h -a Centos_7.qcow2\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003ekvm虚拟机的配置文件位置\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003els /etc/libvirt/qemu/\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"kvm-基本管理命令\"\u003eKVM 基本管理命令\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003evirsh list                          \u003cspan class=\"c1\"\u003e# 查看已开启的虚拟机\u003c/span\u003e\nvirsh list --all                    \u003cspan class=\"c1\"\u003e# 查看所有虚拟机\u003c/span\u003e\nvirsh net-list                      \u003cspan class=\"c1\"\u003e# 查看已开启的虚拟网络\u003c/span\u003e\nvirsh net-list --all                \u003cspan class=\"c1\"\u003e# 查看所有虚拟网络\u003c/span\u003e\nvirsh net-define default.xml        \u003cspan class=\"c1\"\u003e# 定义kvm网络\u003c/span\u003e\nvirsh net-undefine default          \u003cspan class=\"c1\"\u003e# 删除kvm网络\u003c/span\u003e\nvirsh net-start default             \u003cspan class=\"c1\"\u003e# 启动kvm网络\u003c/span\u003e\nvirsh net-autostart default         \u003cspan class=\"c1\"\u003e# 自启动kvm网络\u003c/span\u003e\nvirsh domiflist Centos              \u003cspan class=\"c1\"\u003e# 查看虚机内的网卡\u003c/span\u003e\nvirsh dumpxml vm-name               \u003cspan class=\"c1\"\u003e# 查看kvm虚拟机配置文件\u003c/span\u003e\nvirsh start vm-name                 \u003cspan class=\"c1\"\u003e# 启动kvm虚拟机\u003c/span\u003e\nvirsh shutdown vm-name              \u003cspan class=\"c1\"\u003e# 关闭kvm虚拟机（正常关机）\u003c/span\u003e\nvirsh destroy vm-name               \u003cspan class=\"c1\"\u003e# 强制关闭虚拟机（非正常关机，相当于直接拔掉电源）\u003c/span\u003e\nvirsh undefine vm-name              \u003cspan class=\"c1\"\u003e# 移除定义kvm虚拟机（只会删除配置文件，不会删除磁盘文件）\u003c/span\u003e\nvirsh define file-name.xml          \u003cspan class=\"c1\"\u003e# 根据xml配置文件定义虚拟机\u003c/span\u003e\nvirsh \u003cspan class=\"nb\"\u003esuspend\u003c/span\u003e vm-name               \u003cspan class=\"c1\"\u003e# 挂起虚拟机\u003c/span\u003e\nvirsh resumed vm-name               \u003cspan class=\"c1\"\u003e# 恢复被挂起的虚拟机\u003c/span\u003e\nvirsh autostart vm-name             \u003cspan class=\"c1\"\u003e# 开机自启动kvm虚拟机\u003c/span\u003e\nvirsh console vm-name               \u003cspan class=\"c1\"\u003e# 使用console控制台连接虚拟机，键入 Ctrl+5 退出\u003c/span\u003e\nvirsh dumpxml vm-name \u0026gt; ~/vm.xml    \u003cspan class=\"c1\"\u003e#导出虚拟机的配置文件 \u003c/span\u003e\nvirsh setvcpus vm-name --maximum \u003cspan class=\"m\"\u003e4\u003c/span\u003e --config   \u003cspan class=\"c1\"\u003e# 更改CPU\u003c/span\u003e\nvirsh setmaxmem vm-name \u003cspan class=\"m\"\u003e1024\u003c/span\u003e --config         \u003cspan class=\"c1\"\u003e# 更改内存\u003c/span\u003e\nvirsh dominfo vm-name                         \u003cspan class=\"c1\"\u003e# 查看信息\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"kvm-高级功能管理\"\u003eKVM 高级功能管理\u003c/h2\u003e\n\u003ch3 id=\"磁盘格式转换\"\u003e磁盘格式转换\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eKVM虚拟机常用磁盘格式为raw与qcow2格式，默认使用raw格式，那么其中raw格式的磁盘性能最好、速度最快，但不支持AES加密、zlib磁盘压缩等新功能，而qcow2格式磁盘存储空间更小，并支持AES加密、zlib、快照等新功能，缺点是性能较差\u003c/li\u003e\n\u003cli\u003e如果想管理指定虚拟机磁盘（如分区情况、磁盘数量等），可以使用\u0026quot;libguestfs-tools\u0026quot;工具（一般默认安装），下面举例，说明如和转换磁盘格式\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e查看指定磁盘文件的信息（如磁盘格式、占用磁盘大小等）\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eqemu-img info /kvm/store/Centos.img\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eqemu-img 命令可以对kvm的磁盘镜像进行管理\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eqemu-img convert -f raw -O qcow2 \u0026lt;raw格式磁盘镜像路径\u0026gt; \u0026lt;qcow2格式磁盘镜像路径\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e选项：\n-c：对输出的镜像文件进行压缩，但只有qcow2和qcow格式支持\n-f：指定源磁盘格式\n-O：指定转换后磁盘格式\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e将指定raw格式文件转换为qcow2磁盘格式文件（注意该虚拟机需关机）\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eqemu-img convert -f raw -O qcow2 /kvm/store/Centos.img /kvm/store/Centos.qcow2\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cfont color=red\u003e注意：转换后，需更改KVM虚拟机配置文件，因为虚拟机中还是用原磁盘格式文件，需要更改为新转换后的磁盘文件，才能使用新磁盘格式\u003c/font\u003e\u003c/p\u003e\n\u003cp\u003e编辑指定名为Centos虚拟机配置文件\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003evirsh edit Centos\n \u0026lt;driver \u003cspan class=\"nv\"\u003ename\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;qemu\u0026#39;\u003c/span\u003e \u003cspan class=\"nv\"\u003etype\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;qcow2\u0026#39;\u003c/span\u003e \u003cspan class=\"nv\"\u003ecache\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;none\u0026#39;\u003c/span\u003e/\u0026gt;\n \u0026lt;\u003cspan class=\"nb\"\u003esource\u003c/span\u003e \u003cspan class=\"nv\"\u003efile\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;/kvm/store/Centos.qcow2\u0026#39;\u003c/span\u003e/\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e启动虚机\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003evirsh start Centos\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"管理虚机文件\"\u003e管理虚机文件\u003c/h3\u003e\n\u003cp\u003e\u003cstrong\u003e查看指定KVM虚拟机磁盘文件里指定路径内容\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003evirt-cat -a \u003cspan class=\"o\"\u003e{\u003c/span\u003e磁盘文件路径\u003cspan class=\"o\"\u003e}\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e文件绝对路径\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e栗：查看Centos.qcow2磁盘文件中/etc/sysconfig/network内容\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003evirt-cat -a /kvm/store/Centos.qcow2 /etc/sysconfig/network\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cstrong\u003e编辑指定KVM虚拟机磁盘文件里指定路径内容\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003evirt-edit -a \u003cspan class=\"o\"\u003e{\u003c/span\u003e磁盘文件路径\u003cspan class=\"o\"\u003e}\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e文件绝对路径\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e栗：编辑Centos的/etc/sysconfig/network文件\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003evirt-edit -a /kvm/store/Centos.qcow2 /etc/sysconfig/network\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cstrong\u003e查看指定KVM虚拟机磁盘使用情况\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003evirt-df -h vm-name\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"虚机克隆和快照\"\u003e虚机克隆和快照\u003c/h3\u003e\n\u003ch4 id=\"创建克隆\"\u003e创建克隆\u003c/h4\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003evirt-clone -o CentOS7.9_01 -n test1 -f /kvm/store/test1.qcow2\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003evirt-clone 参数\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e--version            \u003cspan class=\"c1\"\u003e# 查看版本\u003c/span\u003e\n--help               \u003cspan class=\"c1\"\u003e# 查看帮助信息\u003c/span\u003e\n--connect\u003cspan class=\"o\"\u003e=\u003c/span\u003eURI        \u003cspan class=\"c1\"\u003e# 连接到虚拟机管理程序 libvirt 的URI\u003c/span\u003e\n-o                   \u003cspan class=\"c1\"\u003e# 原始虚拟机名称 原始虚拟机名称，必须为关闭或者暂停状态\u003c/span\u003e\n--name               \u003cspan class=\"c1\"\u003e# 新虚拟机名称\u003c/span\u003e\n--auto-clone         \u003cspan class=\"c1\"\u003e# 从原来的虚拟机配置自动生成克隆名称和存储路径\u003c/span\u003e\n--uuid\u003cspan class=\"o\"\u003e=\u003c/span\u003eNEW_UUID      \u003cspan class=\"c1\"\u003e# 克隆虚拟机的新的UUID，默认值是一个随机生成的UUID\u003c/span\u003e\n--mac\u003cspan class=\"o\"\u003e=\u003c/span\u003eNEW_MAC        \u003cspan class=\"c1\"\u003e# 设置一个新的mac地址，默认为随机生成 MAC\u003c/span\u003e\n--file\u003cspan class=\"o\"\u003e=\u003c/span\u003eNEW_DISKFILE  \u003cspan class=\"c1\"\u003e# 为新客户机使用新的磁盘镜像文件地址。\u003c/span\u003e\n--force-copy\u003cspan class=\"o\"\u003e=\u003c/span\u003eTARGET  \u003cspan class=\"c1\"\u003e# 强制复制设备。\u003c/span\u003e\n--nonsparse          \u003cspan class=\"c1\"\u003e# 不使用稀疏文件复制磁盘映像。\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch4 id=\"创建快照\"\u003e创建快照\u003c/h4\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003evirsh snapshot-create test1\nDomain snapshot \u003cspan class=\"m\"\u003e1624247774\u003c/span\u003e created\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003evirsh snapshot-list test1\n\nName         Creation Time       State\n------------------------------------------------------------\n\u003cspan class=\"m\"\u003e1624247774\u003c/span\u003e      2021-06-21 11:56:14 +0800 shutoff\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e恢复快照\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003evirsh snapshot-list test1\n\nName         Creation Time       State\n------------------------------------------------------------\n\u003cspan class=\"m\"\u003e1624249154\u003c/span\u003e      2021-06-21 12:19:14 +0800 shutoff\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003evirsh snapshot-revert test1 \u003cspan class=\"m\"\u003e1624249154\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e删除快照\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003evirsh snapshot-list test3\n\nName         Creation Time       State\n------------------------------------------------------------\n\u003cspan class=\"m\"\u003e1624249270\u003c/span\u003e      2021-06-21 12:21:10 +0800 shutoff\n\u003cspan class=\"m\"\u003e1624249928\u003c/span\u003e      2021-06-21 12:32:08 +0800 shutoff\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003evirsh snapshot-delete test3 \u003cspan class=\"m\"\u003e1624249928\u003c/span\u003e\nDomain snapshot \u003cspan class=\"m\"\u003e1624249928\u003c/span\u003e deleted\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003evirsh snapshot-list test3\n\nName         Creation Time       State\n------------------------------------------------------------\n\u003cspan class=\"m\"\u003e1624249270\u003c/span\u003e      2021-06-21 12:21:10 +0800 shutoff\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"error-随笔\"\u003eError 随笔\u003c/h2\u003e\n\u003cp\u003e添加 ovs-br 后启动虚拟机时报错\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003evirsh start --domain test2\nerror: Failed to start domain test2\nerror: Unable to add bridge br0 port vnet2: Operation not supported\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e启动虚拟机时 libvirt 会尝试 linux 默认的LinuxBridge，而不是openvswitch\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003evirsh edit test1    \u003cspan class=\"c1\"\u003e#编辑虚拟机配置文件，在\u0026lt;interface\u0026gt;加入\u0026lt;virtualport type=\u0026#39;openvswitch\u0026#39;/\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-xml\" data-lang=\"xml\"\u003e\u003cspan class=\"nt\"\u003e\u0026lt;interface\u003c/span\u003e \u003cspan class=\"na\"\u003etype=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#39;bridge\u0026#39;\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n\n \u003cspan class=\"nt\"\u003e\u0026lt;virtualport\u003c/span\u003e \u003cspan class=\"na\"\u003etype=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#39;openvswitch\u0026#39;\u003c/span\u003e\u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n\n\u003cspan class=\"nt\"\u003e\u0026lt;/interface\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003chr\u003e\n\u003csection class=\"footnotes\" role=\"doc-endnotes\"\u003e\n\u003chr\u003e\n\u003col\u003e\n\u003cli id=\"fn:1\" role=\"doc-endnote\"\u003e\n\u003cp\u003eHypervisor，又称\u0026quot;虚拟机监视器\u0026quot;（virtual machine monitor，缩写为 VMM），是用来建立与执行\u003ca href=\"https://baike.baidu.com/item/%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%99%A8\"\u003e虚拟机器\u003c/a\u003e的软件、固件或硬件。\u0026#160;\u003ca href=\"#fnref:1\" class=\"footnote-backref\" role=\"doc-backlink\"\u003e\u0026#x21a9;\u0026#xfe0e;\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli id=\"fn:2\" role=\"doc-endnote\"\u003e\n\u003cp\u003eKVM 是基于 x86 虚拟化扩展(Intel VT 或者 AMD-V) 技术的虚拟机软件，所以查看 CPU 是否支持 VT 技术，就可以判断是否支持KVM。有返回结果，如果结果中有vmx（Intel）或svm(AMD)字样，就说明CPU的支持的。\u0026#160;\u003ca href=\"#fnref:2\" class=\"footnote-backref\" role=\"doc-backlink\"\u003e\u0026#x21a9;\u0026#xfe0e;\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli id=\"fn:3\" role=\"doc-endnote\"\u003e\n\u003cp\u003e为了方便管理KVM网络，删除自带的默认网络，默认的网络模式为NAT模式\u0026#160;\u003ca href=\"#fnref:3\" class=\"footnote-backref\" role=\"doc-backlink\"\u003e\u0026#x21a9;\u0026#xfe0e;\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli id=\"fn:4\" role=\"doc-endnote\"\u003e\n\u003cp\u003e如果是中文的话某些版本可能会报错或乱码。在CentOS 7/8 中修改 /etc/locale.conf\u0026#160;\u003ca href=\"#fnref:4\" class=\"footnote-backref\" role=\"doc-backlink\"\u003e\u0026#x21a9;\u0026#xfe0e;\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/section\u003e\n","date":1636533414,"description":"","fuzzywordcount":4500,"kind":"page","lang":"zh","lastmod":1646884130,"objectID":"15ca2fce55aa855b41dc2d661ff411c1","publishdate":1636533414,"relpermalink":"/posts/kvm/","section":"posts","summary":"简介 KVM是开源软件，全称是kernel-based virtual mac","tags":["Linux","KVM"],"title":"KVM 虚拟化","url":"https://ikuriko.github.io/posts/kvm/","wordcount":4405},{"categories":"posts","content":"\u003cp\u003e安装中文语言包\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eyum install kde-l10n-Chinese          \u003cspan class=\"c1\"\u003e# CentOS 7 安装\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eyum install langpacks-zh_CN.noarch    \u003cspan class=\"c1\"\u003e# CentOS 8 安装\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eyum reinstall glibc-common\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e安装字体\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eyum groupinstall \u003cspan class=\"s2\"\u003e\u0026#34;fonts\u0026#34;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e查看系统支持的语言（是否支持zh_CN.utf8）\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003elocale -a \u003cspan class=\"p\"\u003e|\u003c/span\u003e grep zh\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e编辑系统语言文件\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003evim /etc/locale.conf\n\u003cspan class=\"nv\"\u003eLANG\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003ezh_CN.utf8\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e立即生效\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003esource /etc/locale.conf\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e也可以直接设置系统语言\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003elocalectl  set-locale \u003cspan class=\"nv\"\u003eLANG\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003ezh_CN.utf8\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","date":1636079668,"description":"","fuzzywordcount":100,"kind":"page","lang":"zh","lastmod":1646884143,"objectID":"13013bcdaef8efdcf3a81edbb547a3ba","publishdate":1636079668,"relpermalink":"/posts/centos_chinese/","section":"posts","summary":"安装中文语言包 yum install kde-l10n-Chinese # CentOS 7 安装 yum install langpacks-zh_CN.noarch # CentOS 8 安装 yum reinstall glibc-common 安装字体","tags":["Linux"],"title":"CentOS 安装中文语言包","url":"https://ikuriko.github.io/posts/centos_chinese/","wordcount":94},{"categories":"posts","content":"\u003cp\u003e安装\u0026quot;GNOME Desktop\u0026quot;软件包组\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eyum groupinstall -y \u003cspan class=\"s2\"\u003e\u0026#34;GNOME Desktop\u0026#34;\u003c/span\u003e \n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e安装完成后，修改默认启动方式为图形化界面\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003esystemctl set-default graphical.target\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e如果要换回命令模式\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003esystemctl set-default multi-user.target \n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e然后重启系统即可\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eshutdown -r now\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e安装tigervnc\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eyum install tigervnc-server -y\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e过滤软件包是否安装\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003erpm -qa\u003cspan class=\"p\"\u003e|\u003c/span\u003egrep tigervnc-server\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e拷贝服务启动脚本，其中1表示端口号，默认5900+，1即是5901，以此类推：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003ecp /lib/systemd/system/vncserver@.service /etc/systemd/system/vncserver@:1.service\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e编辑服务启动脚本，设置登录使用的用户，这里使用的是\u003ccode\u003eroot\u003c/code\u003e用户\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003evim /etc/systemd/system/vncserver@\u003cspan class=\"se\"\u003e\\:\u003c/span\u003e1.service\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e \u003cspan class=\"m\"\u003e32\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003eUnit\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n \u003cspan class=\"m\"\u003e33\u003c/span\u003e \u003cspan class=\"nv\"\u003eDescription\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eRemote desktop service \u003cspan class=\"o\"\u003e(\u003c/span\u003eVNC\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n \u003cspan class=\"m\"\u003e34\u003c/span\u003e \u003cspan class=\"nv\"\u003eAfter\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003esyslog.target network.target\n \u003cspan class=\"m\"\u003e35\u003c/span\u003e \n \u003cspan class=\"m\"\u003e36\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003eService\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n \u003cspan class=\"m\"\u003e37\u003c/span\u003e \u003cspan class=\"nv\"\u003eType\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eforking\n \u003cspan class=\"m\"\u003e38\u003c/span\u003e \n \u003cspan class=\"m\"\u003e39\u003c/span\u003e \u003cspan class=\"c1\"\u003e# Clean any existing files in /tmp/.X11-unix environment\u003c/span\u003e\n \u003cspan class=\"m\"\u003e40\u003c/span\u003e \u003cspan class=\"nv\"\u003eExecStartPre\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e/bin/sh -c \u003cspan class=\"s1\"\u003e\u0026#39;/usr/bin/vncserver -kill %i \u0026gt; /dev/null 2\u0026gt;\u0026amp;1 || :\u0026#39;\u003c/span\u003e\n \u003cspan class=\"m\"\u003e41\u003c/span\u003e \u003cspan class=\"nv\"\u003eExecStart\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e/usr/sbin/runuser -l root -c \u003cspan class=\"s1\"\u003e\u0026#39;/usr/bin/vncserver %i\u0026#39;\u003c/span\u003e\n \u003cspan class=\"m\"\u003e42\u003c/span\u003e \u003cspan class=\"nv\"\u003ePIDFile\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e/root/.vnc/%H%i.pid\n \u003cspan class=\"m\"\u003e43\u003c/span\u003e \u003cspan class=\"nv\"\u003eExecStop\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e/bin/sh -c \u003cspan class=\"s1\"\u003e\u0026#39;/usr/bin/vncserver -kill %i \u0026gt; /dev/null 2\u0026gt;\u0026amp;1 || :\u0026#39;\u003c/span\u003e\n \u003cspan class=\"m\"\u003e44\u003c/span\u003e \n \u003cspan class=\"m\"\u003e45\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003eInstall\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n \u003cspan class=\"m\"\u003e46\u003c/span\u003e \u003cspan class=\"nv\"\u003eWantedBy\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003emulti-user.target\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e设置vnc密码，（“View-only password”，只允许查看,无控制权限，这个没啥用，不用设置。）\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003evncpasswd\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e开启vnc服务\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003esystemctl start vncserver@\u003cspan class=\"se\"\u003e\\:\u003c/span\u003e1.service\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e重新加载配置文件\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003esystemctl daemon-reload\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e开启自启动\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003esystemctl \u003cspan class=\"nb\"\u003eenable\u003c/span\u003e vncserver@\u003cspan class=\"se\"\u003e\\:\u003c/span\u003e1.service\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e过滤服务端口是否存在（无输出可再次重启服务尝试）\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003enetstat -utpln \u003cspan class=\"p\"\u003e|\u003c/span\u003e grep Xvnc\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e允许firewalld防火墙通过\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003efirewall-cmd --zone\u003cspan class=\"o\"\u003e=\u003c/span\u003epublic --add-port\u003cspan class=\"o\"\u003e=\u003c/span\u003e5901/tcp --permanent\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e重新加载生效\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003efirewall-cmd --reload\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e查看与VNC相关的SELinux域策略有哪些\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003egetsebool -a \u003cspan class=\"p\"\u003e|\u003c/span\u003e grep vnc\n\nxdm_bind_vnc_tcp_port --\u0026gt; off\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e修改SELinux策略，-P永久生效\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003esetsebool -P \u003cspan class=\"nv\"\u003exdm_bind_vnc_tcp_port\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eon\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","date":1635932320,"description":"","fuzzywordcount":500,"kind":"page","lang":"zh","lastmod":1646884080,"objectID":"94d0cc345c02dcb7a3c2165b541840d1","publishdate":1635932320,"relpermalink":"/posts/centos7_vnc/","section":"posts","summary":"安装\u0026quot;GNOME Desktop\u0026quot;软件包组","tags":["Linux"],"title":"CentOS7 安装 VNC","url":"https://ikuriko.github.io/posts/centos7_vnc/","wordcount":433},{"categories":"posts","content":"\u003ch2 id=\"常用命令\"\u003e常用命令\u003c/h2\u003e\n\u003ch3 id=\"查看\"\u003e查看\u003c/h3\u003e\n\u003cp\u003e列出所有网络设备\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003enmcli connection show\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e查看所有活动的连接\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003enmcli connection show --active\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e查看某个网络设备的详细信息\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003enmcli connection show ens33\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e查看网络设备状态\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003enmcli device status\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"添加\"\u003e添加\u003c/h3\u003e\n\u003cp\u003e新建网络连接\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003enmcli connection add \u003cspan class=\"nb\"\u003etype\u003c/span\u003e ethernet con-name ens33 ifname ens33\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e删除网络连接\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003enmcli connection delete ens33\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e重新加载配置文件\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003enmcli connection reload\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"修改\"\u003e修改\u003c/h3\u003e\n\u003cp\u003e修改IPv4地址的获取方式为手动\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003enmcli connection modify ens34 ipv4.method manual\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e添加第一个IPv4地址\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003enmcli con modify ens34 ipv4.addresses 192.168.1.1/24\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e添加第二个IPv4地址\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003enmcli con modify ens34 +ipv4.addresses 192.168.2.1/24\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e删除IPv4地址\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003enmcli con modify ens34 -ipv4.addresses 192.168.2.1/24\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e添加IP地址，网关和DNS\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003enmcli connection modify ens34 ipv4.gateway 192.168.0.254 ipv4.dns 8.8.8.8\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e添加第二个DNS(备用DNS)\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003enmcli connection modify ens34 +ipv4.dns 8.8.8.8\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e添加静态路由\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003enmcli connection modify ens34 +ipv4.routes \u003cspan class=\"s2\"\u003e\u0026#34;192.168.2.0/24 192.168.1.233\u0026#34;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e设置端口自动连接\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003enmcli connection modify ens34 autoconnect yes\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"控制\"\u003e控制\u003c/h3\u003e\n\u003cp\u003e启用网络设备\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003enmcli connection up ens33\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e关闭网络设备\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003enmcli connection down ens33\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e断开物理设备\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003enmcli device disconnec ens33\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e连接物理设备\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003enmcli device connect ens33\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"创建虚拟设备\"\u003e创建虚拟设备\u003c/h2\u003e\n\u003ch3 id=\"linux-br\"\u003eLinux-br\u003c/h3\u003e\n\u003cp\u003e创建名为 Brdige 的 Linux 网桥\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003enmcli connection add \u003cspan class=\"nb\"\u003etype\u003c/span\u003e bridge ifname Bridge con-name Bridge ipv4.method disable ipv6.method disable\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"gretap\"\u003egretap\u003c/h3\u003e\n\u003cp\u003e创建名为 gretap01 的 gretap 二层隧道，加入 Brdige 网桥\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003enmcli connection add \u003cspan class=\"nb\"\u003etype\u003c/span\u003e ip-tunnel mode gretap con-name gretap01 ifname gretap01 ip-tunnel.ttl \u003cspan class=\"m\"\u003e255\u003c/span\u003e ip-tunnel.input-key \u003cspan class=\"m\"\u003e1\u003c/span\u003e ip-tunnel.output-key \u003cspan class=\"m\"\u003e1\u003c/span\u003e \u003cspan class=\"nb\"\u003elocal\u003c/span\u003e 192.168.2.164 remote 192.168.2.91 ipv4.method disabled ipv6.method disabled master Bridge\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003enmcli 参数详解：\u003c/p\u003e\n\u003cp\u003eadd：新建连接\u003c/p\u003e\n\u003cp\u003etype：连接类型\u003c/p\u003e\n\u003cp\u003emode：ip-tunnel的隧道模式\u003c/p\u003e\n\u003cp\u003econ-name：网络连接名称\u003c/p\u003e\n\u003cp\u003eifname：设备接口名称\u003c/p\u003e\n\u003cp\u003eip-tunnel.ttl：ttl生命周期\u003c/p\u003e\n\u003cp\u003eip-tunnel.input-key：gre隧道的key值（input）\u003c/p\u003e\n\u003cp\u003eip-tunnel.output-key：gre隧道的key值（output）\u003c/p\u003e\n\u003cp\u003elocal：本地的IP地址\u003c/p\u003e\n\u003cp\u003eremote：远程的IP地址\u003c/p\u003e\n\u003cp\u003eautoconnect：自动连接\u003c/p\u003e\n\u003cp\u003eipv4.method：IPv4 配置方法\u003c/p\u003e\n\u003cp\u003eipv6.method：IPv6 配置方法\u003c/p\u003e\n\u003cp\u003emaster：隧道加入的网桥（按需添加）\u003c/p\u003e\n\u003ch3 id=\"gre\"\u003eGRE\u003c/h3\u003e\n\u003cp\u003e创建名为 gre01 的 GRE 三层隧道\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003enmcli connection add \u003cspan class=\"nb\"\u003etype\u003c/span\u003e ip-tunnel mode gre con-name gre01 ifname gre01 remote 192.168.2.91 \u003cspan class=\"nb\"\u003elocal\u003c/span\u003e 192.168.2.164 ipv4.addresses 172.233.1.2/24 ip-tunnel.input-key \u003cspan class=\"m\"\u003e1\u003c/span\u003e ip-tunnel.output-key \u003cspan class=\"m\"\u003e1\u003c/span\u003e ip-tunnel.ttl \u003cspan class=\"m\"\u003e255\u003c/span\u003e ipv4.method manual ipv6.method disable\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"vlan\"\u003evlan\u003c/h3\u003e\n\u003cp\u003e创建基于 ens33 网卡名为 ens33.1 的 vlan 子接口，加入 Bridge 网桥\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003enmcli connection add \u003cspan class=\"nb\"\u003etype\u003c/span\u003e vlan con-name ens33.1 ifname ens33.1 id \u003cspan class=\"m\"\u003e1\u003c/span\u003e master Bridge dev ens33\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"vxlan\"\u003evxlan\u003c/h3\u003e\n\u003cp\u003e\u003cstrong\u003evxlan创建命令（三层）\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e创建名为 vxlan1 的三层 vxlan\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003enmcli connection add \u003cspan class=\"nb\"\u003etype\u003c/span\u003e vxlan id \u003cspan class=\"m\"\u003e100\u003c/span\u003e remote 192.168.2.91 ipv4.addresses 172.233.233.1/24 ipv4.method manual ipv6.method disabled ifname vxlan1 connection.id vxlan1 vxlan.parent ens32\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cstrong\u003evxlan创建命令（二层）\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e创建名为 vxlan10 的二层 vxlan ，加入 Brdige 网桥\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003enmcli connection add \u003cspan class=\"nb\"\u003etype\u003c/span\u003e vxlan id \u003cspan class=\"m\"\u003e10\u003c/span\u003e remote 192.168.2.91 ipv4.method disabled ipv6.method disabled ifname vxlan10 connection.id vxlan10 vxlan.parent ens32 master Bridge\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","date":1635835045,"description":"","fuzzywordcount":800,"kind":"page","lang":"zh","lastmod":1646884193,"objectID":"1eb11fa5f67a3b94b2852c66969455a0","publishdate":1635835045,"relpermalink":"/posts/nmcli/","section":"posts","summary":"常用命令 查看 列出所有网络设备 nmcli connection show 查看所有活动的连接 nmcli connection show --active","tags":["Linux","NetworkManager"],"title":"nmcli 命令使用","url":"https://ikuriko.github.io/posts/nmcli/","wordcount":792},{"categories":"posts","content":"\u003cp\u003eLinux服务器运行时，扫描新插入的硬盘\u003c/p\u003e\n\u003cp\u003e此环境为VMware虚拟机，服务器真机同样适用\u003c/p\u003e\n\u003cp\u003e扫描所有磁盘\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"k\"\u003efor\u003c/span\u003e i in /sys/class/scsi_host/host*/scan\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"k\"\u003edo\u003c/span\u003e \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;- - -\u0026#34;\u003c/span\u003e \u0026gt;\u003cspan class=\"nv\"\u003e$i\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"k\"\u003edone\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e命令解释\u003c/p\u003e\n\u003cp\u003e'- - -'代表channel，target和LUN编号。以上命令会导致host下所有channel，target以及可见LUN被扫描\u003c/p\u003e\n\u003cp\u003eor\u003c/p\u003e\n\u003cp\u003e添加磁盘：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"nb\"\u003eecho\u003c/span\u003e “scsi add-single-device \u003cspan class=\"m\"\u003e1\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e \u003cspan class=\"m\"\u003e3\u003c/span\u003e 4” \u0026gt;/proc/scsi/scsi\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e移除硬盘：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"nb\"\u003eecho\u003c/span\u003e “scsi remove-single-device \u003cspan class=\"m\"\u003e1\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e \u003cspan class=\"m\"\u003e3\u003c/span\u003e 4” \u0026gt; /proc/scsi/scsi\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e命令行中的 1 2 3 4 需要自行修改成相应的参数：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e1 : SCSI HBA ID  主机适配器标识，第一个适配器为零(0)\u003c/li\u003e\n\u003cli\u003e2 : SCSI Channel  主机适配器上的 SCSI 通道，第一个通道为零(0)\u003c/li\u003e\n\u003cli\u003e3 : SCSI ID  设备的 SCSI 标识\u003c/li\u003e\n\u003cli\u003e4 : LUN ID   LUN 号，第一个 LUN 为零(0)\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e查看scsi磁盘的命令\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003elsscsi\n\n\u003cspan class=\"o\"\u003e[\u003c/span\u003e1:0:0:0\u003cspan class=\"o\"\u003e]\u003c/span\u003e  cd/dvd NECVMWar VMware IDE CDR10 1.00 /dev/sr0 \n\u003cspan class=\"o\"\u003e[\u003c/span\u003e2:0:0:0\u003cspan class=\"o\"\u003e]\u003c/span\u003e  disk  VMware, VMware Virtual S 1.0  /dev/sda \n\u003cspan class=\"o\"\u003e[\u003c/span\u003e2:0:1:0\u003cspan class=\"o\"\u003e]\u003c/span\u003e  disk  VMware, VMware Virtual S 1.0  /dev/sdb \n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003ecat /proc/scsi/scsi \n\nAttached devices:\nHost: scsi2 Channel: \u003cspan class=\"m\"\u003e00\u003c/span\u003e Id: \u003cspan class=\"m\"\u003e00\u003c/span\u003e Lun: \u003cspan class=\"m\"\u003e00\u003c/span\u003e\n Vendor: VMware, Model: VMware Virtual S Rev: 1.0 \n Type:  Direct-Access          ANSI SCSI revision: \u003cspan class=\"m\"\u003e02\u003c/span\u003e\nHost: scsi1 Channel: \u003cspan class=\"m\"\u003e00\u003c/span\u003e Id: \u003cspan class=\"m\"\u003e00\u003c/span\u003e Lun: \u003cspan class=\"m\"\u003e00\u003c/span\u003e\n Vendor: NECVMWar Model: VMware IDE CDR10 Rev: 1.00\n Type:  CD-ROM              ANSI SCSI revision: \u003cspan class=\"m\"\u003e05\u003c/span\u003e\nHost: scsi2 Channel: \u003cspan class=\"m\"\u003e00\u003c/span\u003e Id: \u003cspan class=\"m\"\u003e01\u003c/span\u003e Lun: \u003cspan class=\"m\"\u003e00\u003c/span\u003e\n Vendor: VMware, Model: VMware Virtual S Rev: 1.0 \n Type:  Direct-Access          ANSI SCSI revision: \u003cspan class=\"m\"\u003e02\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e未验证的方法\u003c/p\u003e\n\u003cp\u003e\u003cdel\u003e#使用rpm包sg3_utils 中的rescan-scsi-bus.sh脚本重新扫描\u003c/del\u003e\u003c/p\u003e\n\u003cp\u003e\u003cdel\u003e# /usr/bin/rescan-scsi-bus.sh\u003c/del\u003e\u003c/p\u003e\n","date":1635759701,"description":"","fuzzywordcount":500,"kind":"page","lang":"zh","lastmod":1646884161,"objectID":"52cc738b5fb2b2133db385fc50a20d4d","publishdate":1635759701,"relpermalink":"/posts/linux_hot_addition_disk/","section":"posts","summary":"Linux服务器运行时，扫描新插入的硬盘 此环境为VMware","tags":["Linux"],"title":"Linux 热添加硬盘","url":"https://ikuriko.github.io/posts/linux_hot_addition_disk/","wordcount":418},{"categories":"posts","content":"\u003ch2 id=\"简介\"\u003e简介\u003c/h2\u003e\n\u003cp\u003e\u003cstrong\u003eAnsible\u003c/strong\u003e目前是\u003cstrong\u003e运维自动化工具\u003c/strong\u003e中最简单、容易上手的一款优秀软件，能够用来管理各种资源，批量部署应用程序等。能够帮助运维人员提高工作效率，减少人为失误。例如，借助于Ansible，我们可以轻松地对服务器进行初始化配置、安全基线配置，以及进行更新和打补丁操作。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e基于模块\u003c/strong\u003e：Ansible服务本身并没有批量部署的功能，它仅仅是一个框架，真正具有批量部署能力的是其所运行的模块。Ansible有上千个功能丰富且实用的模块，几乎可以满足一切需求，使用起来也非常简单，而且有详尽的帮助信息可供查阅，可以轻松上手。如果需要更高级的功能，也可以运用Python语言对Ansible进行二次开发。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e基于SSH\u003c/strong\u003e：相较于Chef、Puppet、SaltStack等C/S（客户端/服务器）架构的自动化工具来讲，尽管Ansible的性能并不是最好的，但由于它基于SSH远程会话协议，不需要客户端程序，只要知道受管主机的账号密码，就能直接用SSH协议进行远程控制，因此使用起来优势明显。由于受控节点不需要安装客户端，而SSH协议是Linux系统的标配，因此可以直接通过SSH协议进行远程控制。在控制节点上，也不用每次都重复开启服务程序，使用ansible命令直接调用模块进行控制即可。\u003c/p\u003e\n\u003cp\u003eAnsible服务专用术语\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth style=\"text-align:left\"\u003e术语　\u003c/th\u003e\n\u003cth style=\"text-align:left\"\u003e服务名称 　　\u003c/th\u003e\n\u003cth\u003e含义\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003eControl node\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e控制节点\u003c/td\u003e\n\u003ctd\u003e指的是安装了Ansible服务的主机，也被称为Ansible控制端，主要是用来发布运行任务、调用功能模块，对其他主机进行批量控制。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003eManaged nodes\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e受控节点\u003c/td\u003e\n\u003ctd\u003e指的是被Ansible服务所管理的主机，也被称为受控主机或客户端，是模块命令的被执行对象。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003eInventory\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e主机清单\u003c/td\u003e\n\u003ctd\u003e指的是受控节点的列表，可以是IP地址、主机名称或者域名。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003eModules\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e模块\u003c/td\u003e\n\u003ctd\u003e指的是上文提到的特定功能代码，默认自带有上千款功能模块，在Ansible Galaxy有超多可供选择。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003eTask\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e任务\u003c/td\u003e\n\u003ctd\u003e指的是Ansible客户端上面要被执行的操作。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003ePlaybook\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e剧本\u003c/td\u003e\n\u003ctd\u003e指的是通过YAML语言编写的可重复执行的任务列表，把常做的操作写入到剧本文件中，下次可以直接重复执行一遍。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003eRoles\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e角色\u003c/td\u003e\n\u003ctd\u003e从Ansible 1.2版本开始引入的新特性，用于结构化的组织Playbook，通过调用角色实现一连串的功能。\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"部署服务\"\u003e部署服务\u003c/h2\u003e\n\u003cp\u003e备份原官方在线源\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003emv /etc/yum.repos.d/CentOS-Linux-BaseOS.repo /etc/yum.repos.d/CentOS-Linux-BaseOS.repo.bak\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e下载阿里云的在线源\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003ecurl -o /etc/yum.repos.d/CentOS-Linux-BaseOS.repo https://mirrors.aliyun.com/repo/Centos-8.repo\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e安装EPEL\u003csup id=\"fnref:1\"\u003e\u003ca href=\"#fn:1\" class=\"footnote-ref\" role=\"doc-noteref\"\u003e1\u003c/a\u003e\u003c/sup\u003e扩展软件包在线源\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003ednf install epel-release\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e安装ansible软件包\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003ednf install -y ansible\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e安装完毕后，Ansible服务便默认已经启动。可以看到Ansible服务的版本及配置信息。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eansible --version\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eAnsible服务配置文件优先级顺序\u003csup id=\"fnref:2\"\u003e\u003ca href=\"#fn:2\" class=\"footnote-ref\" role=\"doc-noteref\"\u003e2\u003c/a\u003e\u003c/sup\u003e\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003e优先级\u003c/th\u003e\n\u003cth\u003e文件位置\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003e高\u003c/td\u003e\n\u003ctd\u003e./ansible.cfg\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e中\u003c/td\u003e\n\u003ctd\u003e~/.ansible.cfg\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e低\u003c/td\u003e\n\u003ctd\u003e/etc/ansible/ansible.cfg\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"设置主机清单hosts\"\u003e设置主机清单（hosts）\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003e主机清单（inventory）。将要管理的主机IP预写入\u003ccode\u003e/etc/ansible/hosts\u003c/code\u003e文件，这样后续执行ansible命令的任务时就包含这些主机了\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e受管主机信息如下\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003e操作系统\u003c/th\u003e\n\u003cth\u003eIP地址\u003c/th\u003e\n\u003cth\u003e功能用途\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003eRHEL 8\u003c/td\u003e\n\u003ctd\u003e192.168.88.130\u003c/td\u003e\n\u003ctd\u003edev\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eRHEL 8\u003c/td\u003e\n\u003ctd\u003e192.168.88.139\u003c/td\u003e\n\u003ctd\u003eweb\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp\u003e#由于主机清单文件/etc/ansible/hosts中默认存在大量的注释信息，建议先备份文件，然后新建一个文件\u003c/p\u003e\n\u003cp\u003e备份hosts文件\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003emv /etc/ansible/hosts /etc/ansible/hosts.bak\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e新建hosts文件\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003evim /etc/ansible/hosts\n\n\u003cspan class=\"o\"\u003e[\u003c/span\u003edevserver\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n192.168.88.130\n\u003cspan class=\"o\"\u003e[\u003c/span\u003ewebserver\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n192.168.88.139 \n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eAnsible是基于SSH实现自动化控制的，sshd服务在初次连接时回要求用户接受一次对方主机的指纹信息，然后再输入主机的账号和密码，这样是非常麻烦的。而Ansible提供了变量来解决这个问题\u003c/p\u003e\n\u003cp\u003eAnsible常用变量汇总\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003e参数\u003c/th\u003e\n\u003cth\u003e作用\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003eansible_ssh_host\u003c/td\u003e\n\u003ctd\u003e受管主机名\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eansible_ssh_port\u003c/td\u003e\n\u003ctd\u003e端口号\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eansible_ssh_user\u003c/td\u003e\n\u003ctd\u003e默认账号\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eansible_ssh_pass\u003c/td\u003e\n\u003ctd\u003e默认密码\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eansible_\u003ca href=\"https://www.linuxcool.com/\"\u003eshell\u003c/a\u003e_type\u003c/td\u003e\n\u003ctd\u003eShell终端类型\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp\u003e用户只需要将对应的变量及信息填写到主机清单文件中，在执行任务时便会自动对账号和密码进行匹配，而不用每次重复输入它们。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003evim /etc/ansible/hosts\n\n\u003cspan class=\"o\"\u003e[\u003c/span\u003edevserver\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n192.168.88.130\n\u003cspan class=\"o\"\u003e[\u003c/span\u003ewebserver\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n192.168.88.139\n\n\u003cspan class=\"o\"\u003e[\u003c/span\u003eall:vars\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003cspan class=\"nv\"\u003eansible_user\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eroot\n\u003cspan class=\"nv\"\u003eansible_password\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e123\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e以结构化的方式显示出受管主机的信息\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eansible-inventory --graph\n\n@all:\n \u003cspan class=\"p\"\u003e|\u003c/span\u003e--@devserver:\n \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e--192.168.88.130\n \u003cspan class=\"p\"\u003e|\u003c/span\u003e--@ungrouped:\n \u003cspan class=\"p\"\u003e|\u003c/span\u003e--@webserver:\n \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e--192.168.88.139\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e修改Ansible主配置文件\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003evim /etc/ansible/ansible.cfg\n\n\u003cspan class=\"m\"\u003e71\u003c/span\u003e \u003cspan class=\"nv\"\u003ehost_key_checking\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e False           \u003cspan class=\"c1\"\u003e#关闭SSH协议的指纹验证\u003c/span\u003e\n\u003cspan class=\"m\"\u003e107\u003c/span\u003e \u003cspan class=\"nv\"\u003eremote_user\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e root                 \u003cspan class=\"c1\"\u003e#默认执行剧本时所使用的管理员名称为root\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e修改后不需要重启服务\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e连接host主机时ssh密钥不匹配怎么办\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003e在/root/.ssh/known_hosts中添加正确的主机密钥。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e修改在/root/.ssh/known_主机中有问题的ECDSA密钥：1\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e直接删除 rm /root/.ssh/known_hosts\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"运行临时命令ansible\"\u003e运行临时命令（ansible）\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003eAnsible服务的强大之处在于只需要一条命令，便可以操控成千上万台的主机节点，而ansible命令便是最得力的工具之一。ansible命令是用于执行临时任务的命令，一次性执行后结束，无法重复执行。前面提到，Ansible服务实际上只是一个框架，能够完成工作的是模块化功能代码。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eAnsible服务常用模块名称及作用\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003e模块名称\u003c/th\u003e\n\u003cth\u003e模块作用\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003eping\u003c/td\u003e\n\u003ctd\u003e检查受管节点主机网络是否能够联通。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eyum\u003c/td\u003e\n\u003ctd\u003e安装、更新及卸载软件包。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eyum_repository\u003c/td\u003e\n\u003ctd\u003e管理主机的软件仓库配置文件。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003etemplate\u003c/td\u003e\n\u003ctd\u003e复制模板文件到受管节点主机。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003ecopy\u003c/td\u003e\n\u003ctd\u003e新建、修改及复制文件。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003euser\u003c/td\u003e\n\u003ctd\u003e创建、修改及删除用户。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003egroup\u003c/td\u003e\n\u003ctd\u003e创建、修改及删除用户组。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eservice\u003c/td\u003e\n\u003ctd\u003e启动、关闭及查看服务状态。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eget_url\u003c/td\u003e\n\u003ctd\u003e从网络中下载文件。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003efile\u003c/td\u003e\n\u003ctd\u003e设置文件权限及创建快捷方式。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003ecron\u003c/td\u003e\n\u003ctd\u003e添加、修改及删除计划任务。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003ecommand\u003c/td\u003e\n\u003ctd\u003e直接执行用户指定的命令。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eshell\u003c/td\u003e\n\u003ctd\u003e直接执行用户指定的命令（支持特殊字符）。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003edebug\u003c/td\u003e\n\u003ctd\u003e输出调试或报错信息。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003emount\u003c/td\u003e\n\u003ctd\u003e挂载硬盘设备文件。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003efilesystem\u003c/td\u003e\n\u003ctd\u003e格式化硬盘设备文件。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003elineinfile\u003c/td\u003e\n\u003ctd\u003e通过正则表达式修改文件内容。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003esetup\u003c/td\u003e\n\u003ctd\u003e收集受管节点主机上的系统及变量信息。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003efirewalld\u003c/td\u003e\n\u003ctd\u003e添加、修改及删除防火墙策略。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003elvg\u003c/td\u003e\n\u003ctd\u003e管理主机的物理卷及卷组设备。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003elvol\u003c/td\u003e\n\u003ctd\u003e管理主机的逻辑卷设备。\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp\u003e在使用ansible命令时，必须指明受管主机的信息，如果已经设置过主机清单文件（/etc/ansible/hosts），则可以使用all参数来指代全体受管主机，或是用dev、test等主机组名称来指代某一组的主机。\u003c/p\u003e\n\u003cp\u003eansible命令常用的语法格式为　ansible 受管主机节点 -m 模块名称 [-a模块参数]　，常见的参数如表所示。其中，-a是要传递给模块的参数，只有功能极其简单的模块才不需要额外参数，所以大多情况下 -m 与 -a 参数都会同时出现。\u003c/p\u003e\n\u003cp\u003eansible命令常用参数\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003e参数\u003c/th\u003e\n\u003cth\u003e作用\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003e-k\u003c/td\u003e\n\u003ctd\u003e手动输入SSH协议密码\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e-i\u003c/td\u003e\n\u003ctd\u003e指定主机清单文件\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e-m\u003c/td\u003e\n\u003ctd\u003e指定要使用的模块名\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e-M\u003c/td\u003e\n\u003ctd\u003e指定要使用的模块路径\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e-S\u003c/td\u003e\n\u003ctd\u003e使用su命令\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e-T\u003c/td\u003e\n\u003ctd\u003e设置SSH协议连接超时时间\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e-a\u003c/td\u003e\n\u003ctd\u003e设置传递给模块的参数\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e--version\u003c/td\u003e\n\u003ctd\u003e查看版本信息\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp\u003e如果想实现某个功能，但是却不知道用什么模块，又或者是知道了模块名称，但不清楚模块具体的作用，则建议使用ansible-doc命令进行查找。例如，列举出当前Ansible服务所支持的所有模块信息：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eansible-doc -l\n\na10_server                          Manage A10 Netwo...\na10_server_axapi3                       Manage A10 Netwo...\na10_service_group                       Manage A10 Netwo...\na10_virtual_server                      Manage A10 Netwo...\naci_aaa_user                         Manage AAA users...\naci_aaa_user_certificate                   Manage AAA user ...\naci_access_port_block_to_access_port             Manage port bloc...\naci_access_port_to_interface_policy_leaf_profile       Manage Fabric in...\naci_access_sub_port_block_to_access_port           Manage sub port ...\naci_aep                            Manage attachabl...\naci_aep_to_domain                       Bind AEPs to Phy...\naci_ap                            Manage top level...\naci_bd                            Manage Bridge Do...\naci_bd_subnet                         Manage Subnets \u003cspan class=\"o\"\u003e(\u003c/span\u003e...\naci_bd_to_l3out                        Bind Bridge Doma...\naci_config_rollback                      Provides rollbac...\n…………\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e一般情况下，很难通过名称来判别一个模块的作用，要么是参考模块后面的介绍信息，要么是平时多学多练，进行积累。例如，接下来随机查看一个模块的详细信息。ansible-doc命令会在屏幕上显示出这个模块的作用、可用参数及实例等信息：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-yaml\" data-lang=\"yaml\"\u003e\u003cspan class=\"l\"\u003eansible-doc aci_domain\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"l\"\u003e\u0026gt; ACI_DOMAIN  (/usr/lib/python3.6/site-packages/ansible/modules/network/aci/aci_\u0026gt;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"l\"\u003e​    Manage physical, virtual, bridged, routed or FC domain\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"l\"\u003e​    profiles on Cisco ACI fabrics.\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e*\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eThis module is maintained by an Ansible Partner\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"l\"\u003e…………\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e之前已经成功地将受管主机的IP地址填写到主机清单文件中，接下来检查一下这些主机的网络连通性。ping模块用于进行简单的网络测试（类似于常用的ping命令）。可以使用ansible命令直接针对所有主机调用ping模块，不需要增加额外的参数，返回值若为SUCCESS，则表示主机当前在线。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eansible all -m ping\n\n192.168.88.139 \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nv\"\u003eSUCCESS\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e\u0026gt; \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"s2\"\u003e\u0026#34;ansible_facts\u0026#34;\u003c/span\u003e: \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n​    \u003cspan class=\"s2\"\u003e\u0026#34;discovered_interpreter_python\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;/usr/libexec/platform-python\u0026#34;\u003c/span\u003e\n  \u003cspan class=\"o\"\u003e}\u003c/span\u003e,\n  \u003cspan class=\"s2\"\u003e\u0026#34;changed\u0026#34;\u003c/span\u003e: false,\n  \u003cspan class=\"s2\"\u003e\u0026#34;ping\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;pong\u0026#34;\u003c/span\u003e\n\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n192.168.88.130 \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nv\"\u003eSUCCESS\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e\u0026gt; \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"s2\"\u003e\u0026#34;ansible_facts\u0026#34;\u003c/span\u003e: \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n​    \u003cspan class=\"s2\"\u003e\u0026#34;discovered_interpreter_python\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;/usr/libexec/platform-python\u0026#34;\u003c/span\u003e\n  \u003cspan class=\"o\"\u003e}\u003c/span\u003e,\n  \u003cspan class=\"s2\"\u003e\u0026#34;changed\u0026#34;\u003c/span\u003e: false,\n  \u003cspan class=\"s2\"\u003e\u0026#34;ping\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;pong\u0026#34;\u003c/span\u003e\n\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e除了使用-m参数直接指定模块名称之外，还可以用-a参数将参数传递给模块，让模块的功能更高级，更好地满足当前生产的需求。例如，yum_repository模块的作用是管理主机的软件仓库，能够添加、修改及删除软件仓库的配置信息，参数相对比较复杂。遇到这种情况时，建议先用ansible-doc命令对其进行了解。尤其是下面的EXAMPLES结构段会有该模块的实例，对用户来说有非常高的参考价值。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eansible-doc -l \u003cspan class=\"p\"\u003e|\u003c/span\u003e grep yum\n\nyum                              Manages packages with the \u003cspan class=\"sb\"\u003e`\u003c/span\u003eyum\u003cspan class=\"err\"\u003e\u0026#39;\u003c/span\u003e package manager                  \nyum_repository                        Add or remove YUM repositories\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-yaml\" data-lang=\"yaml\"\u003e\u003cspan class=\"l\"\u003eansible-doc yum_repository\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"l\"\u003e\u0026gt; YUM_REPOSITORY  (/usr/lib/python3.6/site-packages/ansible/modules/packaging/os/yum_repository.py)\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e     \u003c/span\u003e\u003cspan class=\"l\"\u003eAdd or remove YUM repositories in RPM-based Linux distributions. If you wish to update an existing repository\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e     \u003c/span\u003e\u003cspan class=\"l\"\u003edefinition use [ini_file] instead.\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e     \n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e*\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eThis module is maintained by The Ansible Core Team\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003eOPTIONS (= is mandatory)\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003eEXAMPLES\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eAdd repository\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003eyum_repository\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eepel\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003edescription\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eEPEL YUM repo\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003ebaseurl\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ehttps://download.fedoraproject.org/pub/epel/$releasever/$basearch/\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eAdd multiple repositories into the same file (1/2)\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003eyum_repository\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eepel\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003edescription\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eEPEL YUM repo\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003efile\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eexternal_repos\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003ebaseurl\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ehttps://download.fedoraproject.org/pub/epel/$releasever/$basearch/\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003egpgcheck\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"kc\"\u003eno\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eAdd multiple repositories into the same file (2/2)\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003eyum_repository\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003erpmforge\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003edescription\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eRPMforge YUM repo\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003efile\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eexternal_repos\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003ebaseurl\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ehttp://apt.sw.be/redhat/el7/en/$basearch/rpmforge\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e参数并不是很多，而且与/etc/yum.repos.d/目录中的配置文件基本相似。现在，想为主机清单中的所有服务器新增一个如表所示的软件仓库，该怎么操作呢？\u003c/p\u003e\n\u003cp\u003e新增软件仓库信息\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003e仓库名称\u003c/th\u003e\n\u003cth\u003eCentOS-8-Base-mirrors.aliyun.com\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003e仓库描述\u003c/td\u003e\n\u003ctd\u003emirrors.163.com\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e仓库地址\u003c/td\u003e\n\u003ctd\u003e\u003ca href=\"https://mirrors.aliyun.com/centos/$releasever/BaseOS/$basearch/os/\"\u003ehttps://mirrors.aliyun.com/centos/$releasever/BaseOS/$basearch/os/\u003c/a\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003ctd\u003e\u003ca href=\"http://mirrors.cloud.aliyuncs.com/centos/$releasever/BaseOS/$basearch/os/\"\u003ehttp://mirrors.cloud.aliyuncs.com/centos/$releasever/BaseOS/$basearch/os/\u003c/a\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003ctd\u003e\u003ca href=\"http://mirrors.aliyuncs.com/centos/$releasever/BaseOS/$basearch/os/\"\u003ehttp://mirrors.aliyuncs.com/centos/$releasever/BaseOS/$basearch/os/\u003c/a\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eGPG签名\u003c/td\u003e\n\u003ctd\u003e启用\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eGPG密钥文件\u003c/td\u003e\n\u003ctd\u003e\u003ca href=\"file://media/cdrom/RPM-GPG-KEY-redhat-release\"\u003ehttps://mirrors.aliyun.com/centos/RPM-GPG-KEY-CentOS-Official\u003c/a\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp\u003e我们可以对照着EXAMPLE实例段，逐一对应填写需求值和参数，其标准格式是在-a参数后接整体参数（用单引号圈起），而各个参数字段的值则用双引号圈起。这是最严谨的写法。在执行下述命令后如果出现CHANGED字样，则表示修改已经成功：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-yaml\" data-lang=\"yaml\"\u003e\u003cspan class=\"l\"\u003eansible all -m yum_repository -a \u0026#39;name=\u0026#34;CentOS-8-Base-mirrors.aliyun.com\u0026#34; description=\u0026#34;mirrors.163.com\u0026#34; baseurl=\u0026#34;https://mirrors.aliyun.com/centos/$releasever/BaseOS/$basearch/os/ \\n http://mirrors.aliyuncs.com/centos/$releasever/BaseOS/$basearch/os/ \\n http://mirrors.cloud.aliyuncs.com/centos/$releasever/BaseOS/$basearch/os/\u0026#34; gpgcheck=yes enabled=1 gpgkey=\u0026#34;https://mirrors.aliyun.com/centos/RPM-GPG-KEY-CentOS-Official\u0026#34;\u0026#39;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e192.168.88.139 \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nv\"\u003eCHANGED\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e\u0026gt; \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"s2\"\u003e\u0026#34;ansible_facts\u0026#34;\u003c/span\u003e: \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n​    \u003cspan class=\"s2\"\u003e\u0026#34;discovered_interpreter_python\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;/usr/libexec/platform-python\u0026#34;\u003c/span\u003e\n  \u003cspan class=\"o\"\u003e}\u003c/span\u003e,\n  \u003cspan class=\"s2\"\u003e\u0026#34;changed\u0026#34;\u003c/span\u003e: true,\n  \u003cspan class=\"s2\"\u003e\u0026#34;repo\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;CentOS-8-Base-mirrors.aliyun.com\u0026#34;\u003c/span\u003e,\n  \u003cspan class=\"s2\"\u003e\u0026#34;state\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;present\u0026#34;\u003c/span\u003e\n\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\n192.168.88.130 \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nv\"\u003eCHANGED\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e\u0026gt; \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"s2\"\u003e\u0026#34;ansible_facts\u0026#34;\u003c/span\u003e: \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n​    \u003cspan class=\"s2\"\u003e\u0026#34;discovered_interpreter_python\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;/usr/libexec/platform-python\u0026#34;\u003c/span\u003e\n  \u003cspan class=\"o\"\u003e}\u003c/span\u003e,\n  \u003cspan class=\"s2\"\u003e\u0026#34;changed\u0026#34;\u003c/span\u003e: true,\n  \u003cspan class=\"s2\"\u003e\u0026#34;repo\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;CentOS-8-Base-mirrors.aliyun.com\u0026#34;\u003c/span\u003e,\n  \u003cspan class=\"s2\"\u003e\u0026#34;state\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;present\u0026#34;\u003c/span\u003e\n\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e在命令执行成功后，可以到主机清单中的任意机器上查看新建成功的软件仓库配置文件。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003eroot@play2 ~\u003cspan class=\"o\"\u003e]\u003c/span\u003e\u003cspan class=\"c1\"\u003e# cat /etc/yum.repos.d/CentOS-8-Base-mirrors.aliyun.com.repo \u003c/span\u003e\n\u003cspan class=\"o\"\u003e[\u003c/span\u003eCentOS-8-Base-mirrors.aliyun.com\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003cspan class=\"nv\"\u003ebaseurl\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e https://mirrors.aliyun.com/centos/\u003cspan class=\"nv\"\u003e$releasever\u003c/span\u003e/BaseOS/\u003cspan class=\"nv\"\u003e$basearch\u003c/span\u003e/os/\n          http://mirrors.aliyuncs.com/centos/\u003cspan class=\"nv\"\u003e$releasever\u003c/span\u003e/BaseOS/\u003cspan class=\"nv\"\u003e$basearch\u003c/span\u003e/os/\n          http://mirrors.cloud.aliyuncs.com/centos/\u003cspan class=\"nv\"\u003e$releasever\u003c/span\u003e/BaseOS/\u003cspan class=\"nv\"\u003e$basearch\u003c/span\u003e/os/\n\u003cspan class=\"nv\"\u003eenabled\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\n\u003cspan class=\"nv\"\u003egpgcheck\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\n\u003cspan class=\"nv\"\u003egpgkey\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e https://mirrors.aliyun.com/centos/RPM-GPG-KEY-CentOS-Official\n\u003cspan class=\"nv\"\u003ename\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e mirrors.163.com\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"运行剧本文件playbook\"\u003e运行剧本文件（playbook）\u003c/h2\u003e\n\u003cp\u003e使用ansible临时命令仅执行单个命令或调用某一个模块，根本无法满足复杂工作的需求。所以Ansible服务允许用户根据需求，编写类似于shell脚本从上到下按顺序运行命令的playbook，由程序自动、重复的执行。\u003c/p\u003e\n\u003cp\u003eAnsible服务的剧本（playbook）文件采用\u003cstrong\u003eYAML\u003c/strong\u003e语言编写，具有\u003cstrong\u003e强制性的格式规范\u003c/strong\u003e，它通过空格将不同信息分组，因此有时会因一两个空格错位而导致报错。使用时要万分小心。YAML文件的开头需要先写3个减号（---），多个分组的信息需要间隔一致才能执行，而且上下也要对齐，后缀名一般为.yml。剧本文件在执行后，会在屏幕上输出运行界面，内容会根据工作的不同而变化。在运行界面中，绿色表示成功，黄色表示执行成功并进行了修改，而红色则表示执行失败。\u003c/p\u003e\n\u003cp\u003e剧本文件的结构由4部分组成，分别是target、variable、task、handler，其各自的作用如下。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003etarget：用于定义要执行剧本的主机范围。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003evariable：用于定义剧本执行时要用到的变量。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003etask：用于定义将在远程主机上执行的任务列表。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003ehandler：用于定义执行完成后需要调用的后续任务。\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e例如，创建一个名为packages.yml的剧本，让dev、test组的主机可以自动安装数据库软件，并且将dev组主机的软件更新至最新。\u003c/p\u003e\n\u003cp\u003e安装和更新软件需要使用yum模块。先看一下帮助信息中的示例吧：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-yaml\" data-lang=\"yaml\"\u003e\u003cspan class=\"l\"\u003eansible-doc yum\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"l\"\u003e\u0026gt; YUM  (/usr/lib/python3.6/site-packages/ansible/modules/packaging/os/yum.py)\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"l\"\u003e​    Installs, upgrade, downgrades, removes, and lists packages and\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"l\"\u003e​    groups with the `yum\u0026#39; package manager. This module only works\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"l\"\u003e​    on Python 2. If you require Python 3 support see the [dnf]\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"l\"\u003e​    module.\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e*\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eThis module is maintained by The Ansible Core Team\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003e* note\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eThis module has a corresponding action plugin.\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003eEXAMPLES\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003einstall the latest version of Apache\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003eyum\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ehttpd\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003estate\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003elatest\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eensure a list of packages installed\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003eyum\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;{{ packages }}\u0026#34;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003evars\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003epackages\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e- \u003cspan class=\"l\"\u003ehttpd\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e- \u003cspan class=\"l\"\u003ehttpd-tools\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e在配置Ansible剧本文件时，ansible-doc命令提供的帮助信息真是好用。在知道yum模块的使用方法和格式后，就可以开始编写剧本了。初次编写剧本文件时，请务必看准格式，模块及play（动作）格式也要上下对齐，否则会出现“参数一模一样，但不能执行”的情况。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003evim packages.yml\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-yaml\" data-lang=\"yaml\"\u003e\u003cspan class=\"nn\"\u003e---\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003e安装软件包\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003ehosts\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003edevserver,webserver\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003etasks\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e          \u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003esql\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e            \u003c/span\u003e\u003cspan class=\"nt\"\u003eyum\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e                    \u003c/span\u003e\u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003emariadb\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e                    \u003c/span\u003e\u003cspan class=\"nt\"\u003estate\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003elatest\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cstrong\u003ename\u003c/strong\u003e字段表示此项play（动作）的名字，用于在执行过程中提示用户执行到了哪一步，可以在name字段自行命名，没有任何限制。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003ehosts\u003c/strong\u003e字段表示要在哪些主机上执行该剧本，多个主机组之间用逗号间隔；如果需要对全部主机进行操作，则使用all参数。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003etasks\u003c/strong\u003e字段用于定义要执行的任务，每个任务都要有一个独立的name字段进行命名，并且每个任务的name字段和模块名称都要严格上下对齐，参数要单独缩进。\u003c/p\u003e\n\u003cp\u003e在确认无误后就可以用\u003ccode\u003eansible-playbook\u003c/code\u003e命令运行这个剧本文件了。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003eroot@play1 ~\u003cspan class=\"o\"\u003e]\u003c/span\u003e\u003cspan class=\"c1\"\u003e# ansible-playbook packages.yml \u003c/span\u003e\nPLAY \u003cspan class=\"o\"\u003e[\u003c/span\u003e安装软件包\u003cspan class=\"o\"\u003e]\u003c/span\u003e ***********************************************************************\n\nTASK \u003cspan class=\"o\"\u003e[\u003c/span\u003eGathering Facts\u003cspan class=\"o\"\u003e]\u003c/span\u003e *************************************************************\nok: \u003cspan class=\"o\"\u003e[\u003c/span\u003e192.168.88.139\u003cspan class=\"o\"\u003e]\u003c/span\u003e\nok: \u003cspan class=\"o\"\u003e[\u003c/span\u003e192.168.88.130\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\nTASK \u003cspan class=\"o\"\u003e[\u003c/span\u003esql\u003cspan class=\"o\"\u003e]\u003c/span\u003e *************************************************************************\nchanged: \u003cspan class=\"o\"\u003e[\u003c/span\u003e192.168.88.130\u003cspan class=\"o\"\u003e]\u003c/span\u003e\nchanged: \u003cspan class=\"o\"\u003e[\u003c/span\u003e192.168.88.139\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\nPLAY RECAP *************************************************************************\n192.168.88.130       : \u003cspan class=\"nv\"\u003eok\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e  \u003cspan class=\"nv\"\u003echanged\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e  \u003cspan class=\"nv\"\u003eunreachable\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e  \u003cspan class=\"nv\"\u003efailed\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e  \u003cspan class=\"nv\"\u003eskipped\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e  \u003cspan class=\"nv\"\u003erescued\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e  \u003cspan class=\"nv\"\u003eignored\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e  \n192.168.88.139       : \u003cspan class=\"nv\"\u003eok\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e  \u003cspan class=\"nv\"\u003echanged\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e  \u003cspan class=\"nv\"\u003eunreachable\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e  \u003cspan class=\"nv\"\u003efailed\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e  \u003cspan class=\"nv\"\u003eskipped\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e  \u003cspan class=\"nv\"\u003erescued\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e  \u003cspan class=\"nv\"\u003eignored\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e \n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e在执行成功后，我们主要观察最下方的输出信息。其中，ok和changed表示执行及修改成功。如遇到unreachable或failed大于0的情况，建议手动检查剧本是否在所有主机中都正确运行了，以及有无安装失败的情况。在正确执行过packages.yml文件后，随机切换到dev、test、prod组中的任意一台主机上，再次安装mariadb软件包，此时会提示该服务已经存在。这说明刚才的操作一切顺利！\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003eroot@play2 ~\u003cspan class=\"o\"\u003e]\u003c/span\u003e\u003cspan class=\"c1\"\u003e# dnf install mariadb\u003c/span\u003e\nLast metadata expiration check: 1:12:15 ago on Wed \u003cspan class=\"m\"\u003e27\u003c/span\u003e Oct \u003cspan class=\"m\"\u003e2021\u003c/span\u003e 06:28:24 PM CST.\nPackage mariadb-3:10.3.28-1.module_el8.3.0+757+d382997d.x86_64 is already installed.\nDependencies resolved.\nNothing to \u003cspan class=\"k\"\u003edo\u003c/span\u003e.\nComplete!\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"创建及使用角色role\"\u003e创建及使用角色（role）\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e在日常编写剧本时，会存在剧本越来越长的情况，这不利于进行阅读和维护，而且还无法让其他剧本灵活地调用其中的功能代码。角色（role）这一功能则是自Ansible 1.2版本开始引入的新特性，用于层次性、结构化地组织剧本。\u003c/p\u003e\n\u003cp\u003e角色功能分别把变量、文件、任务、模块及处理器配置放在各个独立的目录中，然后对其进行便捷加载。简单来说，\u003cstrong\u003e角色功能是把常用的一些功能“类模块化”\u003c/strong\u003e，然后在用的时候加载即可。\u003c/p\u003e\n\u003cp\u003eAnsible服务的角色功能类似于编程中的封装技术—将具体的功能封装起来，用户不仅可以方便地调用它，而且甚至可以不用完全理解其中的原理。这便是技术封装的好处。\u003c/p\u003e\n\u003cp\u003e角色的好处就在于将剧本组织成了一个简洁的、可重复调用的抽象对象，使得用户把注意力放到剧本的宏观大局上，统筹各个关键性任务，只有在需要时才去深入了解细节。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eAnsible有3种角色的获取方法，分别是加载系统内置角色、从外部环境获取角色以及自行创建角色。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch3 id=\"加载系统内置角色\"\u003e加载系统内置角色\u003c/h3\u003e\n\u003cp\u003e在使用RHEL系统的内置角色时，我们不需要联网就能实现。用户只需要配置好软件仓库的配置文件，然后安装包含系统角色的软件包rhel-system-roles，随后便可以在系统中找到它们了，然后就能够使用剧本文件调用角色了。\u003c/p\u003e\n\u003cp\u003e安装包含系统角色的软件包\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003ednf install -y rhel-system-roles\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e安装完毕后，查看RHEL 8系统中有哪些自带的角色可用\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eansible-galaxy list\n\n\u003cspan class=\"c1\"\u003e# /usr/share/ansible/roles\u003c/span\u003e\n- linux-system-roles.certificate, \u003cspan class=\"o\"\u003e(\u003c/span\u003eunknown version\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n- linux-system-roles.crypto_policies, \u003cspan class=\"o\"\u003e(\u003c/span\u003eunknown version\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n- linux-system-roles.ha_cluster, \u003cspan class=\"o\"\u003e(\u003c/span\u003eunknown version\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n- linux-system-roles.kdump, \u003cspan class=\"o\"\u003e(\u003c/span\u003eunknown version\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n- linux-system-roles.kernel_settings, \u003cspan class=\"o\"\u003e(\u003c/span\u003eunknown version\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n- linux-system-roles.logging, \u003cspan class=\"o\"\u003e(\u003c/span\u003eunknown version\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n……\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e千万不要低估这些由系统镜像自带的角色，它们在日常的工作中能派上大用场。\u003c/p\u003e\n\u003cp\u003eansible系统角色描述\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003e角色名称\u003c/th\u003e\n\u003cth\u003e作用\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003erhel-system-roles.kdump\u003c/td\u003e\n\u003ctd\u003e配置kdump崩溃恢复服务\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003erhel-system-roles.network\u003c/td\u003e\n\u003ctd\u003e配置网络接口\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003erhel-system-roles.selinux\u003c/td\u003e\n\u003ctd\u003e配置SELinux策略及模式\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003erhel-system-roles.timesync\u003c/td\u003e\n\u003ctd\u003e配置网络时间协议\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003erhel-system-roles.postfix\u003c/td\u003e\n\u003ctd\u003e配置邮件传输服务\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003erhel-system-roles.firewall\u003c/td\u003e\n\u003ctd\u003e配置防火墙服务\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003erhel-system-roles.tuned\u003c/td\u003e\n\u003ctd\u003e配置系统调优选项\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp\u003e以rhel-system-roles.timesync角色为例，它用于设置系统的时间和NTP服务，让主机能够同步准确的时间信息。剧本模板文件存放在/usr/share/doc/rhel-system-roles/目录中，可以复制过来修改使用：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003ecp /usr/share/doc/rhel-system-roles/timesync/example-timesync-playbook.yml timesync.yml\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eNTP服务器主要用于同步计算机的时间，可以提供高精度的时间校准服务，帮助计算机校对系统时钟。在复制来的剧本模板文件中，删除掉多余的代码，将NTP服务器的地址填写到timesync_ntp_servers变量的hostname字段中即可。该变量的参数含义如表所示。稍后timesync角色就会自动为用户配置参数信息了。\u003c/p\u003e\n\u003cp\u003etimesync_ntp_servers变量参数含义\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003e参数\u003c/th\u003e\n\u003cth\u003e作用\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003ehostname\u003c/td\u003e\n\u003ctd\u003eNTP服务器主机名\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eiburst\u003c/td\u003e\n\u003ctd\u003e启用快速同步\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp\u003e新建剧本文件，调用系统角色\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003evim timesync.yml\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-yaml\" data-lang=\"yaml\"\u003e\u003cspan class=\"nn\"\u003e---\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e- \u003cspan class=\"nt\"\u003ehosts\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eall\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003evars\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003etimesync_ntp_servers\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e- \u003cspan class=\"nt\"\u003ehostname\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003entp.aliyun.com\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e\u003cspan class=\"nt\"\u003eiburst\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"kc\"\u003eyes\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003eroles\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e- \u003cspan class=\"l\"\u003erhel-system-roles.timesync\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e执行剧本文件\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eansible-playbook timesync.yml\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"从外部获取角色\"\u003e从外部获取角色\u003c/h3\u003e\n\u003cp\u003eAnsible Galaxy是Ansible的一个官方社区，用于共享角色和功能代码，用户可以在网站自由地共享和下载Ansible角色。该社区是管理和使用角色的不二之选。\u003c/p\u003e\n\u003cp\u003e在Ansible Galaxy官网中，左侧有3个功能选项，分别是首页（Home）、搜索（Search）以及社区（Community）。单击Search按钮进入到搜索界面，这里以nginx服务为例进行搜索，即可找到Nginx官方发布的角色信息\u003c/p\u003e\n\u003cp\u003e当单击nginx角色进入到详情页面后，会显示这个项目的软件版本、评分、下载次数等信息。在Installation字段可以看到相应的安装方式，在保持虚拟机能够连接外网的前提下，可以按这个页面提示的命令进行安装。\u003c/p\u003e\n\u003cp\u003e这时，如果需要使用这个角色，可以在虚拟机联网的状态下直接按照“ansible-galaxy install角色名称”的命令格式自动获取：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eansible-galaxy collection install nginxinc.nginx_core\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e执行完毕后，再次查看系统中已有的角色，便可找到nginx角色信息了：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eansible-galaxy list\n\n\u003cspan class=\"c1\"\u003e# /etc/ansible/roles\u003c/span\u003e\n- nginxinc.nginx, 0.19.1\n\u003cspan class=\"c1\"\u003e# /usr/share/ansible/roles\u003c/span\u003e\n- linux-system-roles.kdump, \u003cspan class=\"o\"\u003e(\u003c/span\u003eunknown version\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n- linux-system-roles.network, \u003cspan class=\"o\"\u003e(\u003c/span\u003eunknown version\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e这里还存在两种特殊情况。\u003c/p\u003e\n\u003cp\u003e在国内问Ansible Galaxy官网时可能存在不稳定的情况，导致访问不了或者网速较慢。\u003c/p\u003e\n\u003cp\u003e某位作者是将作品上传到了自己的网站，或者除Ansible Galaxy官网以外的其他平台。\u003c/p\u003e\n\u003cp\u003e在这两种情况下，就不能再用“ansible-galaxy install角色名称”的命令直接加载了，而是需要手动先编写一个YAML语言格式的文件，指明网址链接和角色名称，然后再用-r参数进行加载。\u003c/p\u003e\n\u003cp\u003e例如，在（www.linuxprobe.com）上传了一个名为nginx_core的角色软件包（一个用于对nginx网站进行保护的插件）。这时需要编写如下所示的一个yml配置文件：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003evim nginx.yml\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-yaml\" data-lang=\"yaml\"\u003e\u003cspan class=\"nn\"\u003e---\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e- \u003cspan class=\"nt\"\u003esrc\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ehttps://www.linuxprobe.com/Software/nginxinc-nginx_core-0.3.0.tar.gz\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003enginx-core\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e随后使用ansible-galaxy命令的-r参数加载这个文件\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eansible-galaxy install -r nginx.yml\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e即可查看到新角色信息了：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eansible-galaxy list\n\n\u003cspan class=\"c1\"\u003e# /root/.ansible/roles\u003c/span\u003e\n- nginx-core, \u003cspan class=\"o\"\u003e(\u003c/span\u003eunknown version\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# /usr/share/ansible/roles\u003c/span\u003e\n- linux-system-roles.certificate, \u003cspan class=\"o\"\u003e(\u003c/span\u003eunknown version\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n- linux-system-roles.crypto_policies, \u003cspan class=\"o\"\u003e(\u003c/span\u003eunknown version\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n- linux-system-roles.ha_cluster, \u003cspan class=\"o\"\u003e(\u003c/span\u003eunknown version\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n- linux-system-roles.kdump, \u003cspan class=\"o\"\u003e(\u003c/span\u003eunknown version\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n- linux-system-roles.kernel_settings, \u003cspan class=\"o\"\u003e(\u003c/span\u003eunknown version\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n- linux-system-roles.logging, \u003cspan class=\"o\"\u003e(\u003c/span\u003eunknown version\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"创建自定义角色\"\u003e创建自定义角色\u003c/h3\u003e\n\u003cp\u003e除了能够使用系统自带的角色和从Ansible Galaxy中获取的角色之外，也可以自行创建符合工作需求的角色。这种定制化的编写工作能够更好地贴合生产环境的实际情况，但难度也会稍高一些。\u003c/p\u003e\n\u003cp\u003e接下来将会创建一个名为apache的新角色，它能够帮助我们自动安装、运行httpd网站服务，设置防火墙的允许规则，以及根据每个主机生成独立的index.html首页文件。用户在调用这个角色后能享受到“一条龙”的网站部署服务。\u003c/p\u003e\n\u003cp\u003e在Ansible的主配置文件中，第68行定义的是角色保存路径。如果用户新建的角色信息不在规定的目录内，则无法使用ansible-galaxy list命令找到。因此需要手动填写新角色的目录路径，或是进入/etc/ansible/roles目录内再进行创建。为了避免后期角色信息过于分散导致不好管理，我们还是决定在默认目录下进行创建，不再修改。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003evim /etc/ansible/ansible.cfg\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e \u003cspan class=\"m\"\u003e67\u003c/span\u003e \u003cspan class=\"c1\"\u003e# additional paths to search for roles in, colon separated\u003c/span\u003e\n \u003cspan class=\"m\"\u003e68\u003c/span\u003e \u003cspan class=\"c1\"\u003e# roles_path  = /etc/ansible/roles\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e在ansible-galaxy命令后面跟一个init参数，创建一个新的角色信息，且建立成功后便会在当前目录下生成出一个新的目录：\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003ecd /etc/ansible/roles/\n\u003c/code\u003e\u003c/pre\u003e\u003cpre\u003e\u003ccode\u003eansible-galaxy init apache\n- Role apache was created successfully\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e此时的apache即是角色名称，也是用于存在角色信息的目录名称。切换到该目录下，查看它的结构：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003els apache/\ndefaults files handlers meta README.md tasks templates tests vars\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e在创建新角色时，最关键的便是能够正确理解目录结构。通俗来说，就是要把正确的信息放入正确的目录中，这样在调用角色时才能有正确的效果。角色信息对应的目录结构及含义如表所示\u003c/p\u003e\n\u003cp\u003eAnsible角色目录结构及含义\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003e目录\u003c/th\u003e\n\u003cth\u003e含义\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003edefaults\u003c/td\u003e\n\u003ctd\u003e包含角色变量的默认值（优先级低）。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003efiles\u003c/td\u003e\n\u003ctd\u003e包含角色执行tasks任务时做引用的静态文件。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003ehandlers\u003c/td\u003e\n\u003ctd\u003e包含角色的处理程序定义。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003emeta\u003c/td\u003e\n\u003ctd\u003e包含角色的作者、许可证、频台和依赖关系等信息。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003etasks\u003c/td\u003e\n\u003ctd\u003e包含角色所执行的任务。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003etemplates\u003c/td\u003e\n\u003ctd\u003e包含角色任务所使用的Jinja2模板。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003etests\u003c/td\u003e\n\u003ctd\u003e包含用于测试角色的剧本文件。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003evars\u003c/td\u003e\n\u003ctd\u003e包含角色变量的默认值（优先级高）。\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp\u003e下面准备创建自定义角色。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e第1步\u003c/strong\u003e：打开用于定义角色任务的tasks/main.yml文件。在该文件中不需要定义要执行的主机组列表，因为后面会单独编写剧本进行调用，此时应先对apache角色能做的事情（任务）有一个\u003cstrong\u003e明确的思路\u003c/strong\u003e，在调用角色后yml文件会按照从上到下的顺序自动执行。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e任务1\u003c/strong\u003e：安装httpd网站服务。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e任务2\u003c/strong\u003e：运行httpd网站服务，并加入到开机启动项中。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e任务3\u003c/strong\u003e：配置防火墙，使其放行HTTP协议。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e任务4\u003c/strong\u003e：根据每台主机的变量值，生成不同的主页文件。\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e先写出第一个任务。使用yum模块安装httpd网站服务程序（注意格式）：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-yaml\" data-lang=\"yaml\"\u003e\u003cspan class=\"l\"\u003evim /etc/ansible/roles/apache/tasks/main.yml\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nn\"\u003e---\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"c\"\u003e# tasks file for apache\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003einstall\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003eyum\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e          \u003c/span\u003e\u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ehttpd\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e          \u003c/span\u003e\u003cspan class=\"nt\"\u003estate\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003elatest\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cstrong\u003e第2步\u003c/strong\u003e：使用service模块启动httpd网站服务程序，并加入到启动项中，保证能够一直为用户提供服务。在初次使用模块前，先用ansible-doc命令查看一下帮助和实例信息。对这里的信息进行了删减，仅保留了有用的内容。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-yaml\" data-lang=\"yaml\"\u003e\u003cspan class=\"l\"\u003eansible-doc service\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"l\"\u003e\u0026gt; SERVICE  (/usr/lib/python3.6/site-packages/ansible/modules/system/service.py)\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"l\"\u003eControls services on remote hosts. Supported init systems\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"l\"\u003einclude BSD init, OpenRC, SysV, Solaris SMF, systemd, upstart.\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"l\"\u003eFor Windows targets, use the [win_service] module instead.\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e*\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eThis module is maintained by The Ansible Core Team\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nt\"\u003e* note\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eThis module has a corresponding action plugin.\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e \n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003eXAMPLES\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eStart service httpd, if not started\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003eservice\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ehttpd\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003estate\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003estarted\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eStop service httpd, if started\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003eservice\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ehttpd\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003estate\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003estopped\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eRestart service httpd, in all cases\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003eservice\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ehttpd\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003estate\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003erestarted\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eReload service httpd, in all cases\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003eservice\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ehttpd\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003estate\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ereloaded\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eEnable service httpd, and not touch the state\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003eservice\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ehttpd\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003eenabled\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"kc\"\u003eyes\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e默认的EXAMPLES示例使用的就是httpd网站服务。通过输出信息可得知，启动服务为“state: started”参数，而加入到开机启动项则是“enabled: yes”参数。继续编写：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-yaml\" data-lang=\"yaml\"\u003e\u003cspan class=\"l\"\u003evim /etc/ansible/roles/apache/tasks/main.yml\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nn\"\u003e---\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"c\"\u003e# tasks file for apache\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003einstall\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003eyum\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e          \u003c/span\u003e\u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ehttpd\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e          \u003c/span\u003e\u003cspan class=\"nt\"\u003estate\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003elatest\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003estart\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003eservice\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e          \u003c/span\u003e\u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ehttpd\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e          \u003c/span\u003e\u003cspan class=\"nt\"\u003estate\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003estarted\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e          \u003c/span\u003e\u003cspan class=\"nt\"\u003eenabled\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"kc\"\u003eyes\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cstrong\u003e第3步\u003c/strong\u003e：配置防火墙的允许策略，让其他主机可以正常访问。在配置防火墙时，需要使用firewalld模块。同样也是先看一下帮助示例：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-yaml\" data-lang=\"yaml\"\u003e\u003cspan class=\"l\"\u003eansible-doc firewalld\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"l\"\u003e\u0026gt; FIREWALLD    (/usr/lib/python3.6/site-packages/ansible/modules/system/firewalld.py)\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e\u003cspan class=\"l\"\u003eThis module allows for addition or deletion of services and ports (either TCP or UDP) in either running or\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e\u003cspan class=\"l\"\u003epermanent firewalld rules.\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e*\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eThis module is maintained by The Ansible Community\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003eEXAMPLES\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e- \u003cspan class=\"nt\"\u003efirewalld\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003eservice\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ehttps\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003epermanent\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"kc\"\u003eyes\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003estate\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eenabled\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e- \u003cspan class=\"nt\"\u003efirewalld\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003eport\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"m\"\u003e8081\u003c/span\u003e\u003cspan class=\"l\"\u003e/tcp\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003epermanent\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"kc\"\u003eyes\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003estate\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003edisabled\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e- \u003cspan class=\"nt\"\u003efirewalld\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003eport\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"m\"\u003e161-162\u003c/span\u003e\u003cspan class=\"l\"\u003e/udp\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003epermanent\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"kc\"\u003eyes\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003estate\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eenabled\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e- \u003cspan class=\"nt\"\u003efirewalld\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003ezone\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003edmz\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003eservice\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ehttp\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003epermanent\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"kc\"\u003eyes\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003estate\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eenabled\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e    \n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e- \u003cspan class=\"nt\"\u003efirewalld\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003erich_rule\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003erule service name=\u0026#34;ftp\u0026#34; audit limit value=\u0026#34;1/m\u0026#34; accept\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003epermanent\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"kc\"\u003eyes\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003estate\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eenabled\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e依据输出信息可得知，在firewalld模块设置防火墙策略时，指定协议名称为“service: http”参数，放行该协议为“state: enabled”参数，设置为永久生效为“permanent: yes”参数，当前立即生效为“immediate: yes”参数。参数虽然多了一些，但是基本与在之前学习的一致，并不需要担心。继续编写：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-yaml\" data-lang=\"yaml\"\u003e\u003cspan class=\"l\"\u003evim /etc/ansible/roles/apache/tasks/main.yml\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nn\"\u003e---\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"c\"\u003e# tasks file for apache\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003einstall\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003eyum\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e          \u003c/span\u003e\u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ehttpd\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e          \u003c/span\u003e\u003cspan class=\"nt\"\u003estate\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003elatest\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003estart\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003eservice\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e          \u003c/span\u003e\u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ehttpd\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e          \u003c/span\u003e\u003cspan class=\"nt\"\u003estate\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003estarted\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e          \u003c/span\u003e\u003cspan class=\"nt\"\u003eenabled\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"kc\"\u003eyes\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003efirewall\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003efirewalld\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e          \u003c/span\u003e\u003cspan class=\"nt\"\u003eservice\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ehttp\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e          \u003c/span\u003e\u003cspan class=\"nt\"\u003epermanent\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"kc\"\u003eyes\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e          \u003c/span\u003e\u003cspan class=\"nt\"\u003estate\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eenabled\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e          \u003c/span\u003e\u003cspan class=\"nt\"\u003eimmediate\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"kc\"\u003eyes\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cstrong\u003e第4步\u003c/strong\u003e：让每台主机显示的主页文件均不相同。在使用Ansible的常规模块时，都是采用“查询版主示例并模仿”的方式搞定的，这里为了增加难度，我们再提出个新需求，即能否让每台主机上运行的httpd网站服务都能显示不同的内容呢？例如显示当前服务器的主机名及IP地址。这就要用到template模块及Jinja2技术了。\u003c/p\u003e\n\u003cp\u003e我们依然使用ansible-doc命令来查询template模块的使用方法。示例部分依然大有帮助：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-yaml\" data-lang=\"yaml\"\u003e\u003cspan class=\"l\"\u003eansible-doc template\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"l\"\u003e\u0026gt; TEMPLATE  (/usr/lib/python3.6/site-packages/ansible/modules/files/template.py)\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e     \u003c/span\u003e\u003cspan class=\"l\"\u003eTemplates are processed by the L(Jinja2 templating\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e     \u003c/span\u003e\u003cspan class=\"l\"\u003elanguage,http://jinja.pocoo.org/docs/). Documentation on the\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e     \u003c/span\u003e\u003cspan class=\"l\"\u003etemplate formatting can be found in the L(Template Designer\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e     \u003c/span\u003e\u003cspan class=\"l\"\u003eDocumentation,http://jinja.pocoo.org/docs/templates/).\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e     \u003c/span\u003e\u003cspan class=\"l\"\u003eAdditional variables listed below can be used in templates.\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e     \u003c/span\u003e\u003cspan class=\"l\"\u003e`ansible_managed\u0026#39; (configurable via the `defaults\u0026#39; section of\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e     \u003c/span\u003e\u003cspan class=\"l\"\u003e`ansible.cfg\u0026#39;) contains a string which can be used to describe\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e     \u003c/span\u003e\u003cspan class=\"l\"\u003ethe template name, host, modification time of the template\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e     \u003c/span\u003e\u003cspan class=\"l\"\u003efile and the owner uid. `template_host\u0026#39; contains the node name\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e     \u003c/span\u003e\u003cspan class=\"l\"\u003eof the template\u0026#39;s machine. `template_uid\u0026#39; is the numeric user\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e     \u003c/span\u003e\u003cspan class=\"l\"\u003eid of the owner. `template_path\u0026#39; is the path of the template.\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e     \u003c/span\u003e\u003cspan class=\"l\"\u003e`template_fullpath\u0026#39; is the absolute path of the template.\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e     \u003c/span\u003e\u003cspan class=\"l\"\u003e`template_destpath\u0026#39; is the path of the template on the remote\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e     \u003c/span\u003e\u003cspan class=\"l\"\u003esystem (added in 2.8). `template_run_date\u0026#39; is the date that\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e     \u003c/span\u003e\u003cspan class=\"l\"\u003ethe template was rendered.\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e     \n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e*\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eThis module is maintained by The Ansible Core Team\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003e* note\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eThis module has a corresponding action plugin.\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003eEXAMPLES\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eTemplate a file to /etc/files.conf\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003etemplate\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003esrc\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003e/mytemplates/foo.j2\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003edest\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003e/etc/file.conf\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003eowner\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ebin\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003egroup\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ewheel\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003emode\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;0644\u0026#39;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eTemplate a file, using symbolic modes (equivalent to 0644)\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003etemplate\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003esrc\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003e/mytemplates/foo.j2\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003edest\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003e/etc/file.conf\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003eowner\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ebin\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003egroup\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ewheel\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003emode\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eu=rw,g=r,o=r\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eCopy a version of named.conf that is dependent on the OS. setype obtained \u0026gt;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003etemplate\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003esrc\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003enamed.conf_{{ ansible_os_family }}.j2\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003edest\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003e/etc/named.conf\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003egroup\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003enamed\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003esetype\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003enamed_conf_t\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003emode\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"m\"\u003e0640\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e从template模块的输出信息中可得知，这是一个用于复制文件模板的模块，能够把文件从Ansible服务器复制到受管主机上。其中，src参数用于定义本地文件的路径，dest参数用于定义复制到受管主机的文件路径，而owner、group、mode参数可选择性地设置文件归属及权限信息。\u003c/p\u003e\n\u003cp\u003e正常来说，我们可以直接复制文件的操作，受管主机上会获取到一个与Ansible服务器上的文件一模一样的文件。但有时候，我们想让每台客户端根据自身系统的情况产生不同的文件信息，这就需要用到Jinja2技术了，Jinja2格式的模板文件后缀是.j2。继续编写：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-yaml\" data-lang=\"yaml\"\u003e\u003cspan class=\"l\"\u003evim /etc/ansible/roles/apache/tasks/main.yml\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nn\"\u003e---\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"c\"\u003e# tasks file for apache\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003einstall\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003eyum\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e          \u003c/span\u003e\u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ehttpd\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e          \u003c/span\u003e\u003cspan class=\"nt\"\u003estate\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003elatest\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003estart\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003eservice\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e          \u003c/span\u003e\u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ehttpd\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e          \u003c/span\u003e\u003cspan class=\"nt\"\u003estate\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003estarted\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e          \u003c/span\u003e\u003cspan class=\"nt\"\u003eenabled\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"kc\"\u003eyes\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003efirewall\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003efirewalld\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e          \u003c/span\u003e\u003cspan class=\"nt\"\u003eservice\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ehttp\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e          \u003c/span\u003e\u003cspan class=\"nt\"\u003epermanent\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"kc\"\u003eyes\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e          \u003c/span\u003e\u003cspan class=\"nt\"\u003estate\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eenabled\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e          \u003c/span\u003e\u003cspan class=\"nt\"\u003eimmediate\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"kc\"\u003eyes\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eindex\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003etemplate\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e          \u003c/span\u003e\u003cspan class=\"nt\"\u003esrc\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eindex.html.j2\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e          \u003c/span\u003e\u003cspan class=\"nt\"\u003edest\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003e/var/www/html/index.html\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eJinja2是Python语言中一个被广泛使用的模板引擎，最初的设计思想源自Django的模块引擎。Jinja2基于此发展了其语法和一系列强大的功能，能够让受管主机根据自身变量产生出不同的文件内容。换句话说，正常情况下的复制操作会让新旧文件一模一样，但在使用Jinja2技术时，不是在原始文件中直接写入文件内容，而是写入一系列的变量名称。在使用template模块进行复制的过程中，由Ansible服务负责在受管主机上收集这些变量名称所对应的值，然后再逐一填写到目标文件中，从而让每台主机的文件都根据自身系统的情况独立生成。\u003c/p\u003e\n\u003cp\u003e例如，想要让每个网站的输出信息值为“Welcome to 主机名 on 主机地址”，也就是用每个主机自己独有的名称和IP地址来替换文本中的内容，这样就有趣太多了。这个实验的难点在于查询到对应的变量名称、主机名及地址所对应的值保存在哪里？可以用setup模块进行查询。\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eansible-doc setup\n\n\u0026gt; SETUP  (/usr/lib/python3.6/site-packages/ansible/modules/system/setup.py)\n\n     This module is automatically called by playbooks to gather\n     useful variables about remote hosts that can be used in\n     playbooks. It can also be executed directly by\n     `/usr/bin/ansible' to check what variables are available to a\n     host. Ansible provides many `facts' about the system,\n     automatically. This module is also supported for Windows\n     targets.\n\n * This module is maintained by The Ansible Core Team\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003esetup模块的作用是自动收集受管主机上的\u003cstrong\u003e变量\u003c/strong\u003e信息，使用-a参数外加filter命令可以对收集来的信息进行二次过滤。相应的语法格式为ansible all -m setup -a 'filter=\u0026quot;\u003cem\u003e关键词\u003c/em\u003e\u0026quot;'，其中*号是Shell中的通配符，用于进行关键词查询。例如，如果想搜索各个主机的名称，可以使用通配符搜索所有包含fqdn关键词的变量值信息。\u003c/p\u003e\n\u003cp\u003e**FQDN（Fully Qualified Domain Name，完全限定域名）**用于在逻辑上准确表示出主机的位置。FQDN常常被作为主机名的完全表达形式，比 /etc/hostname 文件中定义的主机名更加严谨和准确。通过输出信息可得知，ansible_fqdn变量保存有主机名称。随后进行下一步操作：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003eroot@play1 ~\u003cspan class=\"o\"\u003e]\u003c/span\u003e\u003cspan class=\"c1\"\u003e# ansible all -m setup -a \u0026#39;filter=\u0026#34;*fqdn\u0026#34;\u0026#39;\u003c/span\u003e\n\n192.168.88.139 \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nv\"\u003eSUCCESS\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e\u0026gt; \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"s2\"\u003e\u0026#34;ansible_facts\u0026#34;\u003c/span\u003e: \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n     \u003cspan class=\"s2\"\u003e\u0026#34;ansible_fqdn\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;play3\u0026#34;\u003c/span\u003e,\n     \u003cspan class=\"s2\"\u003e\u0026#34;discovered_interpreter_python\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;/usr/libexec/platform-python\u0026#34;\u003c/span\u003e\n  \u003cspan class=\"o\"\u003e}\u003c/span\u003e,\n  \u003cspan class=\"s2\"\u003e\u0026#34;changed\u0026#34;\u003c/span\u003e: \u003cspan class=\"nb\"\u003efalse\u003c/span\u003e\n\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n192.168.88.130 \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nv\"\u003eSUCCESS\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e\u0026gt; \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"s2\"\u003e\u0026#34;ansible_facts\u0026#34;\u003c/span\u003e: \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n     \u003cspan class=\"s2\"\u003e\u0026#34;ansible_fqdn\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;play2\u0026#34;\u003c/span\u003e,\n     \u003cspan class=\"s2\"\u003e\u0026#34;discovered_interpreter_python\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;/usr/libexec/platform-python\u0026#34;\u003c/span\u003e\n  \u003cspan class=\"o\"\u003e}\u003c/span\u003e,\n  \u003cspan class=\"s2\"\u003e\u0026#34;changed\u0026#34;\u003c/span\u003e: \u003cspan class=\"nb\"\u003efalse\u003c/span\u003e\n\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e用于指定主机地址的变量可以用ip作为关键词进行检索。可以看到，ansible_all_ipv4_addresses变量中的值是我们想要的信息。如果想输出IPv6形式的地址，则可用ansible_all_ipv6_addresses变量。\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e[root@play1 ~]# ansible all -m setup -a 'filter=\u0026quot;*ip*\u0026quot;'\n\n192.168.88.139 | SUCCESS =\u0026gt; {\n\n  \u0026quot;ansible_facts\u0026quot;: {\n\n     \u0026quot;ansible_all_ipv4_addresses\u0026quot;: [\n       \u0026quot;192.168.88.139\u0026quot;\n     ],\n     \u0026quot;ansible_all_ipv6_addresses\u0026quot;: [],\n     \u0026quot;ansible_default_ipv4\u0026quot;: {\n       \u0026quot;address\u0026quot;: \u0026quot;192.168.88.139\u0026quot;,\n       \u0026quot;alias\u0026quot;: \u0026quot;ens33\u0026quot;,\n       \u0026quot;broadcast\u0026quot;: \u0026quot;192.168.88.255\u0026quot;,\n       \u0026quot;gateway\u0026quot;: \u0026quot;192.168.88.2\u0026quot;,\n       \u0026quot;interface\u0026quot;: \u0026quot;ens33\u0026quot;,\n       \u0026quot;macaddress\u0026quot;: \u0026quot;00:0c:29:84:d1:6f\u0026quot;,\n       \u0026quot;mtu\u0026quot;: 1500,\n       \u0026quot;netmask\u0026quot;: \u0026quot;255.255.255.0\u0026quot;,\n       \u0026quot;network\u0026quot;: \u0026quot;192.168.88.0\u0026quot;,\n       \u0026quot;type\u0026quot;: \u0026quot;ether\u0026quot;\n     },\n     \u0026quot;ansible_default_ipv6\u0026quot;: {},\n     \u0026quot;ansible_fips\u0026quot;: false,\n     \u0026quot;discovered_interpreter_python\u0026quot;: \u0026quot;/usr/libexec/platform-python\u0026quot;\n  },\n  \u0026quot;changed\u0026quot;: false\n}\n\n192.168.88.130 | SUCCESS =\u0026gt; {\n  \u0026quot;ansible_facts\u0026quot;: {\n     \u0026quot;ansible_all_ipv4_addresses\u0026quot;: [\n       \u0026quot;192.168.88.130\u0026quot;,\n       \u0026quot;192.168.122.1\u0026quot;\n     ],\n     \u0026quot;ansible_all_ipv6_addresses\u0026quot;: [\n       \u0026quot;fe80::20c:29ff:fe7c:18d7\u0026quot;\n     ],\n     \u0026quot;ansible_default_ipv4\u0026quot;: {\n       \u0026quot;address\u0026quot;: \u0026quot;192.168.88.130\u0026quot;,\n       \u0026quot;alias\u0026quot;: \u0026quot;ens33\u0026quot;,\n       \u0026quot;broadcast\u0026quot;: \u0026quot;192.168.88.255\u0026quot;,\n       \u0026quot;gateway\u0026quot;: \u0026quot;192.168.88.2\u0026quot;,\n       \u0026quot;interface\u0026quot;: \u0026quot;ens33\u0026quot;,\n       \u0026quot;macaddress\u0026quot;: \u0026quot;00:0c:29:7c:18:d7\u0026quot;,\n       \u0026quot;mtu\u0026quot;: 1500,\n       \u0026quot;netmask\u0026quot;: \u0026quot;255.255.255.0\u0026quot;,\n       \u0026quot;network\u0026quot;: \u0026quot;192.168.88.0\u0026quot;,\n       \u0026quot;type\u0026quot;: \u0026quot;ether\u0026quot;\n     },\n     \u0026quot;ansible_default_ipv6\u0026quot;: {},\n     \u0026quot;ansible_fips\u0026quot;: false,\n     \u0026quot;discovered_interpreter_python\u0026quot;: \u0026quot;/usr/libexec/platform-python\u0026quot;\n  },\n  \u0026quot;changed\u0026quot;: false\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e在确认了主机名与IP地址所对应的具体变量名称后，在角色所对应的templates目录内新建一个与上面的template模块参数相同的文件名称（index.html.j2）。Jinja2在调用变量值时，格式为在变量名称的两侧格加两个大括号：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"nb\"\u003ecd\u003c/span\u003e /etc/ansible/roles/apache/\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003evim templates/index.html.j2 \nWelcome to \u003cspan class=\"o\"\u003e{{\u003c/span\u003e ansible_fqdn \u003cspan class=\"o\"\u003e}}\u003c/span\u003e on \u003cspan class=\"o\"\u003e{{\u003c/span\u003e ansible_all_ipv4_addresses \u003cspan class=\"o\"\u003e}}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e进行到这里，任务基本就算完成了。最后要做的就是编写一个用于调用apache角色的yml文件，以及执行这个文件。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"nb\"\u003ecd\u003c/span\u003e ~/\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003evim roles.yml\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-yaml\" data-lang=\"yaml\"\u003e\u003cspan class=\"nn\"\u003e---\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003e调用自建角色\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003ehosts\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eall\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003eroles\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e          \u003c/span\u003e- \u003cspan class=\"l\"\u003eapache \u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003eroot@play1 ~\u003cspan class=\"o\"\u003e]\u003c/span\u003e\u003cspan class=\"c1\"\u003e# ansible-playbook roles.yml \u003c/span\u003e\n\nPLAY \u003cspan class=\"o\"\u003e[\u003c/span\u003e调用自建角色\u003cspan class=\"o\"\u003e]\u003c/span\u003e ****************************************************************************************************************************************\n\nTASK \u003cspan class=\"o\"\u003e[\u003c/span\u003eGathering Facts\u003cspan class=\"o\"\u003e]\u003c/span\u003e *******************************************************************************************************************************\nok: \u003cspan class=\"o\"\u003e[\u003c/span\u003e192.168.88.139\u003cspan class=\"o\"\u003e]\u003c/span\u003e\nok: \u003cspan class=\"o\"\u003e[\u003c/span\u003e192.168.88.130\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\nTASK \u003cspan class=\"o\"\u003e[\u003c/span\u003eapache : install\u003cspan class=\"o\"\u003e]\u003c/span\u003e ******************************************************************************************************************************\nok: \u003cspan class=\"o\"\u003e[\u003c/span\u003e192.168.88.139\u003cspan class=\"o\"\u003e]\u003c/span\u003e\nok: \u003cspan class=\"o\"\u003e[\u003c/span\u003e192.168.88.130\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\nTASK \u003cspan class=\"o\"\u003e[\u003c/span\u003eapache : start\u003cspan class=\"o\"\u003e]\u003c/span\u003e ********************************************************************************************************************************\nok: \u003cspan class=\"o\"\u003e[\u003c/span\u003e192.168.88.139\u003cspan class=\"o\"\u003e]\u003c/span\u003e\nok: \u003cspan class=\"o\"\u003e[\u003c/span\u003e192.168.88.130\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\nTASK \u003cspan class=\"o\"\u003e[\u003c/span\u003eapache : firewall\u003cspan class=\"o\"\u003e]\u003c/span\u003e *****************************************************************************************************************************\nok: \u003cspan class=\"o\"\u003e[\u003c/span\u003e192.168.88.139\u003cspan class=\"o\"\u003e]\u003c/span\u003e\nok: \u003cspan class=\"o\"\u003e[\u003c/span\u003e192.168.88.130\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\nTASK \u003cspan class=\"o\"\u003e[\u003c/span\u003eapache : index\u003cspan class=\"o\"\u003e]\u003c/span\u003e ********************************************************************************************************************************\nchanged: \u003cspan class=\"o\"\u003e[\u003c/span\u003e192.168.88.139\u003cspan class=\"o\"\u003e]\u003c/span\u003e\nchanged: \u003cspan class=\"o\"\u003e[\u003c/span\u003e192.168.88.130\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\n \nPLAY RECAP *******************************************************************************************************************************************\n192.168.88.130       : \u003cspan class=\"nv\"\u003eok\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e5\u003c/span\u003e  \u003cspan class=\"nv\"\u003echanged\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e  \u003cspan class=\"nv\"\u003eunreachable\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e  \u003cspan class=\"nv\"\u003efailed\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e  \u003cspan class=\"nv\"\u003eskipped\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e  \u003cspan class=\"nv\"\u003erescued\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e  \u003cspan class=\"nv\"\u003eignored\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e  \n192.168.88.139       : \u003cspan class=\"nv\"\u003eok\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e5\u003c/span\u003e  \u003cspan class=\"nv\"\u003echanged\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e  \u003cspan class=\"nv\"\u003eunreachable\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e  \u003cspan class=\"nv\"\u003efailed\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e  \u003cspan class=\"nv\"\u003eskipped\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e  \u003cspan class=\"nv\"\u003erescued\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e  \u003cspan class=\"nv\"\u003eignored\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e  \n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e执行完毕后，在浏览器中随机输入几台主机的IP地址，即可访问到包含主机FQDN和IP地址的网页了\u003c/p\u003e\n\u003ch2 id=\"创建和使用逻辑卷\"\u003e创建和使用逻辑卷\u003c/h2\u003e\n\u003cp\u003e创建一个能批量、自动管理逻辑卷设备的剧本，不但能大大提高硬盘设备的管理效率，而且还能避免手动创建带来的错误。例如，我们想在每台受管主机上都创建出一个名为data的逻辑卷设备，大小为150MB，归属于new卷组。如果创建成功，则进一步用Ext4文件系统进行格式化操作；如果创建失败，则给用户输出一条报错提醒，以便排查原因。\u003c/p\u003e\n\u003cp\u003e在这种情况下，使用Ansible剧本要比使用Shell脚本的优势大，原因主要有下面两点。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eAnsible模块化的功能让操作更标准，只要在执行过程中无报错，那么便会依据远程主机的系统版本及配置自动做出判断和操作，不用担心因系统变化而导致命令失效的问题。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eAnsible服务在执行剧本文件时会进行判断：如果该文件或该设备已经被创建过，或是某个动作（play）已经被执行过，则绝对不会再重复执行；而使用Shell脚本有可能导致设备被重复格式化，导致数据丢失。\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e通过之前学习过的逻辑卷的知识，我们应该让剧本文件依次创建物理卷（PV）、卷组（VG）及逻辑卷（LV）。需要先使用lvg模块让设备支持逻辑卷技术，然后创建一个名为new的卷组。lvg模块的帮助信息如下：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-yaml\" data-lang=\"yaml\"\u003e\u003cspan class=\"l\"\u003eansible-doc lvg\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"l\"\u003e\u0026gt; LVG  (/usr/lib/python3.6/site-packages/ansible/modules/system/lvg.py)\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e*\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eThis module creates, removes or resizes volume groups.\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e*\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eThis module is maintained by The Ansible Community\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003eEXAMPLES\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eCreate a volume group on top of /dev/sda1 with physical extent size = 32MB\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003elvg\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003evg\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003evg.services\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003epvs\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003e/dev/sda1\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003epesize\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"m\"\u003e32\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eCreate a volume group on top of /dev/sdb with physical extent size = 128KiB\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003elvg\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003evg\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003evg.services\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003epvs\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003e/dev/sdb\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003epesize\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003e128K\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"c\"\u003e# If, for example, we already have VG vg.services on top of /dev/sdb1,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"c\"\u003e# this VG will be extended by /dev/sdc5. Or if vg.services was created on\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"c\"\u003e# top of /dev/sda5, we first extend it with /dev/sdb1 and /dev/sdc5,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"c\"\u003e# and then reduce by /dev/sda5.\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eCreate or resize a volume group on top of /dev/sdb1 and /dev/sdc5.\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003elvg\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003evg\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003evg.services\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003epvs\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003e/dev/sdb1,/dev/sdc5\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eRemove a volume group with name vg.services\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003elvg\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003evg\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003evg.services\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003estate\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eabsent\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e通过输出信息可得知，创建PV和VG的lvg模块总共有3个必备参数。其中，vg参数用于定义卷组的名称，pvs参数用于指定硬盘设备的名称，pesize参数用于确定最终卷组的容量大小（可以用PE个数或容量值进行指定）。这样一来，我们先创建出一个由/dev/sdb设备组成的名称为research、大小为150MB的卷组设备。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-yaml\" data-lang=\"yaml\"\u003e\u003cspan class=\"l\"\u003evim lv.yml\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nn\"\u003e---\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003e创建和使用逻辑卷\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003ehosts\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003edev\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003etasks\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ecreate pv vg\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e          \u003c/span\u003e\u003cspan class=\"nt\"\u003elvg\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e          \u003c/span\u003e\u003cspan class=\"nt\"\u003evg\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003enew\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e          \u003c/span\u003e\u003cspan class=\"nt\"\u003epvs\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003e/dev/sdb\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e          \u003c/span\u003e\u003cspan class=\"nt\"\u003epesize\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003e150M\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e接下来使用lvol模块创建出逻辑卷设备。还是按照惯例，先查看模块的帮助信息：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-yaml\" data-lang=\"yaml\"\u003e\u003cspan class=\"l\"\u003eansible-doc lvol\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"l\"\u003e\u0026gt; LVOL  (/usr/lib/python3.6/site-packages/ansible/modules/system/lvol.py)\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e*\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eThis module creates, removes or resizes logical volumes.\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e*\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eThis module is maintained by The Ansible Community\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e \n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003eEXAMPLES\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eCreate a logical volume of 512m\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003elvol\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003evg\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003efirefly\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003elv\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003etest\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003esize\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"m\"\u003e512\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eCreate a logical volume of 512m with disks /dev/sda and /dev/sdb\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003elvol\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003evg\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003efirefly\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003elv\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003etest\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003esize\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"m\"\u003e512\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003epvs\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003e/dev/sda,/dev/sdb\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eCreate cache pool logical volume\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003elvol\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003evg\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003efirefly\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003elv\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003elvcache\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003esize\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003e512m\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003eopts\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e--\u003cspan class=\"l\"\u003etype cache-pool\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eCreate a logical volume of 512g.\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003elvol\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003evg\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003efirefly\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003elv\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003etest\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003esize\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003e512g\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e通过输出信息可得知，lvol是用于创建逻辑卷设备的模块。其中，vg参数用于指定卷组名称，lv参数用于指定逻辑卷名称，size参数则用于指定最终逻辑卷设备的容量大小（不用加单位，默认为MB）。填写好参数，创建出一个大小为150MB、归属于new卷组且名称为data的逻辑卷设备\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-yaml\" data-lang=\"yaml\"\u003e\u003cspan class=\"l\"\u003evim lv.yml\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nn\"\u003e---\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003e创建和使用逻辑卷\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003ehosts\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003edev\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003etasks\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e         \u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ecreate pv vg\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e           \u003c/span\u003e\u003cspan class=\"nt\"\u003elvg\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e           \u003c/span\u003e\u003cspan class=\"nt\"\u003evg\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003enew\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e           \u003c/span\u003e\u003cspan class=\"nt\"\u003epvs\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003e/dev/sdb\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e           \u003c/span\u003e\u003cspan class=\"nt\"\u003epesize\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003e150M\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e           \n\u003c/span\u003e\u003cspan class=\"w\"\u003e         \u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ecreate lv\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e           \u003c/span\u003e\u003cspan class=\"nt\"\u003elvol\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e           \u003c/span\u003e\u003cspan class=\"nt\"\u003evg\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003enew\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e           \u003c/span\u003e\u003cspan class=\"nt\"\u003elv\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003edata\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e           \u003c/span\u003e\u003cspan class=\"nt\"\u003esize\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003e150M\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e这样还不够，如果还能将创建出的/dev/new/data逻辑卷设备自动用Ext4文件系统进行格式化操作，则又能帮助运维管理员减少一些工作量。可使用filesystem模块来完成设备的文件系统格式化操作。该模块的帮助信息如下：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-yaml\" data-lang=\"yaml\"\u003e\u003cspan class=\"l\"\u003eansible-doc filesystem\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"l\"\u003e\u0026gt; FILESYSTEM  (/usr/lib/python3.6/site-packages/ansible/modules/system/filesyste\u0026gt;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e*\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eThis module creates a filesystem.\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e*\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eThis module is maintained by The Ansible Community\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003eEXAMPLES\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eCreate a ext2 filesystem on /dev/sdb1\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003efilesystem\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003efstype\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eext2\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003edev\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003e/dev/sdb1\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eCreate a ext4 filesystem on /dev/sdb1 and check disk blocks\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003efilesystem\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003efstype\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eext4\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003edev\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003e/dev/sdb1\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003eopts\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e-\u003cspan class=\"l\"\u003ecc\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003efilesystem模块的参数真是简练，fstype参数用于指定文件系统的格式化类型，dev参数用于指定要格式化的设备文件路径。继续编写\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-yaml\" data-lang=\"yaml\"\u003e\u003cspan class=\"l\"\u003evim lv.yml\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nn\"\u003e---\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003e创建和使用逻辑卷\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003ehosts\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003edev\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003etasks\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e         \u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ecreate pv vg\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e           \u003c/span\u003e\u003cspan class=\"nt\"\u003elvg\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e           \u003c/span\u003e\u003cspan class=\"nt\"\u003evg\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003enew\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e           \u003c/span\u003e\u003cspan class=\"nt\"\u003epvs\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003e/dev/sdb\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e           \u003c/span\u003e\u003cspan class=\"nt\"\u003epesize\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003e150M\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e           \n\u003c/span\u003e\u003cspan class=\"w\"\u003e         \u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ecreate lv\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e           \u003c/span\u003e\u003cspan class=\"nt\"\u003elvol\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e           \u003c/span\u003e\u003cspan class=\"nt\"\u003evg\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003enew\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e           \u003c/span\u003e\u003cspan class=\"nt\"\u003elv\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003edata\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e           \u003c/span\u003e\u003cspan class=\"nt\"\u003esize\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003e150M \u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e           \n\u003c/span\u003e\u003cspan class=\"w\"\u003e         \u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eformat lv\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e           \u003c/span\u003e\u003cspan class=\"nt\"\u003efilesystem\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e           \u003c/span\u003e\u003cspan class=\"nt\"\u003efstype\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003exfs\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e           \u003c/span\u003e\u003cspan class=\"nt\"\u003edev\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003e/dev/new/data\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e这样按照顺序执行下来，逻辑卷设备就能够自动创建好了。等一下，还有个问题没有解决。现在只有dev组的主机上添加了新的硬盘设备文件，其余主机是无法按照既定模块顺利完成操作的。这时就要使用类似于Shell的if条件语句的方式进行判断—如果失败……，则……。\u003c/p\u003e\n\u003cp\u003e首先用block操作符将上述的3个模块命令作为一个整体（相当于对这3个模块的执行结果作为一个整体进行判断），然后使用rescue操作符进行救援，且只有block块中的模块执行失败后才会调用rescue中的救援模块。其中，debug模块的msg参数的作用是，如果block中的模块执行失败，则输出一条信息到屏幕，用于提醒用户。完成编写后的剧本是下面这个样子：\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e(注意缩进)\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-yaml\" data-lang=\"yaml\"\u003e\u003cspan class=\"l\"\u003evim lv.yml\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nn\"\u003e---\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003e创建和使用逻辑卷\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003ehosts\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eall\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003etasks\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e          \u003c/span\u003e- \u003cspan class=\"nt\"\u003eblock\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e                  \u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ecreate pv vg\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e                    \u003c/span\u003e\u003cspan class=\"nt\"\u003elvg\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e                            \u003c/span\u003e\u003cspan class=\"nt\"\u003evg\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003enew\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e                            \u003c/span\u003e\u003cspan class=\"nt\"\u003epvs\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003e/dev/sdb\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e                            \u003c/span\u003e\u003cspan class=\"nt\"\u003epesize\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003e150M\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e                  \u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ecreate lv\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e                    \u003c/span\u003e\u003cspan class=\"nt\"\u003elvol\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e                            \u003c/span\u003e\u003cspan class=\"nt\"\u003evg\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003enew\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e                            \u003c/span\u003e\u003cspan class=\"nt\"\u003elv\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003edata\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e                            \u003c/span\u003e\u003cspan class=\"nt\"\u003esize\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003e150M\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e                  \u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eformat lv\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e                    \u003c/span\u003e\u003cspan class=\"nt\"\u003efilesystem\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e                            \u003c/span\u003e\u003cspan class=\"nt\"\u003efstype\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003exfs\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e                            \u003c/span\u003e\u003cspan class=\"nt\"\u003edev\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003e/dev/new/data\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e            \u003c/span\u003e\u003cspan class=\"nt\"\u003erescue\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e                    \u003c/span\u003e- \u003cspan class=\"nt\"\u003edebug\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e                            \u003c/span\u003e\u003cspan class=\"nt\"\u003emsg\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;Could not create logical volume of that size(无法创建那样大小的逻辑卷)\u0026#34;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eYAML语言对格式有着硬性的要求，既然rescue是对block内的模块进行救援的功能代码，因此recue和block两个操作符必须严格对齐，错开一个空格都会导致剧本执行失败。确认无误后，执行lv.yml剧本文件检阅一下效果：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003eroot@play1 ~\u003cspan class=\"o\"\u003e]\u003c/span\u003e\u003cspan class=\"c1\"\u003e# ansible-playbook lv.yml \u003c/span\u003e\n\nPLAY \u003cspan class=\"o\"\u003e[\u003c/span\u003e创建和使用逻辑卷\u003cspan class=\"o\"\u003e]\u003c/span\u003e ***********************************************************************************************************************************************************\n\nTASK \u003cspan class=\"o\"\u003e[\u003c/span\u003eGathering Facts\u003cspan class=\"o\"\u003e]\u003c/span\u003e ****************************************************************************************************************************************************\nok: \u003cspan class=\"o\"\u003e[\u003c/span\u003e192.168.88.139\u003cspan class=\"o\"\u003e]\u003c/span\u003e\nok: \u003cspan class=\"o\"\u003e[\u003c/span\u003e192.168.88.130\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\nTASK \u003cspan class=\"o\"\u003e[\u003c/span\u003ecreate pv vg\u003cspan class=\"o\"\u003e]\u003c/span\u003e *******************************************************************************************************************************************************\nchanged: \u003cspan class=\"o\"\u003e[\u003c/span\u003e192.168.88.130\u003cspan class=\"o\"\u003e]\u003c/span\u003e\nchanged: \u003cspan class=\"o\"\u003e[\u003c/span\u003e192.168.88.139\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\nTASK \u003cspan class=\"o\"\u003e[\u003c/span\u003ecreate lv\u003cspan class=\"o\"\u003e]\u003c/span\u003e **********************************************************************************************************************************************************\nchanged: \u003cspan class=\"o\"\u003e[\u003c/span\u003e192.168.88.139\u003cspan class=\"o\"\u003e]\u003c/span\u003e\nchanged: \u003cspan class=\"o\"\u003e[\u003c/span\u003e192.168.88.130\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\nTASK \u003cspan class=\"o\"\u003e[\u003c/span\u003eformat lv\u003cspan class=\"o\"\u003e]\u003c/span\u003e **********************************************************************************************************************************************************\nchanged: \u003cspan class=\"o\"\u003e[\u003c/span\u003e192.168.88.139\u003cspan class=\"o\"\u003e]\u003c/span\u003e\nchanged: \u003cspan class=\"o\"\u003e[\u003c/span\u003e192.168.88.130\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\nPLAY RECAP ****************************************************************************************************************************************************************\n192.168.88.130       : \u003cspan class=\"nv\"\u003eok\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e4\u003c/span\u003e  \u003cspan class=\"nv\"\u003echanged\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e3\u003c/span\u003e  \u003cspan class=\"nv\"\u003eunreachable\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e  \u003cspan class=\"nv\"\u003efailed\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e  \u003cspan class=\"nv\"\u003eskipped\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e  \u003cspan class=\"nv\"\u003erescued\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e  \u003cspan class=\"nv\"\u003eignored\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e \n192.168.88.139       : \u003cspan class=\"nv\"\u003eok\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e4\u003c/span\u003e  \u003cspan class=\"nv\"\u003echanged\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e3\u003c/span\u003e  \u003cspan class=\"nv\"\u003eunreachable\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e  \u003cspan class=\"nv\"\u003efailed\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e  \u003cspan class=\"nv\"\u003eskipped\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e  \u003cspan class=\"nv\"\u003erescued\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e  \u003cspan class=\"nv\"\u003eignored\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e \n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e在剧本运行完毕后的执行记录（PLAY RECAP）中可以很清晰地看到只有192.168.10.22及192.168.10.23这两台dev组中的主机执行成功了，其余主机均触发了rescue功能。登录到任意一台dev组的主机上，找到新建的逻辑卷设备信息：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003eroot@localhost ~\u003cspan class=\"o\"\u003e]\u003c/span\u003e\u003cspan class=\"c1\"\u003e# lvdisplay \u003c/span\u003e\n --- Logical volume ---\n LV Path        /dev/new/data\n LV Name        data\n VG Name        new\n LV UUID        oHVRhH-K017-riVa-VRvp-DEuY-FY8t-jNIng4\n LV Write Access    read/write\n LV Creation host, \u003cspan class=\"nb\"\u003etime\u003c/span\u003e localhost.localdomain, 2021-10-29 00:34:22 +0800\n LV Status       available\n \u003cspan class=\"c1\"\u003e# open         0\u003c/span\u003e\n LV Size        150.00 MiB\n Current LE       \u003cspan class=\"m\"\u003e1\u003c/span\u003e\n Segments        \u003cspan class=\"m\"\u003e1\u003c/span\u003e\n Allocation       inherit\n Read ahead sectors   auto\n \u003cspan class=\"se\"\u003e\\-\u003c/span\u003e currently \u003cspan class=\"nb\"\u003eset\u003c/span\u003e to   \u003cspan class=\"m\"\u003e8192\u003c/span\u003e\n Block device      253:2\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"判断主机组名\"\u003e判断主机组名\u003c/h2\u003e\n\u003cp\u003e在上面的剧本实验中，我们可以让不同的主机根据自身不同的变量信息而生成出独特的网站主页文件，但却无法对某个主机组进行针对性的操作。其实，在每个客户端中都会有一个名为inventory_hostname的变量，用于定义每台主机所对应的Ansible服务的主机组名称，也就是/etc/ansible/hosts文件中所对应的分组信息，例如dev、test、prod、balancers。\u003c/p\u003e\n\u003cp\u003einventory_hostname是Ansible服务中的魔法变量，这意味着无法使用setup模块直接进行查询，诸如ansible all -m setup -a 'filter=\u0026quot;\u003cem\u003e关键词\u003c/em\u003e\u0026quot;'这样的命令将对它失效。魔法变量需要在执行剧本文件时的Gathering Facts阶段进行搜集，直接查询是看不到的，只能在剧本文件中进行调用。\u003c/p\u003e\n\u003cp\u003e在获得了存储主机组名称的变量名称后，接下来开始实战。这里的需求如下：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e若主机在dev分组中，则修改/etc/issue文件内容为Development；\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e若主机在test分组中，则修改/etc/issue文件内容为Test；\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e根据之前所提及的Ansible常用模块名称及作用，可以看到\u003cstrong\u003ecopy模块的主要作用是新建、修改及复制文件\u003c/strong\u003e，更符合当前的需要，此时便派上了用场。先查询copy模块的帮助信息：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-yaml\" data-lang=\"yaml\"\u003e\u003cspan class=\"l\"\u003eansible-doc copy\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"l\"\u003e\u0026gt; COPY  (/usr/lib/python3.6/site-packages/ansible/modules/files/copy.py)\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"l\"\u003e​    The `copy\u0026#39; module copies a file from the local or remote\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"l\"\u003e​    machine to a location on the remote machine. Use the [fetch]\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"l\"\u003e​    module to copy files from remote locations to the local box.\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"l\"\u003e​    If you need variable interpolation in copied files, use the\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"l\"\u003e​    [template] module. Using a variable in the `content\u0026#39; field\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"l\"\u003e​    will result in unpredictable output. For Windows targets, use\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"l\"\u003e​    the [win_copy] module instead.\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e*\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eThis module is maintained by The Ansible Core Team\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nt\"\u003e* note\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eThis module has a corresponding action plugin.\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003eEXAMPLES\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eCopy file with owner and permissions\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003ecopy\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003esrc\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003e/srv/myfiles/foo.conf\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003edest\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003e/etc/foo.conf\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003eowner\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003efoo\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003egroup\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003efoo\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003emode\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;0644\u0026#39;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eCopy file with owner and permission, using symbolic representation\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003ecopy\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003esrc\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003e/srv/myfiles/foo.conf\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003edest\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003e/etc/foo.conf\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003eowner\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003efoo\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003egroup\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003efoo\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003emode\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eu=rw,g=r,o=r\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eAnother symbolic mode example, adding some permissions and removing others\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003ecopy\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003esrc\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003e/srv/myfiles/foo.conf\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003edest\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003e/etc/foo.conf\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003eowner\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003efoo\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003egroup\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003efoo\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003emode\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eu+rw,g-wx,o-rwx\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eCopy a new \u0026#34;ntp.conf file into place, backing up the original if it differ\u0026gt;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003ecopy\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003esrc\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003e/mine/ntp.conf\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003edest\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003e/etc/ntp.conf\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003eowner\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eroot\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003egroup\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eroot\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003emode\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;0644\u0026#39;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003ebackup\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"kc\"\u003eyes\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e在输出信息中列举了两种管理文件内容的示例。第一种用于文件的复制行为，第二种是通过content参数定义内容，通过dest参数指定新建文件的名称。显然，第二种更加符合当前的实验场景。编写剧本文件如下：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003evim issue.yml\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-yaml\" data-lang=\"yaml\"\u003e\u003cspan class=\"nn\"\u003e---\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003e修改文件内容\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003ehosts\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eall\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003etasks\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e          \u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003e定义内容dev\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e            \u003c/span\u003e\u003cspan class=\"nt\"\u003ecopy\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e                    \u003c/span\u003e\u003cspan class=\"nt\"\u003econtent\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;Development\u0026#39;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e                    \u003c/span\u003e\u003cspan class=\"nt\"\u003edest\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003e/etc/issue\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e          \u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003e定义内容web\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e            \u003c/span\u003e\u003cspan class=\"nt\"\u003ecopy\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e                    \u003c/span\u003e\u003cspan class=\"nt\"\u003econtent\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;Web\u0026#39;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e                    \u003c/span\u003e\u003cspan class=\"nt\"\u003edest\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003e/etc/issue\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e但是，如果按照这种顺序执行下去，每一台主机的/etc/issue文件都会被重复修改2次，最终定格在“Web”字样，这显然缺少了一些东西。我们应该依据inventory_hostname变量中的值进行判断。若主机为dev组，则执行第一个动作；若主机为web组，则执行第二个动作；因此，要进行2次判断。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003ewhen是用于判断的语法\u003c/strong\u003e，我们将其用在每个动作的下方进行判断，使得只有在满足条件才会执行：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003evim issue.yml\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-yaml\" data-lang=\"yaml\"\u003e\u003cspan class=\"nn\"\u003e---\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003e修改文件内容\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003ehosts\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eall\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003etasks\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e          \u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003e定义内容dev\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e            \u003c/span\u003e\u003cspan class=\"nt\"\u003ecopy\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e                    \u003c/span\u003e\u003cspan class=\"nt\"\u003econtent\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;Development\u0026#39;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e                    \u003c/span\u003e\u003cspan class=\"nt\"\u003edest\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003e/etc/issue\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e            \u003c/span\u003e\u003cspan class=\"nt\"\u003ewhen\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;inventory_hostname in groups.devserver\u0026#34;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e          \u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003e定义内容web\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e            \u003c/span\u003e\u003cspan class=\"nt\"\u003ecopy\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e                    \u003c/span\u003e\u003cspan class=\"nt\"\u003econtent\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;Web\u0026#39;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e                    \u003c/span\u003e\u003cspan class=\"nt\"\u003edest\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003e/etc/issue\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e            \u003c/span\u003e\u003cspan class=\"nt\"\u003ewhen\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;inventory_hostname in groups.webserver\u0026#34;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e执行剧本文件，在过程中可清晰地看到由于when语法的作用，未在指定主机组中的主机将被跳过（skipping）：\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e[root@play1 ~]# ansible-playbook issue.yml \n\nPLAY [修改文件内容] **********************************************************************\n\nTASK [Gathering Facts] *************************************************************\nok: [192.168.88.139]\nok: [192.168.88.130]\n\nTASK [定义内容dev] *********************************************************************\nskipping: [192.168.88.139]\nchanged: [192.168.88.130]\n\nTASK [定义内容web] *********************************************************************\nskipping: [192.168.88.130]\nchanged: [192.168.88.139]\n\n\nPLAY RECAP *************************************************************************\n192.168.88.130       : ok=2  changed=1  unreachable=0  failed=0  skipped=1  rescued=0  ignored=0  \n192.168.88.139       : ok=2  changed=1  unreachable=0  failed=0  skipped=1  rescued=0  ignored=0 \n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e登录到dev组的192.168.88.139主机上，查看文件内容：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003ecat /etc/issue\n\nDevelopment\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e登录到dev组的192.168.88.130主机上，查看文件内容：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003ecat /etc/issue\n\nWeb\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"管理文件属性\"\u003e管理文件属性\u003c/h2\u003e\n\u003cp\u003e我们学习剧本的目的是为了满足日常的工作需求，把重复的事情写入到脚本中，然后再批量执行下去，从而提高运维工作的效率。其中，创建文件、管理权限以及设置快捷方式几乎是每天都用到的技能。尤其是在学习文件的一般权限、特殊权限、隐藏权限时，往往还会因命令的格式问题而导致出错。这么多命令该怎么记呢？\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eAnsible服务将常用的文件管理功能都合并到了file模块中\u003c/strong\u003e，大家不用再为了寻找模块而“东奔西跑”了。先来看一下file模块的帮助信息：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-yaml\" data-lang=\"yaml\"\u003e\u003cspan class=\"l\"\u003eansible-doc file\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"l\"\u003e\u0026gt; FILE  (/usr/lib/python3.6/site-packages/ansible/modules/files/file.py)\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"l\"\u003e​    Set attributes of files, symlinks or directories.\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"l\"\u003e​    Alternatively, remove files, symlinks or directories. Many\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"l\"\u003e​    other modules support the same options as the `file\u0026#39; module -\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"l\"\u003e​    including [copy], [template], and [assemble]. For Windows\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"l\"\u003e​    targets, use the [win_file] module instead.\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e*\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eThis module is maintained by The Ansible Core Team\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003eEXAMPLES\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eChange file ownership, group and permissions\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003efile\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003e/etc/foo.conf\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003eowner\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003efoo\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003egroup\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003efoo\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003emode\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;0644\u0026#39;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eGive insecure permissions to an existing file\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003efile\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003e/work\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003eowner\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eroot\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003egroup\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eroot\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003emode\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;1777\u0026#39;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eCreate a symbolic link\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003efile\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003esrc\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003e/file/to/link/to\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003edest\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003e/path/to/symlink\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003eowner\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003efoo\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003egroup\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003efoo\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003estate\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003elink\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e通过上面的输出示例，大家已经能够了解file模块的基本参数了。其中，path参数定义了文件的路径，owner参数定义了文件所有者，group参数定义了文件所属组，mode参数定义了文件权限，src参数定义了源文件的路径，dest参数定义了目标文件的路径，state参数则定义了文件类型。\u003c/p\u003e\n\u003cp\u003e可见，file模块基本上把之前学习过的管理文件权限的功能都包含在内了。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e请创建出一个名为/ftproot的新目录，所有者及所属组均为root管理员身份；\u003c/li\u003e\n\u003cli\u003e设置所有者和所属于组拥有对文件的完全控制权，而其他人则只有阅读和执行权限；\u003c/li\u003e\n\u003cli\u003e给予SGID特殊权限；\u003c/li\u003e\n\u003cli\u003e仅在dev主机组的主机上实施。\u003c/li\u003e\n\u003cli\u003e创建一个名称为 /ftp 的快捷方式文件，指向刚刚建立的 /ftproot 目录\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode\u003evim chmod.yml\n\u003c/code\u003e\u003c/pre\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-yaml\" data-lang=\"yaml\"\u003e\u003cspan class=\"nn\"\u003e---\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003e管理文件属性\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003ehosts\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003edevserver\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003etasks\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e          \u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003echmod\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e            \u003c/span\u003e\u003cspan class=\"nt\"\u003efile\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e                    \u003c/span\u003e\u003cspan class=\"nt\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003e/ftproot\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e                    \u003c/span\u003e\u003cspan class=\"nt\"\u003estate\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003edirectory\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e                    \u003c/span\u003e\u003cspan class=\"nt\"\u003eowner\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eroot\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e                    \u003c/span\u003e\u003cspan class=\"nt\"\u003egroup\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eroot\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e                    \u003c/span\u003e\u003cspan class=\"nt\"\u003emode\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;2775\u0026#39;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e          \u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eln\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e            \u003c/span\u003e\u003cspan class=\"nt\"\u003efile\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e                    \u003c/span\u003e\u003cspan class=\"nt\"\u003esrc\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003e/ftproot\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e                    \u003c/span\u003e\u003cspan class=\"nt\"\u003edest\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003e/ftp\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e                    \u003c/span\u003e\u003cspan class=\"nt\"\u003estate\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003elink\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e进入到dev组的主机中，可以看到/ftproot目录及/ftp的快捷方式均已经被顺利创建：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003ell -d /ftp\nlrwxrwxrwx \u003cspan class=\"m\"\u003e1\u003c/span\u003e root root \u003cspan class=\"m\"\u003e8\u003c/span\u003e Oct \u003cspan class=\"m\"\u003e29\u003c/span\u003e 01:10 /ftp -\u0026gt; /ftproot\n\nll -d /ftproot/\ndrwxrwsr-x \u003cspan class=\"m\"\u003e2\u003c/span\u003e root root \u003cspan class=\"m\"\u003e6\u003c/span\u003e Oct \u003cspan class=\"m\"\u003e29\u003c/span\u003e 01:10 /ftproot/\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"管理密码库文件\"\u003e管理密码库文件\u003c/h2\u003e\n\u003cp\u003e自Ansible 1.5版本发布后，\u003cstrong\u003evault\u003c/strong\u003e作为一项新功能进入到了运维人员的视野。它不仅能对密码、剧本等敏感信息进行加密，而且还可以加密变量名称和变量值，从而确保数据不会被他人轻易阅读。使用ansible-vault命令可以实现内容的新建（create）、加密（encrypt）、解密（decrypt）、修改密码（rekey）及查看（view）等功能。\u003c/p\u003e\n\u003cp\u003e下面通过示例来学习vault的具体用法。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e第1步\u003c/strong\u003e：创建出一个名为locker.yml的配置文件，其中保存了两个变量值：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003evim locker.yml\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-yaml\" data-lang=\"yaml\"\u003e\u003cspan class=\"nn\"\u003e---\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003epw_developer\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eImadev\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003epw_manager\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eImamgr\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cstrong\u003e第2步\u003c/strong\u003e：使用ansible-vault命令对文件进行加密。由于需要每次输入密码比较麻烦，因此还应新建一个用于保存密码值的文本文件，以便让ansible-vault命令自动调用。为了保证数据的安全性，在新建密码文件后将该文件的权限设置为600，确保仅管理员可读可写：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003evim secret.txt\n\nwhenyouwishuponastar\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003echmod \u003cspan class=\"m\"\u003e600\u003c/span\u003e secret.txt\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e在Ansible服务的主配置文件中，在第140行的vault_password_file参数后指定密码值保存的文件路径，准备进行调用（如果把密码文件路径加入主配置文件，则查看加密文件时无需输入密码）：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003evim /etc/ansible/ansible.cfg\n\n\u003cspan class=\"m\"\u003e140\u003c/span\u003e \u003cspan class=\"nv\"\u003evault_password_file\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e /root/secret.txt\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cstrong\u003e第3步\u003c/strong\u003e：在设置好密码文件的路径后，Ansible服务便会自动进行加载。用户也就不用在每次加密或解密时都重复输入密码了。例如，在加密刚刚创建的locker.yml文件时，只需要使用encrypt参数即可：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eansible-vault encrypt locker.yml \n\nEncryption successful\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e文件将使用AES 256加密方式进行加密，也就是意味着密钥有2256种可能。查看到加密后的内容为：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003ecat locker.yml \n\n\u003cspan class=\"nv\"\u003e$ANSIBLE_VAULT\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e1.1\u003cspan class=\"p\"\u003e;\u003c/span\u003eAES256\n\u003cspan class=\"m\"\u003e66363866396439333330303937326263646231386131333233346237366232333631636636653730\u003c/span\u003e\n3262633761366532353165366465643132343861386464330a326265386265656630393263613333\n\u003cspan class=\"m\"\u003e65343065643332653637363730626365663830636462306239653537376231326539386666383631\u003c/span\u003e\n3461396566633734620a643639663465616664663938326464393333336562343631373666663431\n\u003cspan class=\"m\"\u003e35373062363831306562653630373066613462343335303235646165623738306331663637386534\u003c/span\u003e\n\u003cspan class=\"m\"\u003e6330346432386439333966333261383165376235393534613339\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e如果不想使用原始密码了呢？也可以使用rekey参数手动对文件进行改密操作，同时应结合--ask-vault-pass参数进行修改，否则Ansible服务会因接收不到用户输入的旧密码值而拒绝新的密码变更请求：\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eansible-vault rekey --ask-vault-pass locker.yml \nVault password: \nNew Vault password: \nConfirm New Vault password: \nRekey successful\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cstrong\u003e第4步\u003c/strong\u003e：如果想查看和修改加密文件中的内容，该怎么操作呢？对于已经加密过的文件，需要使用ansible-vault命令的edit参数进行修改，随后用view参数即可查看到修改后的内容。ansible-vault命令对加密文件的编辑操作默认使用的是Vim编辑器，在修改完毕后请记得执行wq操作保存后退出：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eansible-vault edit locker.yml \n\n---\npw_developer: Imadev\npw_manager: Imamgr\npw_production: Imaprod\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e最后，再用view参数进行查看，便是最新的内容了：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eansible-vault view locker.yml \n\n---\npw_developer: Imadev\npw_manager: Imamgr\npw_production: Imaprod\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003chr\u003e\n\u003cp\u003eReferences \u0026amp; Resources：\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://www.linuxprobe.com/basic-learning-16.html\"\u003ewww.linuxprobe.com：使用Ansible服务实现自动化运维\u003c/a\u003e\u003c/p\u003e\n\u003csection class=\"footnotes\" role=\"doc-endnotes\"\u003e\n\u003chr\u003e\n\u003col\u003e\n\u003cli id=\"fn:1\" role=\"doc-endnote\"\u003e\n\u003cp\u003eEpel-release：RHEL 8系统的镜像文件默认不带有某些服务程序，需要从Extra Packages for Enterprise Linux（EPEL）扩展软件包仓库获取。EPEL软件包仓库由红帽公司提供，是一个用于创建、维护和管理企业版Linux的高质量软件扩展仓库，通用于RHEL、CentOS、Oracle Linux等多种红帽系企业版系统，目的是对于默认系统仓库软件包进行扩展。\u0026#160;\u003ca href=\"#fnref:1\" class=\"footnote-backref\" role=\"doc-backlink\"\u003e\u0026#x21a9;\u0026#xfe0e;\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli id=\"fn:2\" role=\"doc-endnote\"\u003e\n\u003cp\u003eAnsible服务的主配置文件存在优先级的顺序关系，默认存放在/etc/ansible目录中的主配置文件优先级最低。如果在当前目录或用户家目录中也存放着一份主配置文件，则以当前目录或用户家目录中的主配置文件为主。同时存在多个Ansible服务主配置文件时，具体优先级顺序如表所示。\u0026#160;\u003ca href=\"#fnref:2\" class=\"footnote-backref\" role=\"doc-backlink\"\u003e\u0026#x21a9;\u0026#xfe0e;\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/section\u003e\n","date":1635479451,"description":"","fuzzywordcount":17500,"kind":"page","lang":"zh","lastmod":1646884013,"objectID":"bd913db97f53837eb8b0c76c729aeb69","publishdate":1635479451,"relpermalink":"/posts/ansible/","section":"posts","summary":"简介 Ansible目前是运维自动化工具中最简单、容易上手的一","tags":["Linux","Ansible"],"title":"Ansible","url":"https://ikuriko.github.io/posts/ansible/","wordcount":17433},{"categories":"posts","content":"\u003ch2 id=\"vsftpd\"\u003eVsftpd\u003c/h2\u003e\n\u003ch3 id=\"简介\"\u003e简介\u003c/h3\u003e\n\u003cp\u003e为了解决在复杂多样的设备之间传输文件，文件传输协议（FTP）诞生了。由于FTP协议是明文传输，不够可靠。所以为了满足传输的安全性，出现了\u003cstrong\u003evsftpd（very secure ftp daemon，非常安全的FTP守护进程）\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eFTP默认使用\u003cstrong\u003e20\u003c/strong\u003e、\u003cstrong\u003e21\u003c/strong\u003e端口\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e20端口用于数据传输\u003c/li\u003e\n\u003cli\u003e21端口用于FTP的连接和控制（接受客户端发出的FTP命令和参数）。\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"认证方式\"\u003e认证方式\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003e匿名用户模式\u003c/strong\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e　　最不安全的一种认证模式，任何人都无需密码验证而直接登录到FTP服务器\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003e本地用户模式\u003c/strong\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e　　通过Linux系统本地的账户密码认证的模式，相较于匿名更安全，配置也更简单。（如果有人通过FTP破解了账户的信息，就可以畅通无阻的登录到FTP服务器，从而控制整台服务器）\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003e虚拟用户模式\u003c/strong\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e　　更安全的一种认证模式，它需要FTP服务单独为客户建立数据库文件，虚拟出用来进行密码验证的账户信息，而这些账户信息在服务器系统中实际上是不存在的，仅供FTP服务进行认证使用。\u003c/p\u003e\n\u003ch3 id=\"安装vsftpd\"\u003e安装Vsftpd\u003c/h3\u003e\n\u003cp\u003e当前环境为CentOS Linux 8.4，配置软件仓库\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003emv /etc/yum.repos.d/CentOS-Linux-BaseOS.repo /etc/yum.repos.d/CentOS-Linux-BaseOS.repo.bak\ncurl -o /etc/yum.repos.d/CentOS-Linux-BaseOS.repo https://mirrors.aliyun.com/repo/Centos-8.repo\ndnf clean all\ndnf makecache\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e安装vsftp软件包\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003ednf install vsftpd\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e备份原配置文件\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003emv /etc/vsftpd/vsftpd.conf /etc/vsftpd/vsftpd.conf.bak\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e过滤#开头的行，生成新的配置文件\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003egrep -v \u003cspan class=\"s2\"\u003e\u0026#34;#\u0026#34;\u003c/span\u003e /etc/vsftpd/vsftpd.conf.bak \u0026gt; /etc/vsftpd/vsftpd.conf\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e查看配置文件\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003ecat /etc/vsftpd/vsftpd.conf\n\n\u003cspan class=\"m\"\u003e1\u003c/span\u003e  \u003cspan class=\"nv\"\u003eanonymous_enable\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eNO\n\u003cspan class=\"m\"\u003e2\u003c/span\u003e  \u003cspan class=\"nv\"\u003elocal_enable\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eYES\n\u003cspan class=\"m\"\u003e3\u003c/span\u003e  \u003cspan class=\"nv\"\u003ewrite_enable\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eYES\n\u003cspan class=\"m\"\u003e4\u003c/span\u003e  \u003cspan class=\"nv\"\u003elocal_umask\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e022\u003c/span\u003e\n\u003cspan class=\"m\"\u003e5\u003c/span\u003e  \u003cspan class=\"nv\"\u003edirmessage_enable\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eYES\n\u003cspan class=\"m\"\u003e6\u003c/span\u003e  \u003cspan class=\"nv\"\u003exferlog_enable\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eYES\n\u003cspan class=\"m\"\u003e7\u003c/span\u003e  \u003cspan class=\"nv\"\u003econnect_from_port_20\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eYES\n\u003cspan class=\"m\"\u003e8\u003c/span\u003e  \u003cspan class=\"nv\"\u003exferlog_std_format\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eYES\n\u003cspan class=\"m\"\u003e9\u003c/span\u003e  \u003cspan class=\"nv\"\u003elisten\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eNO\n\u003cspan class=\"m\"\u003e10\u003c/span\u003e \u003cspan class=\"nv\"\u003elisten_ipv6\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eYES\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e主配置文件的常用参数\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth style=\"text-align:left\"\u003e参数\u003c/th\u003e\n\u003cth style=\"text-align:left\"\u003e作用\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003elisten=[YES|NO]\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e是否以独立运行的方式监听服务\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003elisten_address=IP地址\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e设置要监听的IP地址\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003elisten_port=21\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e设置FTP服务的监听端口\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003edownload_enable＝[YES|NO]\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e是否允许下载文件\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003euserlist_enable=[YES|NO]  userlist_deny=[YES|NO]\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e设置用户列表为“允许”还是“禁止”操作\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003emax_clients=0\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e最大客户端连接数，0为不限制\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003emax_per_ip=0\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e同一IP地址的最大连接数，0为不限制\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003eanonymous_enable=[YES|NO]\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e是否允许匿名用户访问\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003eanon_upload_enable=[YES|NO]\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e是否允许匿名用户上传文件\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003eanon_umask=022\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e匿名用户上传文件的umask值\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003eanon_root=/var/ftp\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e匿名用户的FTP根目录\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003eanon_mkdir_write_enable=[YES|NO]\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e是否允许匿名用户创建目录\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003eanon_other_write_enable=[YES|NO]\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e是否开放匿名用户的其他写入权限（包括重命名、删除等操作权限）\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003eanon_max_rate=0\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e匿名用户的最大传输速率（字节/秒），0为不限制\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003elocal_enable=[YES|NO]\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e是否允许本地用户登录FTP\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003elocal_umask=022\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e本地用户上传文件的umask值\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003elocal_root=/var/ftp\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e本地用户的FTP根目录\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003echroot_local_user=[YES|NO]\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e是否将用户权限禁锢在FTP目录，以确保安全\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003elocal_max_rate=0\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e本地用户最大传输速率（字节/秒），0为不限制\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch3 id=\"配置匿名用户模式\"\u003e配置匿名用户模式\u003c/h3\u003e\n\u003cblockquote\u003e\n\u003cp\u003evsftpd服务程序默认关闭了匿名登录的方式，我们需要开放匿名用户的上传、下载文件的权限，以及让匿名用户创建、删除、更名文件的权限。不建议在生产环境中使用此种模式\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e安装vsftpd软件包\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003ednf install vsftpd\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e备份原配置文件\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003emv /etc/vsftpd/vsftpd.conf /etc/vsftpd/vsftpd.conf.bak\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e过滤#开头的行，生成新的配置文件\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003egrep -v \u003cspan class=\"s2\"\u003e\u0026#34;#\u0026#34;\u003c/span\u003e /etc/vsftpd/vsftpd.conf.bak \u0026gt; /etc/vsftpd/vsftpd.conf\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e编辑配置文件\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003evim /etc/vsftpd/vsftpd.conf\n\u003c/code\u003e\u003c/pre\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"nv\"\u003eanonymous_enable\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eYES\n\u003cspan class=\"nv\"\u003eanon_umask\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e022\u003c/span\u003e\n\u003cspan class=\"nv\"\u003eanon_upload_enable\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eYES\n\u003cspan class=\"nv\"\u003eanon_mkdir_write_enable\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eYES\n\u003cspan class=\"nv\"\u003eanon_other_write_enable\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eYES\n\n\u003cspan class=\"nv\"\u003elocal_enable\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eYES\n\u003cspan class=\"nv\"\u003ewrite_enable\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eYES\n\u003cspan class=\"nv\"\u003elocal_umask\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e022\u003c/span\u003e\n\u003cspan class=\"nv\"\u003edirmessage_enable\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eYES\n\u003cspan class=\"nv\"\u003exferlog_enable\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eYES\n\u003cspan class=\"nv\"\u003econnect_from_port_20\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eYES\n\u003cspan class=\"nv\"\u003exferlog_std_format\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eYES\n\u003cspan class=\"nv\"\u003elisten\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eNO\n\u003cspan class=\"nv\"\u003elisten_ipv6\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eYES\n\u003cspan class=\"nv\"\u003epam_service_name\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003evsftpd\n\u003cspan class=\"nv\"\u003euserlist_enable\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eYES\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e向匿名用户开放的权限参数以及作用\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003e参数\u003c/th\u003e\n\u003cth\u003e作用\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003eanonymous_enable=YES\u003c/td\u003e\n\u003ctd\u003e允许匿名访问模式\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eanon_umask=022\u003c/td\u003e\n\u003ctd\u003e匿名用户上传文件的umask值\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eanon_upload_enable=YES\u003c/td\u003e\n\u003ctd\u003e允许匿名用户上传文件\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eanon_mkdir_write_enable=YES\u003c/td\u003e\n\u003ctd\u003e允许匿名用户创建目录\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eanon_other_write_enable=YES\u003c/td\u003e\n\u003ctd\u003e允许匿名用户修改目录名称或删除目录\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp\u003e创建在ftp默认访问目录下创建一个公用目录\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003emkdir  /var/ftp/pub\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e给与ftp用户子目录的属主\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003echown -R ftp /var/ftp/pub/\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cfont color=red\u003e \u003cem\u003e注意：不建议给予父目录/var/ftp属主或777权限，会触发安全保护机制，导致用户无法登录\u003c/em\u003e\u003c/font\u003e\u003c/p\u003e\n\u003cp\u003e重启服务\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003esystemctl restart vsftpd\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e加入开机自启\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003esystemctl \u003cspan class=\"nb\"\u003eenable\u003c/span\u003e vsftpd\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e查看与FTP相关的SELinux域策略\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003egetsebool -a \u003cspan class=\"p\"\u003e|\u003c/span\u003e grep ftp\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e修改SELinux策略，-P永久生效\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003esetsebool -P \u003cspan class=\"nv\"\u003eftpd_full_access\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eon\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e允许firewall通过ftp协议\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003efirewall-cmd --permanent --zone\u003cspan class=\"o\"\u003e=\u003c/span\u003epublic --add-service\u003cspan class=\"o\"\u003e=\u003c/span\u003eftp\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e重新加载firewall策略生效\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003efirewall-cmd --reload\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"配置本地用户模式\"\u003e配置本地用户模式\u003c/h3\u003e\n\u003cblockquote\u003e\n\u003cp\u003evsftpd服务程序默认关闭了匿名登录的方式，我们需要开放匿名用户的上传、下载文件的权限，以及让匿名用户创建、删除、更名文件的权限。不建议在生产环境中使用此种模式\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e安装vsftpd软件包\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003ednf install vsftpd\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e备份原配置文件\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003emv /etc/vsftpd/vsftpd.conf /etc/vsftpd/vsftpd.conf.bak\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e过滤#开头的行，生成新的配置文件\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003egrep -v \u003cspan class=\"s2\"\u003e\u0026#34;#\u0026#34;\u003c/span\u003e /etc/vsftpd/vsftpd.conf.bak \u0026gt; /etc/vsftpd/vsftpd.conf\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e编辑配置文件\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003evim /etc/vsftpd/vsftpd.conf\n\u003c/code\u003e\u003c/pre\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"nv\"\u003eanonymous_enable\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eNO\n\u003cspan class=\"nv\"\u003elocal_enable\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eYES\n\u003cspan class=\"nv\"\u003ewrite_enable\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eYES\n\u003cspan class=\"nv\"\u003elocal_umask\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e022\u003c/span\u003e\n\u003cspan class=\"nv\"\u003edirmessage_enable\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eYES\n\u003cspan class=\"nv\"\u003exferlog_enable\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eYES\n\u003cspan class=\"nv\"\u003econnect_from_port_20\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eYES\n\u003cspan class=\"nv\"\u003exferlog_std_format\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eYES\n\u003cspan class=\"nv\"\u003elisten\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eNO\n\u003cspan class=\"nv\"\u003elisten_ipv6\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eYES\n\u003cspan class=\"nv\"\u003epam_service_name\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003evsftpd\n\u003cspan class=\"nv\"\u003euserlist_enable\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eYES\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e本地用户模式使用的权限参数以及作用\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003e参数\u003c/th\u003e\n\u003cth\u003e作用\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003eanonymous_enable=NO\u003c/td\u003e\n\u003ctd\u003e禁止匿名访问模式\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003elocal_enable=YES\u003c/td\u003e\n\u003ctd\u003e允许本地用户模式\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003ewrite_enable=YES\u003c/td\u003e\n\u003ctd\u003e设置可写权限\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003elocal_umask=022\u003c/td\u003e\n\u003ctd\u003e本地用户模式创建文件的umask值\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003euserlist_deny=YES\u003c/td\u003e\n\u003ctd\u003e启用“禁止用户名单”，名单文件为ftpusers和user_list\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003euserlist_enable=YES\u003c/td\u003e\n\u003ctd\u003e开启用户作用名单文件功能\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp\u003e重启服务\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003esystemctl restart vsftpd\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e加入开机自启\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003esystemctl \u003cspan class=\"nb\"\u003eenable\u003c/span\u003e vsftpd\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e查看与FTP相关的SELinux域策略\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003egetsebool -a \u003cspan class=\"p\"\u003e|\u003c/span\u003e grep ftp\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e修改SELinux策略，-P永久生效\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003esetsebool -P \u003cspan class=\"nv\"\u003eftpd_full_access\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eon\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e允许firewall通过ftp协议\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003efirewall-cmd --permanent --zone\u003cspan class=\"o\"\u003e=\u003c/span\u003epublic --add-service\u003cspan class=\"o\"\u003e=\u003c/span\u003eftp\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e重新加载firewall策略生效\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003efirewall-cmd --reload\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e现在可以使用的本地账户，来登录ftp服务，但为了服务器的安全性，ftp服务默认禁止了大多本地系统用户的登录。如果想要使用root用户登录，删除ftp用户黑名单\u003ccode\u003eftpusers\u003c/code\u003e和\u003ccode\u003euser_list\u003c/code\u003e\u003csup id=\"fnref:1\"\u003e\u003ca href=\"#fn:1\" class=\"footnote-ref\" role=\"doc-noteref\"\u003e1\u003c/a\u003e\u003c/sup\u003e中的root即可。\u003c/p\u003e\n\u003cp\u003e当然也可以创建一个不允许登录系统的账户，给ftp登录专用\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003euseradd -s /sbin/nologin \u003cspan class=\"nb\"\u003etest\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"配置虚拟用户模式\"\u003e配置虚拟用户模式\u003c/h3\u003e\n\u003cp\u003e安装vsftpd软件包\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003ednf install vsftpd\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e新建虚拟用户账号密码文件\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"nb\"\u003ecd\u003c/span\u003e /etc/vsftpd/\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003evim vuser.list\ntest1\npwd@test1\ntest2\npwd@test2\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cfont color=red\u003e\u003cem\u003e注：奇数为用户名，偶数用户密码\u003c/em\u003e\u003c/font\u003e\u003c/p\u003e\n\u003cp\u003e使用哈希（hash）算法转换成数据库文件\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003edb_load -T -t \u003cspan class=\"nb\"\u003ehash\u003c/span\u003e -f vuser.list vuser.db\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e降低此文件的权限\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003echmod \u003cspan class=\"m\"\u003e600\u003c/span\u003e vuser.db\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e#建议删除明文信息文件（可选，怕忘密码可以不删）\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003erm -rf vuser.list\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e创建virtual本地用户用于和虚拟用户的映射，指定家目录，不允许该用户登录系统\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003euseradd -d /var/ftproot -s /sbin/nologin virtual\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cfont color=red\u003e\u003cem\u003e注：指定的家目录为/var/ftproot（上面的操作将设置此为ftp登录后默认进入的目录）\u003c/em\u003e\u003c/font\u003e\u003c/p\u003e\n\u003cp\u003e查看新生成的目录权限，为700\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003els -ld /var/ftproot/\ndrwx------. \u003cspan class=\"m\"\u003e2\u003c/span\u003e virtual virtual \u003cspan class=\"m\"\u003e62\u003c/span\u003e Oct \u003cspan class=\"m\"\u003e19\u003c/span\u003e 10:44 /var/ftproot/\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e强制提升目录权限为755\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003echmod -Rf \u003cspan class=\"m\"\u003e755\u003c/span\u003e /var/ftproot/\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003els -ld /var/ftproot/\ndrwxr-xr-x. \u003cspan class=\"m\"\u003e2\u003c/span\u003e virtual virtual \u003cspan class=\"m\"\u003e62\u003c/span\u003e Oct \u003cspan class=\"m\"\u003e19\u003c/span\u003e 15:17 /var/ftproot/\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e建立支持虚拟用户的PAM\u003csup id=\"fnref:2\"\u003e\u003ca href=\"#fn:2\" class=\"footnote-ref\" role=\"doc-noteref\"\u003e2\u003c/a\u003e\u003c/sup\u003e文件\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003evim /etc/pam.d/vsftpd.vu\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eauth       required     pam_userdb.so \u003cspan class=\"nv\"\u003edb\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e/etc/vsftpd/vuser\naccount    required     pam_userdb.so \u003cspan class=\"nv\"\u003edb\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e/etc/vsftpd/vuser\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e备份原配置文件\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003emv /etc/vsftpd/vsftpd.conf /etc/vsftpd/vsftpd.conf.bak\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e过滤#开头的行，生成新的配置文件\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003egrep -v \u003cspan class=\"s2\"\u003e\u0026#34;#\u0026#34;\u003c/span\u003e /etc/vsftpd/vsftpd.conf.bak \u0026gt; /etc/vsftpd/vsftpd.conf\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e创建虚拟用户权限目录\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003emkdir /etc/vsftpd/vusers_dir\n\u003cspan class=\"nb\"\u003ecd\u003c/span\u003e /etc/vsftpd/vusers_dir\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e不给予test1权限，test1只拥有默认的查看和下载权限\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003etouch test1\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e给与test2所有权限，test2能够上传、下载、删除等\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003evim test2\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"nv\"\u003eanon_upload_enable\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eYES\n\u003cspan class=\"nv\"\u003eanon_mkdir_write_enable\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eYES\n\u003cspan class=\"nv\"\u003eanon_other_write_enable\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eYES\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e编辑配置文件\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003evim /etc/vsftpd/vsftpd.conf\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"nv\"\u003eanonymous_enable\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eNO\n\u003cspan class=\"nv\"\u003elocal_enable\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eYES\n\u003cspan class=\"nv\"\u003ewrite_enable\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eYES\n\u003cspan class=\"nv\"\u003eguest_enable\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eYES\n\u003cspan class=\"nv\"\u003eguest_username\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003evirtual\n\u003cspan class=\"nv\"\u003eallow_writeable_chroot\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eYES\n\u003cspan class=\"nv\"\u003elocal_umask\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e022\u003c/span\u003e\n\u003cspan class=\"nv\"\u003edirmessage_enable\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eYES\n\u003cspan class=\"nv\"\u003exferlog_enable\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eYES\n\u003cspan class=\"nv\"\u003econnect_from_port_20\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eYES\n\u003cspan class=\"nv\"\u003exferlog_std_format\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eYES\n\u003cspan class=\"nv\"\u003elisten\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eNO\n\u003cspan class=\"nv\"\u003elisten_ipv6\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eYES\n\u003cspan class=\"nv\"\u003epam_service_name\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003evsftpd.vu\n\u003cspan class=\"nv\"\u003euserlist_enable\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eYES\n\u003cspan class=\"nv\"\u003euser_config_dir\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e/etc/vsftpd/vusers_dir\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e利用PAM文件进行认证时使用的参数以及作用\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003e参数\u003c/th\u003e\n\u003cth\u003e作用\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003eanonymous_enable=NO\u003c/td\u003e\n\u003ctd\u003e禁止匿名开放模式\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003elocal_enable=YES\u003c/td\u003e\n\u003ctd\u003e允许本地用户模式\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eguest_enable=YES\u003c/td\u003e\n\u003ctd\u003e开启虚拟用户模式\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eguest_username=ftpvuser\u003c/td\u003e\n\u003ctd\u003e指定虚拟用户账户\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003epam_service_name=vsftpd.vu\u003c/td\u003e\n\u003ctd\u003e指定PAM文件\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eallow_writeable_chroot=YES\u003c/td\u003e\n\u003ctd\u003e允许对禁锢的FTP根目录执行写入操作，而且不拒绝用户的登录请求\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp\u003e重启服务\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003esystemctl restart vsftpd\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e加入开机自启\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003esystemctl \u003cspan class=\"nb\"\u003eenable\u003c/span\u003e vsftpd\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e查看与FTP相关的SELinux域策略\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003egetsebool -a \u003cspan class=\"p\"\u003e|\u003c/span\u003e grep ftp\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e修改SELinux策略，-P永久生效\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003esetsebool -P \u003cspan class=\"nv\"\u003eftpd_full_access\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eon\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e允许firewall通过ftp协议\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003efirewall-cmd --permanent --zone\u003cspan class=\"o\"\u003e=\u003c/span\u003epublic --add-service\u003cspan class=\"o\"\u003e=\u003c/span\u003eftp\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e重新加载firewall策略生效\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003efirewall-cmd --reload\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"连接测试\"\u003e连接测试\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003etest1只有下载权限\u003c/li\u003e\n\u003cli\u003etest2拥有所有权限\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e安装lftp客户端工具，连接测试\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003ednf install lftp\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"c1\"\u003e#lftp的简易使用\u003c/span\u003e\nlftp \u0026lt;FTP服务器IP\u0026gt; -u \u0026lt;用户名\u0026gt;\t\u003cspan class=\"c1\"\u003e#登录FTP服务\u003c/span\u003e\nlftp\u0026gt; ls\t\t\t\t\t\t\u003cspan class=\"c1\"\u003e#列表显示当前所有内容\u003c/span\u003e\nlftp\u0026gt; \u003cspan class=\"nb\"\u003ecd\u003c/span\u003e xxx\t\t\t\t\t\u003cspan class=\"c1\"\u003e#进入指定目录\u003c/span\u003e\nlftp\u0026gt; get xxx\t\t\t\t\t\u003cspan class=\"c1\"\u003e#下载指定文件或目录到当前位置\u003c/span\u003e\nlftp\u0026gt; put xxx\t\t\t\t\t\u003cspan class=\"c1\"\u003e#上传指定文件或目录到FTP\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eFTP目录放入一个文件，测试使用\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;hiahia\u0026#34;\u003c/span\u003e \u0026gt; /var/ftproot/lookup.txt\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e使用test1用户登录测试\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003eroot@localhost ~\u003cspan class=\"o\"\u003e]\u003c/span\u003e\u003cspan class=\"c1\"\u003e# lftp 192.168.88.133 -u test1\u003c/span\u003e\nPassword:                   \nlftp test1@192.168.88.133:~\u0026gt; ls\n-rw-r--r--    \u003cspan class=\"m\"\u003e1\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e        \u003cspan class=\"m\"\u003e0\u003c/span\u003e               \u003cspan class=\"m\"\u003e7\u003c/span\u003e Oct \u003cspan class=\"m\"\u003e19\u003c/span\u003e 07:22 lookup.txt\nlftp test1@192.168.88.133:/\u0026gt; get lookup.txt \t\t\u003cspan class=\"c1\"\u003e#能下载文件\u003c/span\u003e\n\u003cspan class=\"m\"\u003e7\u003c/span\u003e bytes transferred\nlftp test1@192.168.88.133:/\u0026gt; mkdir test1\t\t\t\u003cspan class=\"c1\"\u003e#无法创建目录\u003c/span\u003e\nmkdir: Access failed: \u003cspan class=\"m\"\u003e550\u003c/span\u003e Permission denied. \u003cspan class=\"o\"\u003e(\u003c/span\u003etest1\u003cspan class=\"o\"\u003e)\u003c/span\u003e\nlftp test1@192.168.88.133:/\u0026gt; ls\n-rw-r--r--    \u003cspan class=\"m\"\u003e1\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e        \u003cspan class=\"m\"\u003e0\u003c/span\u003e               \u003cspan class=\"m\"\u003e7\u003c/span\u003e Oct \u003cspan class=\"m\"\u003e19\u003c/span\u003e 07:22 lookup.txt\nlftp test1@192.168.88.133:/\u0026gt; rm lookup.txt \t\t\t\u003cspan class=\"c1\"\u003e#无法删除文件\u003c/span\u003e\nrm: Access failed: \u003cspan class=\"m\"\u003e550\u003c/span\u003e Permission denied. \u003cspan class=\"o\"\u003e(\u003c/span\u003elookup.txt\u003cspan class=\"o\"\u003e)\u003c/span\u003e\nlftp test1@192.168.88.133:/\u0026gt; \u003cspan class=\"nb\"\u003eexit\u003c/span\u003e\n\n\u003cspan class=\"o\"\u003e[\u003c/span\u003eroot@localhost ~\u003cspan class=\"o\"\u003e]\u003c/span\u003e\u003cspan class=\"c1\"\u003e# ls\t\t\t#查看下载到本地的文件，测试完毕无异常\u003c/span\u003e\nanaconda-ks.cfg  lookup.txt\n\u003cspan class=\"o\"\u003e[\u003c/span\u003eroot@localhost ~\u003cspan class=\"o\"\u003e]\u003c/span\u003e\u003cspan class=\"c1\"\u003e# cat lookup.txt\u003c/span\u003e\nhiahia\n\u003cspan class=\"o\"\u003e[\u003c/span\u003eroot@localhost ~\u003cspan class=\"o\"\u003e]\u003c/span\u003e\u003cspan class=\"c1\"\u003e# rm -rf lookup.txt\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e使用test2用户登录测试\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003eroot@localhost ~\u003cspan class=\"o\"\u003e]\u003c/span\u003e\u003cspan class=\"c1\"\u003e# lftp 192.168.88.133 -u test2\u003c/span\u003e\nPassword:                       \nlftp test2@192.168.88.133:~\u0026gt; ls\n-rw-r--r--    \u003cspan class=\"m\"\u003e1\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e        \u003cspan class=\"m\"\u003e0\u003c/span\u003e               \u003cspan class=\"m\"\u003e7\u003c/span\u003e Oct \u003cspan class=\"m\"\u003e19\u003c/span\u003e 07:22 lookup.txt\nlftp test2@192.168.88.133:/\u0026gt; get lookup.txt \t\t\t\u003cspan class=\"c1\"\u003e#能下载文件\u003c/span\u003e\n\u003cspan class=\"m\"\u003e7\u003c/span\u003e bytes transferred\nlftp test2@192.168.88.133:/\u0026gt; put /etc/vsftpd/vsftpd.conf\t\t\t\u003cspan class=\"c1\"\u003e#能上传文件\u003c/span\u003e\n\u003cspan class=\"m\"\u003e338\u003c/span\u003e bytes transferred\nlftp test2@192.168.88.133:/\u0026gt; ls\n-rw-r--r--    \u003cspan class=\"m\"\u003e1\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e        \u003cspan class=\"m\"\u003e0\u003c/span\u003e               \u003cspan class=\"m\"\u003e7\u003c/span\u003e Oct \u003cspan class=\"m\"\u003e19\u003c/span\u003e 07:22 lookup.txt\n-rw-------    \u003cspan class=\"m\"\u003e1\u003c/span\u003e \u003cspan class=\"m\"\u003e1000\u003c/span\u003e     \u003cspan class=\"m\"\u003e1000\u003c/span\u003e          \u003cspan class=\"m\"\u003e338\u003c/span\u003e Oct \u003cspan class=\"m\"\u003e19\u003c/span\u003e 07:43 vsftpd.conf\nlftp test2@192.168.88.133:/\u0026gt; mkdir test2\t\t\t\u003cspan class=\"c1\"\u003e#能创建目录\u003c/span\u003e\nmkdir ok, \u003cspan class=\"sb\"\u003e`\u003c/span\u003etest2\u003cspan class=\"s1\"\u003e\u0026#39; created\n\u003c/span\u003e\u003cspan class=\"s1\"\u003elftp test2@192.168.88.133:/\u0026gt; ls\n\u003c/span\u003e\u003cspan class=\"s1\"\u003e-rw-r--r--    1 0        0               7 Oct 19 07:22 lookup.txt\n\u003c/span\u003e\u003cspan class=\"s1\"\u003edrwx------    2 1000     1000            6 Oct 19 07:43 test2\n\u003c/span\u003e\u003cspan class=\"s1\"\u003e-rw-------    1 1000     1000          338 Oct 19 07:43 vsftpd.conf\n\u003c/span\u003e\u003cspan class=\"s1\"\u003elftp test2@192.168.88.133:/\u0026gt; rm lookup.txt \t\t\t#能删除文件\n\u003c/span\u003e\u003cspan class=\"s1\"\u003erm ok, `lookup.txt\u0026#39;\u003c/span\u003e removed\nlftp test2@192.168.88.133:/\u0026gt; ls\ndrwx------    \u003cspan class=\"m\"\u003e2\u003c/span\u003e \u003cspan class=\"m\"\u003e1000\u003c/span\u003e     \u003cspan class=\"m\"\u003e1000\u003c/span\u003e            \u003cspan class=\"m\"\u003e6\u003c/span\u003e Oct \u003cspan class=\"m\"\u003e19\u003c/span\u003e 07:43 test2\n-rw-------    \u003cspan class=\"m\"\u003e1\u003c/span\u003e \u003cspan class=\"m\"\u003e1000\u003c/span\u003e     \u003cspan class=\"m\"\u003e1000\u003c/span\u003e          \u003cspan class=\"m\"\u003e338\u003c/span\u003e Oct \u003cspan class=\"m\"\u003e19\u003c/span\u003e 07:43 vsftpd.conf\nlftp test2@192.168.88.133:/\u0026gt; \u003cspan class=\"nb\"\u003eexit\u003c/span\u003e\n\u003cspan class=\"o\"\u003e[\u003c/span\u003eroot@localhost ~\u003cspan class=\"o\"\u003e]\u003c/span\u003e\u003cspan class=\"c1\"\u003e# ls \t\t\t#查看下载到本地的文件，测试完毕无异常\u003c/span\u003e\nanaconda-ks.cfg  lookup.txt\n\u003cspan class=\"o\"\u003e[\u003c/span\u003eroot@localhost ~\u003cspan class=\"o\"\u003e]\u003c/span\u003e\u003cspan class=\"c1\"\u003e# cat lookup.txt\u003c/span\u003e\nhiahia\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eVsftpd服务程序登陆后所在目录\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003e登录方式\u003c/th\u003e\n\u003cth\u003e默认目录\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003e匿名公开\u003c/td\u003e\n\u003ctd\u003e/var/ftp\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e本地用户\u003c/td\u003e\n\u003ctd\u003e该用户的家目录\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e虚拟用户\u003c/td\u003e\n\u003ctd\u003e对应映射用户的家目录\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"tftp\"\u003eTFTP\u003c/h2\u003e\n\u003ch3 id=\"简介-1\"\u003e简介\u003c/h3\u003e\n\u003cp\u003e\u003cstrong\u003eTFTP（Trivial File Transfer Protocol, 简单文件传输协议）\u003c/strong\u003e，基于UDP协议。提供不复杂、开销小的文件传输服务，相当于FTP协议的简化版本。\u003c/p\u003e\n\u003cp\u003eTFTP，不需要客户端的权限认证，减少了带宽和系统的消耗。它的功能较少，甚至不能遍历目录，安全性也不如FTP。但因此在传输琐碎（Trivial）小文件时，效率更高。\u003c/p\u003e\n\u003ch3 id=\"安装tftp\"\u003e安装TFTP\u003c/h3\u003e\n\u003cp\u003e来安装体验一下，\u003cstrong\u003etftp-server\u003c/strong\u003e 提供服务程序 | \u003cstrong\u003etftp\u003c/strong\u003e是用于连接的客户端工具 | \u003cstrong\u003exinetd\u003c/strong\u003e\u003csup id=\"fnref:3\"\u003e\u003ca href=\"#fn:3\" class=\"footnote-ref\" role=\"doc-noteref\"\u003e3\u003c/a\u003e\u003c/sup\u003e是管理程序的服务\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003ednf install tftp-server tftp xinetd\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e安装TFTP软件包后，还需要再xinetd服务程序中将其开启，再RHEL 8 系统中，tftp所对应的配置文件默认不存在，需要根据示例文件（/usr/share/doc/xinetd/sample.conf）自行创建。把底下的配置直接复制进去就OK\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003evim /etc/xinetd.d/tftp\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eservice tftp\n\u003cspan class=\"o\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nv\"\u003esocket_type\u003c/span\u003e             \u003cspan class=\"o\"\u003e=\u003c/span\u003e dgram\n        \u003cspan class=\"nv\"\u003eprotocol\u003c/span\u003e                \u003cspan class=\"o\"\u003e=\u003c/span\u003e udp\n        \u003cspan class=\"nb\"\u003ewait\u003c/span\u003e                    \u003cspan class=\"o\"\u003e=\u003c/span\u003e yes\n        \u003cspan class=\"nv\"\u003euser\u003c/span\u003e                    \u003cspan class=\"o\"\u003e=\u003c/span\u003e root\n        \u003cspan class=\"nv\"\u003eserver\u003c/span\u003e                  \u003cspan class=\"o\"\u003e=\u003c/span\u003e /usr/sbin/in.tftpd\n        \u003cspan class=\"nv\"\u003eserver_args\u003c/span\u003e             \u003cspan class=\"o\"\u003e=\u003c/span\u003e -s /var/lib/tftpboot\n        \u003cspan class=\"nv\"\u003edisable\u003c/span\u003e                 \u003cspan class=\"o\"\u003e=\u003c/span\u003e no\n        \u003cspan class=\"nv\"\u003eper_source\u003c/span\u003e              \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e11\u003c/span\u003e\n        \u003cspan class=\"nv\"\u003ecps\u003c/span\u003e                     \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e100\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e\n        \u003cspan class=\"nv\"\u003eflags\u003c/span\u003e                   \u003cspan class=\"o\"\u003e=\u003c/span\u003e IPv4\n\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e重启服务\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003esystemctl restart tftp\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e开启自启\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003esystemctl \u003cspan class=\"nb\"\u003eenable\u003c/span\u003e tftp\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e重启xinetd管理服务\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003esystemctl restart xinetd\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e开启自启\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003esystemctl \u003cspan class=\"nb\"\u003eenable\u003c/span\u003e xinetd\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e允许firewall通过udp/69\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003efirewall-cmd --zone\u003cspan class=\"o\"\u003e=\u003c/span\u003epublic --permanent --add-port\u003cspan class=\"o\"\u003e=\u003c/span\u003e69/udp\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e重新加载firewall策略生效\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003efirewall-cmd --reload\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"连接测试-1\"\u003e连接测试\u003c/h3\u003e\n\u003cp\u003e新建测试文件，供下载\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;keke\u0026#34;\u003c/span\u003e \u0026gt;\u0026gt; /var/lib/tftpboot/nn\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eTFTP的根目录为**/var/lib/tftpboot**，使用tftp客户端尝试连接\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003eroot@localhost ~\u003cspan class=\"o\"\u003e]\u003c/span\u003e\u003cspan class=\"c1\"\u003e# tftp 192.168.88.133\u003c/span\u003e\n\ntftp\u0026gt; ls\n\n?Invalid \u003cspan class=\"nb\"\u003ecommand\u003c/span\u003e \u003cspan class=\"o\"\u003e(\u003c/span\u003e无法遍历目录\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\ntftp\u0026gt; get nn\n\ntftp\u0026gt; quit\n\n\u003cspan class=\"o\"\u003e[\u003c/span\u003eroot@localhost ~\u003cspan class=\"o\"\u003e]\u003c/span\u003e\u003cspan class=\"c1\"\u003e# cat nn\u003c/span\u003e\n\nkeke\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003etftp命令中可用的参数以及作用\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003e参数\u003c/th\u003e\n\u003cth\u003e作用\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003e?\u003c/td\u003e\n\u003ctd\u003e帮助信息\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eput\u003c/td\u003e\n\u003ctd\u003e上传文件\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eget\u003c/td\u003e\n\u003ctd\u003e下载文件\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003everbose\u003c/td\u003e\n\u003ctd\u003e显示详细的处理信息\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003estatus\u003c/td\u003e\n\u003ctd\u003e显示当前的状态信息\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003ebinary\u003c/td\u003e\n\u003ctd\u003e使用二进制进行传输\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eascii\u003c/td\u003e\n\u003ctd\u003e使用ASCII码进行传输\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003etimeout\u003c/td\u003e\n\u003ctd\u003e设置重传的超时时间\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003equit\u003c/td\u003e\n\u003ctd\u003e退出\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003chr\u003e\n\u003csection class=\"footnotes\" role=\"doc-endnotes\"\u003e\n\u003chr\u003e\n\u003col\u003e\n\u003cli id=\"fn:1\" role=\"doc-endnote\"\u003e\n\u003cp\u003e 这里为什么需要两个同样的文件来禁用登录功能呢，玄机在与\u003ccode\u003euser_list\u003c/code\u003e上面的一段注释。如果主配置文件中的 \u0026quot;userlist_deny=YES\u0026quot; 则 \u003ccode\u003euser_list\u003c/code\u003e文件变为黑名单，不允许用户登录（此为默认值）。如果主配置文件中的 “userlist_deny=NO” 则\u003ccode\u003euser_list\u003c/code\u003e变为白名单，将允许名单内的用户登录。\u0026#160;\u003ca href=\"#fnref:1\" class=\"footnote-backref\" role=\"doc-backlink\"\u003e\u0026#x21a9;\u0026#xfe0e;\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli id=\"fn:2\" role=\"doc-endnote\"\u003e\n\u003cp\u003ePAM（可插拔认证模块）是一种认证机制，通过一些动态链接库和统一的API把系统提供的服务与认证方式分开，使得系统管理员可以根据需求灵活调整服务程序的不同认证方式。通俗来讲，PAM是一组安全机制的模块，系统管理员可以用来轻易地调整服务程序的认证方式，而不必对应用程序进行任何修改。PAM采取了分层设计（应用程序层、应用接口层、鉴别模块层）的思想\u0026#160;\u003ca href=\"#fnref:2\" class=\"footnote-backref\" role=\"doc-backlink\"\u003e\u0026#x21a9;\u0026#xfe0e;\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli id=\"fn:3\" role=\"doc-endnote\"\u003e\n\u003cp\u003e在Linux系统中，TFTP服务是xinetd服务程序来管理的。xinetd服务可以用来管理多种轻量级的网络服务，而且具有强大的日志功能。它专门用于控制那些比较小的应用程序的开启和关闭，有点类似带有独立开关的插线板，想要开启哪个服务，就编辑对应的xinetd配置文件的开关参数。\u0026#160;\u003ca href=\"#fnref:3\" class=\"footnote-backref\" role=\"doc-backlink\"\u003e\u0026#x21a9;\u0026#xfe0e;\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/section\u003e\n","date":1634195785,"description":"","fuzzywordcount":4200,"kind":"page","lang":"zh","lastmod":1646884223,"objectID":"5a5782c8bf61345055e3dab15d38c6ba","publishdate":1634195785,"relpermalink":"/posts/vsftpd/","section":"posts","summary":"Vsftpd 简介 为了解决在复杂多样的设备之间传输文件，文件传输协议（F","tags":["Linux"],"title":"Vsftpd","url":"https://ikuriko.github.io/posts/vsftpd/","wordcount":4129},{"categories":"posts","content":"\u003cp style=\"text-align:left;color:red;font-size:20px;font-family:arial\"\u003eLinux下抓包工具Tcpdump的常用方法\u003c/p\u003e  \n\u003cp\u003e列出所有可抓取的网口\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003etcpdump -D\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e以端口号显示协议，抓取ens33网卡的数据包\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003etcpdump -nn -i ens33\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e抓取100个ens33网卡的数据包\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003etcpdump -c \u003cspan class=\"m\"\u003e100\u003c/span\u003e -i ens33\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e抓取10个所有网卡过滤源主机为192.168.1.1，端口号不是tcp22的数据包\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003etcpdump -nn -c \u003cspan class=\"m\"\u003e10\u003c/span\u003e  src host  192.168.1.1 and not tcp port \u003cspan class=\"m\"\u003e22\u003c/span\u003e -i any\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e抓取10个所有网卡过滤目标主机为192.168.1.2，端口号不是udp22的数据包\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003etcpdump -nn -c \u003cspan class=\"m\"\u003e10\u003c/span\u003e dst host 192.168.1.2 and not udp port \u003cspan class=\"m\"\u003e22\u003c/span\u003e -i any\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e抓取ping包\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003etcpdump -nn -i ens33 -c \u003cspan class=\"m\"\u003e10\u003c/span\u003e icmp\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","date":1633944636,"description":"","fuzzywordcount":300,"kind":"page","lang":"zh","lastmod":1646884208,"objectID":"905877397367de250b3f4350a6896c04","publishdate":1633944636,"relpermalink":"/posts/tcpdump/","section":"posts","summary":"Linux下抓包工具Tcpdump的常用方法 列出所有可抓取的","tags":["Linux"],"title":"tcpdump 常用命令","url":"https://ikuriko.github.io/posts/tcpdump/","wordcount":207},{"categories":"posts","content":"\u003cp\u003e记录绘制 2D 平面图使用的常用CAD快捷命令\u003c/p\u003e\n\u003cp style='color:red'\u003e所有的命令通过键入命令行，按空格键来执行\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth style=\"text-align:left\"\u003e命令\u003c/th\u003e\n\u003cth style=\"text-align:left\"\u003e功能\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003ep\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e水平移动\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003el\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e直线\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003epl\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e多段线\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003exl\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e射线\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003ef\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e圆角\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003ea\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e圆弧\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003ec\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e圆\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003ed\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e标注样式\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003eddi\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e直径标注\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003erec\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e矩形\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003ee\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e删除选中\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003ecp\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e复制\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003em\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e移动\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003et\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e多行文字\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003eex\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e延伸到\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003es\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e拉伸\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003ez\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e局部放大\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003eu\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e返回\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003eh\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e填充\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003emi\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e镜像\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003epo\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e点\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003esc\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e比例缩放\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003eal\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e对齐\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003eb\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e块定义\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003ero\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e旋转\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003ear\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e阵列\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp\u003e📓待补充\u003c/p\u003e\n","date":1632383849,"description":"","fuzzywordcount":200,"kind":"page","lang":"zh","lastmod":1646884043,"objectID":"f8e77d8a76d83a0c694f37900966b407","publishdate":1632383849,"relpermalink":"/posts/cad/","section":"posts","summary":"记录绘制 2D 平面图使用的常用CAD快捷命令 所有的命令通过键入命","tags":["Other"],"title":"CAD 快捷键","url":"https://ikuriko.github.io/posts/cad/","wordcount":141},{"categories":"posts","content":"\u003cfont size=3px\u003e\n\u003ch2 id=\"命令模式\"\u003e命令模式\u003c/h2\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth style=\"text-align:left\"\u003e命令\u003c/th\u003e\n\u003cth style=\"text-align:left\"\u003e功能\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003eu\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e撤销\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003eCtrl+r\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e重做\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e~\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e当前字符切换大小写\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e\u0026gt;\u0026gt;\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e当前行向右移动一个单位\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e\u0026lt;\u0026lt;\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e当前行向左移动一个单位\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e==\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e自动缩进当前行\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003eCtrl+b\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e向下翻页\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003eCtrl+f\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e向上翻页\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003ew\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e跳到下一个字首标点或单词分割\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003eW\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e跳到下一个字首，长跳\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003ee\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e跳到下一个字尾\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003eE\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e跳到下一个字尾，长跳\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003eb\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e跳到上一个字\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003eB\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e跳到上一个字，长跳\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e0\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e跳到行首，不管有无缩进，直接跳到行首\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e^\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e跳到行首的第一个字符\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e$\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e跳到行尾\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003eG\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e跳到文件末尾\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003egg\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e跳到文件开头\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e5gg\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e移动至第5行\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003efa\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e当前行中寻找a字符，找到了就移动到a\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e;\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e重复上一个f命令，而不用重复的输入fa\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e*\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e查找光标所在处的单词，向下查找\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e#\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e查找光标所在处的单词，向上查找\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003edd\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e删除文件\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003edw\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e删除当前字符到行末，D也可实现\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003ex\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e删除当前的字符\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003eX\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e删除前一个字符\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003edG\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e删除此行开始到文件末尾的所有行，包括此行\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003egg=G\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e自动排版，缩进等\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003ea\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e在当前字符后插入\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003eA\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e在行尾插入\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003ei\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e在当前位置插入\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003eI\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e在行首插入\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003eo\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e在下一行插入\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003eO\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e在上一行插入\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003es\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e删除当前字符并进入编辑模式\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003eS\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e删除光标所在的行并进入编辑模式\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003eyy\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e复制当前的行，Y也可实现\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003eyw\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e复制当前的字段\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003eggyG\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e全部复制\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003eggvG\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e全选（高亮显示）\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003ep\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e粘贴复制的内容\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e/abc\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e向后搜索字符串abc\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e?abc\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e向前搜索字符串abc\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e\\c\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e忽略字母大小写，如/abc\\c\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e\\C\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e大小写敏感\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003en\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e下一个匹配\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003eN\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e上一个匹配\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"多文件编辑\"\u003e多文件编辑\u003c/h2\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth style=\"text-align:left\"\u003e命令\u003c/th\u003e\n\u003cth style=\"text-align:left\"\u003e功能\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003evim file1 file2…\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e同时打开多个文件\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003evim -O file1 file2 …\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e垂直分屏\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003evim -o file1 file2…\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e水平分屏\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"末行模式\"\u003e末行模式\u003c/h2\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth style=\"text-align:left\"\u003e命令\u003c/th\u003e\n\u003cth style=\"text-align:left\"\u003e功能\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e:args\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e显示当前编辑的文件\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e:next\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e切换到下一个文件    前面加w是保存切换，加！是不保存切换\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e:prev\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e切换到上一个文件\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e:first\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e定位首文件\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e:last\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e定位尾文件\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003ectrl+^\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e快速在最近的两个文件切换\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e:close\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e关闭当前窗口\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e:only\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e只显示当前窗口，关闭所有窗口\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e:all\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e打开所有窗口\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e:vertical all\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e垂直打开所有窗口\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e:qall\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e对所有窗口执行q操作\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e:qall!\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e对所有窗口执行q!操作  w操作同理\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003ectrl+w k,j,h,l,t,b\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e跳转到上、下、左、右、最上、最下的窗口\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e:%s/old/new/g\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e搜索整个文件，把old换成new\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n","date":1631177766,"description":"","fuzzywordcount":800,"kind":"page","lang":"zh","lastmod":1646884212,"objectID":"45db1db8155886e57902efdc0ae82ff0","publishdate":1631177766,"relpermalink":"/posts/vim/","section":"posts","summary":"命令模式 命令 功能 u 撤销 Ctrl+r 重做 ~ 当前字符切换大小写 \u0026gt;\u0026gt; 当前行向右","tags":["Linux"],"title":"vim 常用命令","url":"https://ikuriko.github.io/posts/vim/","wordcount":725},{"categories":"posts","content":"\u003cp\u003e为 Javaweb 开发项目搭建基础环境，全部使用源码包手动安装\u003c/p\u003e\n\u003cp\u003e环境使用软件版本为：Centos7.9_2009 + jdk1.8 + mysql 5.7.34 + python3.6 + tomcat 8.5.69\u003c/p\u003e\n\u003ch2 id=\"oracle-jdk180_301\"\u003eOracle jdk1.8.0_301\u003c/h2\u003e\n\u003cp\u003e#软件包下载地址： \u003ca href=\"https://www.oracle.com/java/technologies/javase/javase-jdk8-downloads.html\"\u003ehttps://www.oracle.com/java/technologies/javase/javase-jdk8-downloads.html\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e解压软件包到opt目录下\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003etar -zxvf jdk-8u301-linux-x64.tar.gz -C /opt/\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e创建软连接以便版本更迭\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eln -s /opt/jdk1.8.0_301/ /opt/jdk\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e添加系统环境变量，立即生效\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003evim /etc/profile\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"c1\"\u003e#Set the JDK environment variables\u003c/span\u003e\n\u003cspan class=\"nb\"\u003eexport\u003c/span\u003e \u003cspan class=\"nv\"\u003eJAVA_HOME\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e/opt/jdk\n\u003cspan class=\"nb\"\u003eexport\u003c/span\u003e \u003cspan class=\"nv\"\u003eJRE_HOME\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e/opt/jdk/jre\n\u003cspan class=\"nb\"\u003eexport\u003c/span\u003e \u003cspan class=\"nv\"\u003eCLASSPATH\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e.:\u003cspan class=\"nv\"\u003e$JAVA_HOME\u003c/span\u003e/lib:\u003cspan class=\"nv\"\u003e$JRE_HOME\u003c/span\u003e/lib:\u003cspan class=\"nv\"\u003e$JAVA_HOME\u003c/span\u003e/lib/tools.jar\n\u003cspan class=\"nb\"\u003eexport\u003c/span\u003e \u003cspan class=\"nv\"\u003ePATH\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"nv\"\u003e$PATH\u003c/span\u003e:\u003cspan class=\"nv\"\u003e$JAVA_HOME\u003c/span\u003e/bin:\u003cspan class=\"nv\"\u003e$JRE_HOME\u003c/span\u003e/bin\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"nb\"\u003esource\u003c/span\u003e /etc/profile\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e查看java版本，是否生效\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003ejava -version\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"mysql-5734\"\u003eMySQL 5.7.34\u003c/h2\u003e\n\u003cp\u003e#MySQL软件包下载地址： \u003ca href=\"https://downloads.mysql.com/archives/community/\"\u003ehttps://downloads.mysql.com/archives/community/\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e检查并删除自带的mariadb\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eyum list installed  \u003cspan class=\"p\"\u003e|\u003c/span\u003e grep mariadb\nyum -y remove mariadb-libs.x86_64\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e解压软件包到/opt下\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003etar -zxvf mysql-5.7.34-el7-x86_64.tar.gz -C /opt\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e创建软连接\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eln -s /opt/mysql-5.7.34-el7-x86_64/ /opt/mysql\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e创建用户，-M不指定家目录，-s /sbin/nologin无法登录系统\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003euseradd -M -s /sbin/nologin mysql\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e创建mysql数据目录，赋予mysql用户权限\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003emkdir -pv /data/mysql\nchown -R mysql:mysql /data/mysql/\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e创建my.cnf配置文件\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003evim /etc/my.cnf\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003emysqld\u003cspan class=\"o\"\u003e]\u003c/span\u003e\nbind-address\u003cspan class=\"o\"\u003e=\u003c/span\u003e0.0.0.0\n\u003cspan class=\"nv\"\u003eport\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e3306\u003c/span\u003e\n\u003cspan class=\"nv\"\u003euser\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003emysql\n\u003cspan class=\"nv\"\u003ebasedir\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e/opt/mysql\n\u003cspan class=\"nv\"\u003edatadir\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e/data/mysql\n\u003cspan class=\"nv\"\u003esocket\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e/tmp/mysql.sock\nlog-error\u003cspan class=\"o\"\u003e=\u003c/span\u003e/data/mysql/mysql.err\npid-file\u003cspan class=\"o\"\u003e=\u003c/span\u003e/data/mysql/mysql.pid\n\u003cspan class=\"c1\"\u003e#character config\u003c/span\u003e\n\u003cspan class=\"nv\"\u003echaracter_set_server\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eutf8mb4\nsymbolic-links\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e将命令目录加入系统环境变量，立即生效\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;PATH=\u003c/span\u003e\u003cspan class=\"nv\"\u003e$PATH\u003c/span\u003e\u003cspan class=\"s2\"\u003e:/opt/mysql/bin\u0026#34;\u003c/span\u003e \u0026gt;\u0026gt; /etc/profile\n\u003cspan class=\"nb\"\u003esource\u003c/span\u003e /etc/profile\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e初始化数据库，指定配置文件，安装目录，数据目录，指定用户\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003emysqld --defaults-file\u003cspan class=\"o\"\u003e=\u003c/span\u003e/etc/my.cnf --basedir\u003cspan class=\"o\"\u003e=\u003c/span\u003e/usr/local/mysql/ --datadir\u003cspan class=\"o\"\u003e=\u003c/span\u003e/data/mysql/ --user\u003cspan class=\"o\"\u003e=\u003c/span\u003emysql --initialize\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e查看mysql日志，查看数据库初始用户和密码（在最后一段）\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003ecat /data/mysql/mysql.err\n\n2021-08-23T14:47:03.946617Z \u003cspan class=\"m\"\u003e1\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003eNote\u003cspan class=\"o\"\u003e]\u003c/span\u003e A temporary password is generated \u003cspan class=\"k\"\u003efor\u003c/span\u003e root@localhost: R4LagOyP26%,\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e拷贝启动脚本\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003ecp /opt/mysql/support-files/mysql.server /etc/init.d/mysql\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e启动服务，设置开启自启\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eservice mysql start\nchkconfig mysql on\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003emysql默认监听3306端口\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003ess -utpln \u003cspan class=\"p\"\u003e|\u003c/span\u003e grep \u003cspan class=\"m\"\u003e3306\u003c/span\u003e\n\ntcp    LISTEN     \u003cspan class=\"m\"\u003e0\u003c/span\u003e      \u003cspan class=\"m\"\u003e80\u003c/span\u003e        *:3306                  *:*                   users:\u003cspan class=\"o\"\u003e((\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;mysqld\u0026#34;\u003c/span\u003e,pid\u003cspan class=\"o\"\u003e=\u003c/span\u003e3824,fd\u003cspan class=\"o\"\u003e=\u003c/span\u003e20\u003cspan class=\"o\"\u003e))\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e使用刚才看到的密码，登录数据库，重置密码为root\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-sql\" data-lang=\"sql\"\u003e\u003cspan class=\"n\"\u003emysql\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eu\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eroot\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003ep\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"n\"\u003eEnter\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003epassword\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"n\"\u003emysql\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-sql\" data-lang=\"sql\"\u003e\u003cspan class=\"k\"\u003eSET\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003ePASSWORD\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003ePASSWORD\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;root\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003eALTER\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003eUSER\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;root\u0026#39;\u003c/span\u003e\u003cspan class=\"o\"\u003e@\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;localhost\u0026#39;\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003ePASSWORD\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eEXPIRE\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eNEVER\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"n\"\u003eFLUSH\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003ePRIVILEGES\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003emysql默认只能本地访问，需要修改下user表root用户的权限，将默认的localhost改为%，允许所有主机\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-sql\" data-lang=\"sql\"\u003e\u003cspan class=\"n\"\u003euse\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003emysql\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003eupdate\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003euser\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003eset\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003ehost\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;%\u0026#39;\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003ewhere\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003euser\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;root\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"n\"\u003eflush\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003eprivileges\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"python-36\"\u003ePython 3.6\u003c/h2\u003e\n\u003cp\u003e下载地址： \u003ca href=\"https://www.python.org/ftp/python/3.6.2/Python-3.6.2.tgz\"\u003ehttps://www.python.org/ftp/python/3.6.2/Python-3.6.2.tgz\u003c/a\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"c1\"\u003e#可选的软件包\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e#yum install gcc patch libffi-devel python-devel  zlib-devel bzip2-devel openssl-devel ncurses-devel sqlite-devel readline-devel tk-devel gdbm-devel db4-devel libpcap-devel xz-devel -y\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e#gcc :c编译器\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e#python-devel    python 开发包\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e#openssl-devel     用于python的ssl模块\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e#sqlite-devel     轻量级数据库\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e安装gcc编译器\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eyum -y install gcc\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e解压软件包到/opt目录\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003etar -zxvf Python-3.6.2.tgz -C /opt/\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e创建软连接\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eln -s /opt/Python-3.6.2/ /opt/python\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e添加环境变量，立即生效\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003evim /etc/profile\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"c1\"\u003e#Set the Python environment variables\u003c/span\u003e\n\u003cspan class=\"nb\"\u003eexport\u003c/span\u003e \u003cspan class=\"nv\"\u003ePATH\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"nv\"\u003e$PATH\u003c/span\u003e:/opt/python/bin\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"nb\"\u003esource\u003c/span\u003e /etc/profile\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cpre\u003e\u003ccode\u003e[root@test1 ~]# python3\n\nPython 3.6.2 (default, Aug 24 2021, 20:05:45)\n[GCC 4.8.5 20150623 (Red Hat 4.8.5-44)] on linux\nType \u0026quot;help\u0026quot;, \u0026quot;copyright\u0026quot;, \u0026quot;credits\u0026quot; or \u0026quot;license\u0026quot; for more information.\n\u0026gt;\u0026gt;\u0026gt;\n\u0026gt;\u0026gt;\u0026gt;\n\u0026gt;\u0026gt;\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003ch2 id=\"tomcat-8569\"\u003eTomcat 8.5.69\u003c/h2\u003e\n\u003cp\u003e#下载地址： \u003ca href=\"https://archive.apache.org/dist/tomcat/tomcat-8/v8.5.69/\"\u003ehttps://archive.apache.org/dist/tomcat/tomcat-8/v8.5.69/\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e解压软件包到/opt目录\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003etar -zxvf apache-tomcat-8.5.69.tar.gz -C /opt\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e创建软连接\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003eln -s /opt/apache-tomcat-8.5.69/ /opt/tomcat\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e添加环境变量\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003evim /opt/tomcat/bin/setclasspath.sh\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"nb\"\u003eexport\u003c/span\u003e \u003cspan class=\"nv\"\u003eJAVA_HOME\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e/opt/jdk\n\u003cspan class=\"nb\"\u003eexport\u003c/span\u003e \u003cspan class=\"nv\"\u003eJRE_HOME\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e/opt/jdk/jre\n\u003cspan class=\"c1\"\u003e#已在/etc/profile添加过此环境变量则无需再次添加\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e立即生效\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"nb\"\u003esource\u003c/span\u003e setclasspath.sh\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e启动tomcat服务\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"nb\"\u003ecd\u003c/span\u003e /opt/tomcat/bin\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e./startup.sh\n\nUsing CATALINA_BASE:   /opt/tomcat\nUsing CATALINA_HOME:   /opt/tomcat\nUsing CATALINA_TMPDIR: /opt/tomcat/temp\nUsing JRE_HOME:        /opt/jdk/jre\nUsing CLASSPATH:       /opt/tomcat/bin/bootstrap.jar:/opt/tomcat/bin/tomcat-juli.jar\nUsing CATALINA_OPTS:   \nTomcat started.\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e将启动脚本，加入开机自启\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003evim /etc/rc.local\n\n/bin/sh /opt/tomcat/bin/startup.sh \u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003etomcat默认监听8080端口\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003ess -utpln \u003cspan class=\"p\"\u003e|\u003c/span\u003e grep \u003cspan class=\"m\"\u003e8080\u003c/span\u003e\n\ntcp    LISTEN     \u003cspan class=\"m\"\u003e0\u003c/span\u003e      \u003cspan class=\"m\"\u003e100\u003c/span\u003e    \u003cspan class=\"o\"\u003e[\u003c/span\u003e::\u003cspan class=\"o\"\u003e]\u003c/span\u003e:8080               \u003cspan class=\"o\"\u003e[\u003c/span\u003e::\u003cspan class=\"o\"\u003e]\u003c/span\u003e:*                   users:\u003cspan class=\"o\"\u003e((\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;java\u0026#34;\u003c/span\u003e,pid\u003cspan class=\"o\"\u003e=\u003c/span\u003e17268,fd\u003cspan class=\"o\"\u003e=\u003c/span\u003e55\u003cspan class=\"o\"\u003e))\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","date":1631177625,"description":"","fuzzywordcount":1100,"kind":"page","lang":"zh","lastmod":1646884031,"objectID":"3e15f219b0439aab31ebd61856fa9f6f","publishdate":1631177625,"relpermalink":"/posts/building_javaweb_development_environment/","section":"posts","summary":"为 Javaweb 开发项目搭建基础环境，全部使用源码包手动安装 环境使用软件","tags":["Linux"],"title":"Javaweb 开发环境搭建","url":"https://ikuriko.github.io/posts/building_javaweb_development_environment/","wordcount":1014},{"categories":"posts","content":"\u003ch2 id=\"hugo-安装\"\u003eHugo 安装\u003c/h2\u003e\n\u003cp\u003e首先在本地安装\u003ca href=\"https://github.com/gohugoio/hugo/releases\"\u003ehugo\u003c/a\u003e，选择适合自己系统的安装包\u003c/p\u003e\n\u003cp\u003e将hugo执行目录加入系统的环境变量\u003c/p\u003e\n\u003cp\u003e添加系统变量后，测试是否成功\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003ehugo version\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e此时，我们就可以开始新建站点了\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003ehugo new site blog\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e它会在当前目录，生成一个名为\u003ccode\u003eblog\u003c/code\u003e的文件夹，里面是新建的站点文件\u003c/p\u003e\n\u003ch2 id=\"生成静态页面\"\u003e生成静态页面\u003c/h2\u003e\n\u003cp\u003e在生成开始之前，我们需要为hugo安装一个主题，这里选用的是MemE\u003c/p\u003e\n\u003cp\u003e进入\u003ccode\u003eblog\u003c/code\u003e目录安装主题\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"nb\"\u003ecd\u003c/span\u003e blog\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e使用git初始化仓库\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003egit init\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e下载\u003ca href=\"https://github.com/reuixiy/hugo-theme-meme\"\u003eMemE\u003c/a\u003e主题文件\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003egit submodule add --depth \u003cspan class=\"m\"\u003e1\u003c/span\u003e https://github.com/reuixiy/hugo-theme-meme.git themes/meme\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e将主题文件\u003ccode\u003econfig.toml\u003c/code\u003e替换为示例配置\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003emv config.toml config.toml.bak\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003ecp themes/meme/config-examples/en/config.toml config.toml\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e新建一篇文章和一个关于页面\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003ehugo new “posts/test.md”\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003ehugo new \u003cspan class=\"s2\"\u003e\u0026#34;about/_index.md\u0026#34;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eGame Start\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003ehugo server -D\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e生成本地测试页面，在浏览器使用\u003ccode\u003elocalhost:1313\u003c/code\u003e访问\u003c/p\u003e\n\u003ch2 id=\"推送到github-pages\"\u003e推送到Github Pages\u003c/h2\u003e\n\u003cp\u003e首先，你需要拥有一个Github账号\u003c/p\u003e\n\u003cp\u003e创建一个存储仓库，在仓库启用Github Pages\u003c/p\u003e\n\u003cp\u003e在本地配置你的Github信息\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e$ git config --global user.name \u003cspan class=\"s2\"\u003e\u0026#34;username\u0026#34;\u003c/span\u003e\n$ git config --global user.email \u003cspan class=\"s2\"\u003e\u0026#34;useremail\u0026#34;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cfont color=red\u003e注意git config命令的--global参数，用了这个参数，表示你这台机器上所有的Git仓库都会使用这个配置，当然也可以对某个仓库指定不同的用户名和Email地址。\u003c/font\u003e\u003c/p\u003e\n\u003cp\u003e生成SSH密钥对\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e$ ssh-keygen -t rsa -b \u003cspan class=\"m\"\u003e4096\u003c/span\u003e -C \u003cspan class=\"s2\"\u003e\u0026#34;useremail\u0026#34;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e$ cat ~/.ssh/id_rsa.pub\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e将生成的密钥复制，去 Github 上设置一个新的密钥对 \u003ca href=\"https://github.com/settings/keys\"\u003eNew SSH key\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e测试连接\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003essh -T git@github.com\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e将Github仓库克隆到本地的 ikuriko_blog 文件夹\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003egit clone https://github.com/iKuriko/ikuriko.github.io.git ikuriko_blog\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e进入仓库目录\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"nb\"\u003ecd\u003c/span\u003e ikuriko_blog\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e初始化仓库\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003egit init\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e将本地Git仓库和远程仓库关联起来，并设置远程仓库名称\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003egit remote add origin git@github.com:iKuriko/ikuriko.github.io.git\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e添加所有文件到本地缓冲区\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003egit add -A\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e提交到本地仓库，标签为\u003ccode\u003efirst commit\u003c/code\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003egit commit -m \u003cspan class=\"s2\"\u003e\u0026#34;first commit\u0026#34;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e提交到远程仓库，第一次需指定用户和分支\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003egit push -u origin main\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e#非首次推送\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003egit push\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e修改blog目录下的config.xoml文件，添加一行：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"nv\"\u003epublishDir\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;../ikuriko_blog\u0026#34;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e将hugo生成的public目录改为刚才克隆的Github仓库的目录\u003c/p\u003e\n\u003cp\u003e生成页面\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003ehugo -D\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e再次使用上面的\u003cfont color=red\u003e git \u003c/font\u003e命令将生成文件推送到远程仓库\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003egit add -A\n\ngit commit -m \u003cspan class=\"s2\"\u003e\u0026#34;new\u0026#34;\u003c/span\u003e\n\ngit push -u origin main\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eSuccess！\u003c/p\u003e\n\u003cp\u003e访问你的Github Page\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://ikuriko.github.io\"\u003ehttps://ikuriko.github.io\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003ePS:Git 的基本使用\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e查看当前仓库的状态\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003egit status\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e添加并提交改动\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003egit add \u0026lt;文件\u0026gt; \u0026lt;文件\u0026gt; ……\ngit commit -m \u003cspan class=\"s2\"\u003e\u0026#34;first commit\u0026#34;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cul\u003e\n\u003cli\u003e\u003cfont color=red size=3fx\u003e\u003ccode\u003egit add -A\u003c/code\u003e\u003c/font\u003e的意思是一次添加所有文件。\u003c/li\u003e\n\u003cli\u003e\u003cfont color=red size=3fx\u003e\u003ccode\u003e-m\u003c/code\u003e\u003c/font\u003e 的意思是此次提交的修改说明\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e查看所有的 commit 历史\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003egit log\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e查看远程仓库，以及与本地仓库的关系\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003egit remote show origin\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e抓取远程的一个分支到本地\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003egit fetch \u0026lt;remote_name\u0026gt; \u0026lt;branch_name\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","date":1630995648,"description":"","fuzzywordcount":1000,"kind":"page","lang":"zh","lastmod":1646884118,"objectID":"4db907af997f7bf0d8bb5ac344a8545a","publishdate":1630995648,"relpermalink":"/posts/hugo+githubpages/","section":"posts","summary":"Hugo 安装 首先在本地安装hugo，选择适合自己系统的安装包 将hu","tags":["Hugo"],"title":"Hugo+GithubPages 个人站点搭建","url":"https://ikuriko.github.io/posts/hugo+githubpages/","wordcount":902},{"categories":"posts","content":"\u003cp\u003eFonts\u003c/p\u003e\n\u003cp style=\"text-align:center;color:;font-size:20px;font-family:arial\"\u003e这是居中\u003c/p\u003e \n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-md\" data-lang=\"md\"\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nt\"\u003ep\u003c/span\u003e \u003cspan class=\"na\"\u003estyle\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;text-align:center;color:;font-size:20px;font-family:\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e这是居中\u003cspan class=\"p\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"nt\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp style=\"text-align:center;color:red;font-size:20px;\"\u003e这是红色\u003c/p\u003e \n\u003cpre\u003e\u003ccode\u003e\u0026lt;p style=\u0026quot;text-align:center;color:red;font-size:20px;font-family:\u0026quot;\u0026gt;这是红色\u0026lt;/p\u0026gt; \n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eImage\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/hello-world.jpg\" alt=\"\" style=\"width:50%\" /\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-md\" data-lang=\"md\"\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nt\"\u003eimg\u003c/span\u003e \u003cspan class=\"na\"\u003esrc\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;/images/hello-world.jpg\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003ealt\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003estyle\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;width:50%\u0026#34;\u003c/span\u003e \u003cspan class=\"p\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cimg src=\"/images/hello-world.jpg\" alt=\"hello-world.jpg\"\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-md\" data-lang=\"md\"\u003e![\u003cspan class=\"nt\"\u003ehello-world.jpg\u003c/span\u003e](\u003cspan class=\"na\"\u003e/images/hello-world.jpg\u003c/span\u003e)\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eForm\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth style=\"text-align:left\"\u003e这是一个表格\u003c/th\u003e\n\u003cth style=\"text-align:left\"\u003e\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e1\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003etesT1\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e2\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003etesT2\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e3\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003etesT3\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-md\" data-lang=\"md\"\u003e| 这是一个表格 |       |\n| :----------- | :---- |\n| 1            | tesT1 |\n| 2            | tesT2 |\n| 3            | tesT3 |\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","date":1630572955,"description":"Test page","fuzzywordcount":300,"kind":"page","lang":"zh","lastmod":1646797255,"objectID":"e16fe2bddf1879f42db80a350758d99a","publishdate":1630572955,"relpermalink":"/posts/hello_world/","section":"posts","summary":"Fonts 这是居中 \u0026lt;p style=\u0026#34;text-align:ce","tags":["Hello world"],"title":"Hello_world","url":"https://ikuriko.github.io/posts/hello_world/","wordcount":237}]